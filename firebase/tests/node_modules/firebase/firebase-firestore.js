!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(Md){"use strict";try{(function(){Md=Md&&Object.prototype.hasOwnProperty.call(Md,"default")?Md.default:Md;var t,l,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function g(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function w(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(e=l=l||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=h[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var u={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},a=l.INFO,h=((t={})[l.DEBUG]="log",t[l.VERBOSE]="log",t[l.INFO]="info",t[l.WARN]="warn",t[l.ERROR]="error",t),c=(Object.defineProperty(f.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),f.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?u[t]:t},Object.defineProperty(f.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),f.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},f.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},f.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},f.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},f.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},f);function f(t){this.name=t,this._logLevel=a,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,y="FirebaseError",v=(n(m,d=Error),m);function m(t,e){var n=d.call(this,e)||this;return n.code=t,n.name=y,Object.setPrototypeOf(n,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,b.prototype.create),n}var b=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(I,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new v(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var I=/\{\$([^}]+)}/g,T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function N(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var A,_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D={},S=_||self;function x(){}function k(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function O(t){var e=k(t);return"array"==e||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),R=0;function C(t,e,n){return t.call.apply(t.bind,arguments)}function U(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?C:U).apply(null,arguments)}function M(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var F=Date.now;function j(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,L)&&t[L]||(t[L]=++R))},q.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(t){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function X(t){return/^[\s\xa0]*$/.test(t)}var H,W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:e<t?1:0}t:{var J=S.navigator;if(J){var $=J.userAgent;if($){H=$;break t}}H=""}function Z(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function tt(t){var e={};for(var n in t)e[n]=t[n];return e}var et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<et.length;o++)n=et[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function rt(t){return rt[" "](t),t}rt[" "]=x;var it,ot,st=Q(H,"Opera"),ut=Q(H,"Trident")||Q(H,"MSIE"),at=Q(H,"Edge"),ht=at||ut,ct=Q(H,"Gecko")&&!(Q(H.toLowerCase(),"webkit")&&!Q(H,"Edge"))&&!(Q(H,"Trident")||Q(H,"MSIE"))&&!Q(H,"Edge"),ft=Q(H.toLowerCase(),"webkit")&&!Q(H,"Edge");function lt(){var t=S.document;return t?t.documentMode:void 0}t:{var pt="",dt=(ot=H,ct?/rv:([^\);]+)(\)|;)/.exec(ot):at?/Edge\/([\d\.]+)/.exec(ot):ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ot):ft?/WebKit\/(\S+)/.exec(ot):st?/(?:Version)[ \/]?(\S+)/.exec(ot):void 0);if(dt&&(pt=dt?dt[1]:""),ut){var yt=lt();if(null!=yt&&yt>parseFloat(pt)){it=String(yt);break t}}it=pt}var vt={};function gt(u){return t=u,e=function(){for(var t=0,e=W(String(it)).split("."),n=W(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Y(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==o[2].length,0==s[2].length)||Y(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=vt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var mt=S.document&&ut?lt()||(parseInt(it,10)||void 0):void 0,wt=!ut||9<=Number(mt),bt=ut&&!gt("9"),Et=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",x,e),S.removeEventListener("test",x,e)}catch(t){}return t}();function It(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Tt(t,e){if(It.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ct){t:{try{rt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Nt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}It.prototype.b=function(){this.defaultPrevented=!0},j(Tt,It);var Nt={2:"touch",3:"pen",4:"mouse"};Tt.prototype.b=function(){Tt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,bt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var At="closure_listenable_"+(1e6*Math.random()|0),_t=0;function Dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++_t,this.Y=this.Z=!1}function St(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function xt(t){this.src=t,this.a={},this.b=0}function kt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=G(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(St(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Ot(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Ot(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Dt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Lt={};function Rt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Gt(r);return e&&e[At]?e.wa(n,r,P(i)?!!i.capture:!!i,o):Ct(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);return null}return n=Gt(n),t&&t[At]?t.va(e,n,P(r)?!!r.capture:!!r,i):Ct(t,e,n,!1,r,i)}function Ct(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=P(i)?!!i.capture:!!i;if(s&&!wt)return null;var u,a,h=jt(t);if(h||(t[Pt]=h=new xt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=Ft,r=a=wt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Et||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ut(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[At]?kt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(kt(n,t),0==n.b&&(n.src=null,e[Pt]=null)):St(t)))}function Vt(t){return t in Lt?Lt[t]:Lt[t]="on"+t}function Mt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ut(t),n.call(r,e)}function Ft(t,e){if(t.Y)return!0;if(wt)return Mt(t,new Tt(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Mt(t,e=new Tt(e,this))}function jt(t){return(t=t[Pt])instanceof xt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gt(e){return"function"==k(e)?e:(e[qt]||(e[qt]=function(t){return e.handleEvent(t)}),e[qt])}function Bt(){q.call(this),this.c=new xt(this),(this.J=this).C=null}function zt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&kt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}j(Bt,q),Bt.prototype[At]=!0,(A=Bt.prototype).addEventListener=function(t,e,n,r){Rt(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=P(i)?!!i.capture:!!i,r=Gt(r),e&&e[At]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Ot(s=e.a[n],r,i,o))&&(St(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Ot(n,r,i,o)),(r=-1<e?n[e]:null)&&Ut(r))}(this,t,e,n,r)},A.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new It(t,n):t instanceof It?t.target=t.target||n:(s=t,nt(t=new It(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=zt(o,r,!0,t)&&s;if(s=zt(o=t.a=n,r,!0,t)&&s,s=zt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=zt(o=t.a=e[i],r,!1,t)&&s;return s},A.G=function(){if(Bt.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)St(n[r]);delete e.a[t],e.b--}}this.C=null},A.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},A.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Kt=S.JSON.stringify;function Xt(){this.b=this.a=null}var Ht,Wt=(Qt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Qt(function(){return new Yt},function(t){t.reset()},100));function Qt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Yt(){this.next=this.b=this.a=null}function Jt(t,e){var n;Ht||(n=S.Promise.resolve(void 0),Ht=function(){n.then(te)}),$t||(Ht(),$t=!0),Zt.add(t,e)}Xt.prototype.add=function(t,e){var n=Wt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Yt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var $t=!(Yt.prototype.reset=function(){this.next=this.b=this.a=null}),Zt=new Xt;function te(){for(var t,e,n;n=e=void 0,n=null,(e=Zt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){S.setTimeout(function(){throw t},0)}(t)}var r=Wt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}$t=!1}function ee(t,e){Bt.call(this),this.b=t||1,this.a=e||S,this.f=V(this.Ya,this),this.g=F()}function ne(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function re(t,e,n){if("function"==k(t))n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}j(ee,Bt),(A=ee.prototype).aa=!1,A.M=null,A.Ya=function(){var t;this.aa&&(0<(t=F()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(ne(this),this.start())))},A.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=F())},A.G=function(){ee.S.G.call(this),ne(this),delete this.a};var ie,oe,se,ue=(T(oe=he,se=ie=q),oe.prototype=null===se?Object.create(se):(ae.prototype=se.prototype,new ae),he.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=re(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},he.prototype.G=function(){ie.prototype.G.call(this),this.a&&(S.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},he);function ae(){this.constructor=oe}function he(t,e,n){var r=ie.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function ce(t){q.call(this),this.b=t,this.a={}}j(ce,q);var fe=[];function le(t,e,n,r){Array.isArray(n)||(n&&(fe[0]=n.toString()),n=fe);for(var i=0;i<n.length;i++){var o=Rt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function pe(t){Z(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ut(t)},t),t.a={}}function de(){this.a=!0}function ye(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Kt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ce.prototype.G=function(){ce.S.G.call(this),pe(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},de.prototype.info=function(){};var ve=null;function ge(){return ve=ve||new Bt}function me(t){It.call(this,"serverreachability",t)}function we(t){var e=ge();e.dispatchEvent(new me(e))}function be(t){It.call(this,"statevent",t)}function Ee(t){var e=ge();e.dispatchEvent(new be(e))}function Ie(t){It.call(this,"timingevent",t)}function Te(t,e){if("function"!=k(t))throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}j(me,It),j(be,It),j(Ie,It);var Ne={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},Ae={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function _e(){}function De(t){var e;return(e=t.a)||(e=t.a={}),e}function Se(){}_e.prototype.a=null;var xe,ke={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Oe(){It.call(this,"d")}function Pe(){It.call(this,"c")}function Le(){}function Re(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new ce(this),this.P=Ce,t=ht?125:void 0,this.R=new ee(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}j(Oe,It),j(Pe,It),j(Le,_e),xe=new Le;var Ce=45e3,Ue={},Ve={};function Me(t,e,n){t.H=1,t.i=sn(Ze(e)),t.j=n,t.I=!0,Fe(t,null)}function Fe(t,e){t.u=F(),qe(t),t.l=Ze(t.i);var s,u,a,h,c,f,n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),wn(n.b,"t",r),t.D=0,t.a=lr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ue(V(t.Ca,t,t.a),t.O)),le(t.J,t.a,"readystatechange",t.Wa),e=t.B?tt(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),we(1),s=t.c,u=t.m,a=t.l,h=t.f,c=t.T,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+h+") [attempt "+c+"]: "+u+"\n"+a+"\n"+t})}function je(t,e,n){for(var r,i,o,s,u=!0;!t.A&&t.D<n.length;){var a=(i=n,s=o=void 0,o=(r=t).D,-1==(s=i.indexOf("\n",o))?Ve:(o=Number(i.substring(o,s)),isNaN(o)?Ue:(s+=1)+o>i.length?Ve:(i=i.substr(s,o),r.D=s+o,i)));if(a==Ve){4==e&&(t.h=4,Ee(14),u=!1),ye(t.c,t.f,null,"[Incomplete Response]");break}if(a==Ue){t.h=4,Ee(15),ye(t.c,t.f,n,"[Invalid Chunk]"),u=!1;break}ye(t.c,t.f,a,null),Xe(t,a)}4==e&&0==n.length&&(t.h=1,Ee(16),u=!1),t.b=t.b&&u,u?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),ir(e),e.F=!0)):(ye(t.c,t.f,n,"[Invalid Chunked Response]"),Ke(t),ze(t))}function qe(t){t.U=F()+t.P,Ge(t,t.P)}function Ge(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Te(V(t.Ua,t),e)}function Be(t){t.o&&(S.clearTimeout(t.o),t.o=null)}function ze(t){0==t.g.v||t.A||ur(t.g,t)}function Ke(t){Be(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ne(t.R),pe(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Xe(t,e){try{var n,r,i,o,s,u,a,h,c,f,l,p=t.g;if(0!=p.v&&(p.a==t||_n(p.b,t)))if(p.I=t.N,!t.C&&_n(p.b,t)&&3==p.v){try{var d=p.ka.a.parse(e)}catch(t){d=null}if(Array.isArray(d)&&3==d.length){var y=d;if(0==y[0]){t:if(!p.j){if(p.a){if(!(p.a.u+3e3<t.u))break t;sr(p),Qn(p)}rr(p),Ee(18)}}else p.oa=y[1],0<p.oa-p.P&&y[2]<37500&&p.H&&0==p.o&&!p.m&&(p.m=Te(V(p.Ra,p),6e3));if(An(p.b)<=1&&p.ea){try{p.ea()}catch(t){}p.ea=void 0}}else hr(p,11)}else if(!t.C&&p.a!=t||sr(p),!X(e))for(e=d=p.ka.a.parse(e),d=0;d<e.length;d++){y=e[d],p.P=y[0],y=y[1],2==p.v?"c"==y[0]?(p.J=y[1],p.ga=y[2],null!=(n=y[3])&&(p.ha=n,p.c.info("VER="+p.ha)),null!=(r=y[4])&&(p.pa=r,p.c.info("SVER="+p.pa)),null!=(i=y[5])&&"number"==typeof i&&0<i&&(o=1.5*i,p.D=o,p.c.info("backChannelRequestTimeoutMs_="+o)),o=p,(s=t.a)&&(!(u=s.a?s.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(a=o.b).a&&(Q(u,"spdy")||Q(u,"quic")||Q(u,"h2"))&&(a.f=a.g,a.a=new Set,a.b&&(Dn(a,a.b),a.b=null)),!o.A||(h=s.a?s.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(o.na=h,on(o.B,o.A,h))),p.v=3,p.f&&p.f.ta(),p.V&&(p.N=F()-t.u,p.c.info("Handshake RTT: "+p.N+"ms")),c=t,(o=p).la=fr(o,o.C?o.ga:null,o.fa),c.C?(Sn(o.b,c),f=c,(l=o.D)&&f.setTimeout(l),f.o&&(Be(f),qe(f)),o.a=c):nr(o),0<p.g.length&&$n(p)):"stop"!=y[0]&&"close"!=y[0]||hr(p,7):3==p.v&&("stop"==y[0]||"close"==y[0]?"stop"==y[0]?hr(p,7):Wn(p):"noop"!=y[0]&&p.f&&p.f.sa(y),p.o=0)}we(4)}catch(t){}}function He(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(O(t)||"string"==typeof t)B(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(O(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(O(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function We(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof We)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ye(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Ye(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ye(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(A=Re.prototype).setTimeout=function(t){this.P=t},A.Wa=function(t){t=t.target;var e=this.F;e&&3==zn(t)?e.f():this.Ca(t)},A.Ca=function(t){try{if(t==this.a)t:{var e=zn(this.a),n=this.a.ua(),r=this.a.X();if(!(e<3||3==e&&!ht&&!this.a.$())){this.A||4!=e||7==n||we(8==n||r<=0?3:2),Be(this);var i=this.a.X();this.N=i;var o=this.a.$();if(this.b=200==i,h=this.c,c=this.m,f=this.l,l=this.f,p=this.T,d=e,y=i,h.info(function(){return"XMLHTTP RESP ("+l+") [ attempt "+p+"]: "+c+"\n"+f+"\n"+d+" "+y}),this.b){if(this.V&&!this.C){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!X(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,Ee(12),Ke(this),ze(this);break t}ye(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Xe(this,a)}this.I?(je(this,e,o),ht&&this.b&&3==e&&(le(this.J,this.R,"tick",this.Va),this.R.start())):(ye(this.c,this.f,o,null),Xe(this,o)),4==e&&Ke(this),this.b&&!this.A&&(4==e?ur(this.g,this):(this.b=!1,qe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Ee(12)):(this.h=0,Ee(13)),Ke(this),ze(this)}}}catch(t){}var h,c,f,l,p,d,y},A.Va=function(){var t,e;this.a&&(t=zn(this.a),e=this.a.$(),this.D<e.length&&(Be(this),je(this,t,e),this.b&&4!=t&&qe(this)))},A.cancel=function(){this.A=!0,Ke(this)},A.Ua=function(){this.o=null;var t,e,n=F();0<=n-this.U?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(we(3),Ee(17)),Ke(this),this.h=2,ze(this)):Ge(this,this.U-n)},(A=We.prototype).K=function(){Qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},A.L=function(){return Qe(this),this.a.concat()},A.get=function(t,e){return Ye(this.b,t)?this.b[t]:e},A.set=function(t,e){Ye(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},A.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof $e?(this.a=void 0!==e?e:t.a,tn(this,t.f),this.j=t.j,en(this,t.c),nn(this,t.h),this.g=t.g,e=t.b,(n=new yn).c=e.c,e.a&&(n.a=new We(e.a),n.b=e.b),rn(this,n),this.i=t.i):t&&(n=String(t).match(Je))?(this.a=!!e,tn(this,n[1]||"",!0),this.j=un(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.g=un(n[5]||"",!0),rn(this,n[6]||"",!0),this.i=un(n[7]||"")):(this.a=!!e,this.b=new yn(null,this.a))}function Ze(t){return new $e(t)}function tn(t,e,n){t.f=n?un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.c=n?un(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function rn(t,e,n){var r,i;e instanceof yn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(vn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),wn(this,n,t))},r)),r.f=i):(n||(e=an(e,pn)),t.b=new yn(e,t.a))}function on(t,e,n){t.b.set(e,n)}function sn(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^F()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function an(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,hn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function hn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(an(e,cn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(an(e,cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(an(n,"/"==n.charAt(0)?ln:fn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",an(n,dn)),t.join("")};var cn=/[#\/\?@]/g,fn=/[#\?:]/g,ln=/[#\?]/g,pn=/[#\?@]/g,dn=/#/g;function yn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function vn(n){n.a||(n.a=new We,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function gn(t,e){vn(t),e=bn(t,e),Ye(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ye((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Qe(t)))}function mn(t,e){return vn(t),e=bn(t,e),Ye(t.a.b,e)}function wn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(bn(t,e),K(n)),t.b+=n.length)}function bn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function En(t,e){this.b=t,this.a=e}function In(t){this.g=t||Tn,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ia&&S.ia.ya&&S.ia.ya()&&S.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(A=yn.prototype).add=function(t,e){vn(this),this.c=null,t=bn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},A.forEach=function(n,r){vn(this),this.a.forEach(function(t,e){B(t,function(t){n.call(r,t,e,this)},this)},this)},A.L=function(){vn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},A.K=function(t){vn(this);var e=[];if("string"==typeof t)mn(this,t)&&(e=z(e,this.a.get(bn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},A.set=function(t,e){return vn(this),this.c=null,mn(this,t=bn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},A.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},A.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var Tn=10;function Nn(t){return t.b||t.a&&t.a.size>=t.f}function An(t){return t.b?1:t.a?t.a.size:0}function _n(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Dn(t,e){t.a?t.a.add(e):t.b=e}function Sn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function xn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return K(t.c);var r=t.c;try{for(var i=N(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function kn(){}function On(){this.a=new kn}function Pn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}In.prototype.cancel=function(){var e,t;if(this.c=xn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=N(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},kn.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},kn.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var Ln=S.JSON.parse;function Rn(t){Bt.call(this),this.headers=new We,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Cn,this.D=this.F=!1}j(Rn,Bt);var Cn="",Un=/^https?$/i,Vn=["POST","PUT"];function Mn(t){return"content-type"==t.toLowerCase()}function Fn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,jn(t),Gn(t)}function jn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function qn(t){if(t.b&&void 0!==D&&(!t.s[1]||4!=zn(t)||2!=t.X()))if(t.l&&4==zn(t))re(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==zn(t)){t.b=!1;try{var e,n,r,i,o=t.X();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(Je)[1]||null)&&S.self&&S.self.location&&(i=(r=S.self.location.protocol).substr(0,r.length-1)),n=!Un.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<zn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.X()+"]",jn(t)}}finally{Gn(t)}}}function Gn(t,e){if(t.a){Bn(t);var n=t.a,r=t.s[0]?x:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Bn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function zn(t){return t.a?t.a.readyState:0}function Kn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Z(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):on(t,e,n))}function Xn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Hn(t){this.pa=0,this.g=[],this.c=new de,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Xn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Xn("baseRetryDelayMs",5e3,t),this.Ma=Xn("retryDelaySeedMs",1e4,t),this.Ja=Xn("forwardChannelMaxRetries",2,t),this.ma=Xn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new In(t&&t.concurrentRequestLimit),this.ka=new On,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Wn(t){var e,n;Yn(t),3==t.v&&(e=t.R++,on(n=Ze(t.B),"SID",t.J),on(n,"RID",e),on(n,"TYPE","terminate"),tr(t,n),(e=new Re(t,t.c,e,void 0)).H=2,e.i=sn(Ze(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.i.toString(),"")),!n&&S.Image&&((new Image).src=e.i,n=!0),n||(e.a=lr(e.g,null),e.a.ba(e.i)),e.u=F(),qe(e)),cr(t)}function Qn(t){t.a&&(ir(t),t.a.cancel(),t.a=null)}function Yn(t){Qn(t),t.j&&(S.clearTimeout(t.j),t.j=null),sr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&S.clearTimeout(t.h),t.h=null)}function Jn(t,e){t.g.push(new En(t.La++,e)),3==t.v&&$n(t)}function $n(t){Nn(t.b)||t.h||(t.h=!0,Jt(t.Ba,t),t.u=0)}function Zn(t,e){var n=e?e.f:t.R++,r=Ze(t.B);on(r,"SID",t.J),on(r,"RID",n),on(r,"AID",t.P),tr(t,r),t.i&&t.l&&Kn(r,t.i,t.l),n=new Re(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=er(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Dn(t.b,n),Me(n,r,e)}function tr(t,n){t.f&&He({},function(t,e){on(n,e,t)})}function er(t,e,n){n=Math.min(t.g.length,n);var r=t.f?V(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r,e){var i=e||"";try{He(t,function(t,e){var n=t;P(t)&&(n=Kt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function nr(t){t.a||t.j||(t.U=1,Jt(t.Aa,t),t.o=0)}function rr(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=Te(V(t.Aa,t),ar(t,t.o)),t.o++,1)}function ir(t){null!=t.s&&(S.clearTimeout(t.s),t.s=null)}function or(t){t.a=new Re(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ze(t.la);on(e,"RID","rpc"),on(e,"SID",t.J),on(e,"CI",t.H?"0":"1"),on(e,"AID",t.P),tr(t,e),on(e,"TYPE","xmlhttp"),t.i&&t.l&&Kn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=sn(Ze(e)),n.j=null,n.I=!0,Fe(n,t)}function sr(t){null!=t.m&&(S.clearTimeout(t.m),t.m=null)}function ur(t,e){var n,r=null;if(t.a==e){sr(t),ir(t),t.a=null;var i=2}else{if(!_n(t.b,e))return;r=e.s,Sn(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b){1==i?(r=e.j?e.j.length:0,e=F()-e.u,n=t.u,(i=ge()).dispatchEvent(new Ie(i)),$n(t)):nr(t)}else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(An(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)))return t.h=Te(V(t.Ba,t,e),ar(t,t.u)),t.u++,1}}(t,e)||2==i&&rr(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:hr(t,5);break;case 4:hr(t,10);break;case 3:hr(t,6);break;default:hr(t,2)}}function ar(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function hr(t,e){var n,r,i,o,s,u;t.c.info("Error code "+e),2==e?(n=null,t.f&&(n=null),r=V(t.Xa,t),n||(n=new $e("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||tn(n,"https"),sn(n)),i=n.toString(),o=r,u=new de,S.Image?((s=new Image).onload=M(Pn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=M(Pn,u,s,"TestLoadImage: error",!1,o),s.onabort=M(Pn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=M(Pn,u,s,"TestLoadImage: timeout",!1,o),S.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):Ee(2),t.v=0,t.f&&t.f.ra(e),cr(t),Yn(t)}function cr(t){t.v=0,t.I=-1,t.f&&(0==xn(t.b).length&&0==t.g.length||(t.b.c.length=0,K(t.g),t.g.length=0),t.f.qa())}function fr(t,e,n){var r,i,o,s,u,a,h,c=(r=n)instanceof $e?Ze(r):new $e(r,void 0);return""!=c.c?(e&&en(c,e+"."+c.c),nn(c,c.h)):(i=S.location,o=i.protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,h=new $e(null,void 0),o&&tn(h,o),s&&en(h,s),u&&nn(h,u),a&&(h.g=a),c=h),t.W&&Z(t.W,function(t,e){on(c,e,t)}),e=t.A,n=t.na,e&&n&&on(c,e,n),on(c,"VER",t.ha),tr(t,c),c}function lr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Rn(t.Ka)).F=t.C,e}function pr(){}function dr(){if(ut&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function yr(t,e){Bt.call(this),this.a=new Hn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!X(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!X(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new mr(this)}function vr(t){Oe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function gr(){Pe.call(this),this.status=1}function mr(t){this.a=t}(A=Rn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?De(this.H):De(xe),this.a.onreadystatechange=V(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Fn(this,t)}t=n||"";var i,o=new We(this.headers);r&&He(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Mn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=S.FormData&&t instanceof S.FormData,0<=G(Vn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Bn(this),0<this.o&&((this.D=(i=this.a,ut&&gt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=V(this.xa,this)):this.m=re(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Fn(this,t)}},A.xa=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},A.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Gn(this))},A.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Gn(this,!0)),Rn.S.G.call(this)},A.za=function(){this.j||(this.A||this.l||this.g?qn(this):this.Ta())},A.Ta=function(){qn(this)},A.X=function(){try{return 2<zn(this)?this.a.status:-1}catch(t){return-1}},A.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},A.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Ln(e)}},A.ua=function(){return this.h},A.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(A=Hn.prototype).ha=8,A.v=1,A.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Re(this,this.c,t,void 0),r=this.l;if(this.O&&(r?nt(r=tt(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=er(this,n,e),on(i=Ze(this.B),"RID",t),on(i,"CVER",22),this.A&&on(i,"X-HTTP-Session-Id",this.A),tr(this,i),this.i&&r&&Kn(i,this.i,r),Dn(this.b,n),this.Ga&&on(i,"TYPE","init"),this.da?(on(i,"$req",e),on(i,"SID","null"),n.V=!0,Me(n,i,null)):Me(n,i,e),this.v=2}}else 3==this.v&&(t?Zn(this,t):0==this.g.length||Nn(this.b)||Zn(this))},A.Aa=function(){var t;this.j=null,or(this),this.V&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Te(V(this.Sa,this),t))},A.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Qn(this),or(this))},A.Ra=function(){null!=this.m&&(this.m=null,Qn(this),rr(this),Ee(19))},A.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),Ee(2)):(this.c.info("Failed to ping google.com"),Ee(1))},(A=pr.prototype).ta=function(){},A.sa=function(){},A.ra=function(){},A.qa=function(){},A.Ha=function(){},dr.prototype.a=function(t,e){return new yr(t,e)},j(yr,Bt),(A=yr.prototype).addEventListener=function(t,e,n,r){yr.S.addEventListener.call(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){yr.S.removeEventListener.call(this,t,e,n,r)},A.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;Ee(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=fr(t,null,t.fa),$n(t)},A.close=function(){Wn(this.a)},A.Pa=function(t){var e;"string"==typeof t?((e={}).__data__=t,Jn(this.a,e)):this.g?((e={}).__data__=Kt(t),Jn(this.a,e)):Jn(this.a,t)},A.G=function(){this.a.f=null,delete this.f,Wn(this.a),delete this.a,yr.S.G.call(this)},j(vr,Oe),j(gr,Pe),j(mr,pr),mr.prototype.ta=function(){this.a.dispatchEvent("a")},mr.prototype.sa=function(t){this.a.dispatchEvent(new vr(t))},mr.prototype.ra=function(t){this.a.dispatchEvent(new gr)},mr.prototype.qa=function(){this.a.dispatchEvent("b")},dr.prototype.createWebChannel=dr.prototype.a,yr.prototype.send=yr.prototype.Pa,yr.prototype.open=yr.prototype.Oa,Ne.NO_ERROR=0,Ne.TIMEOUT=8,Ne.HTTP_ERROR=6,Ae.COMPLETE="complete",(Se.EventType=ke).OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",Bt.prototype.listen=Bt.prototype.va,Rn.prototype.listenOnce=Rn.prototype.wa,Rn.prototype.getLastError=Rn.prototype.Qa,Rn.prototype.getLastErrorCode=Rn.prototype.ua,Rn.prototype.getStatus=Rn.prototype.X,Rn.prototype.getResponseJson=Rn.prototype.Na,Rn.prototype.getResponseText=Rn.prototype.$,Rn.prototype.send=Rn.prototype.ba;var wr={createWebChannelTransport:function(){return new dr},ErrorCode:Ne,EventType:Ae,WebChannel:Se,XhrIo:Rn},br=wr.createWebChannelTransport,Er=wr.ErrorCode,Ir=wr.EventType,Tr=wr.WebChannel,Nr=wr.XhrIo,Ar=(_r.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},_r.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},_r.prototype.setServiceProps=function(t){return this.serviceProps=t,this},_r);function _r(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Dr=new c("@firebase/firestore");function Sr(){return Dr.logLevel}function xr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Dr.logLevel<=l.DEBUG&&(e=n.map(Pr),Dr.debug.apply(Dr,i(["Firestore (7.18.0): "+t],e)))}function kr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Dr.logLevel<=l.ERROR&&(e=n.map(Pr),Dr.error.apply(Dr,i(["Firestore (7.18.0): "+t],e)))}function Or(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Dr.logLevel<=l.WARN&&(e=n.map(Pr),Dr.warn.apply(Dr,i(["Firestore (7.18.0): "+t],e)))}function Pr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Lr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.18.0) INTERNAL ASSERTION FAILED: "+t;throw kr(e),new Error(e)}function Rr(t){t||Lr()}var Cr=(Ur.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ur);function Ur(){}function Vr(t,e){return t<e?-1:e<t?1:0}function Mr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Fr(t){return t+"\0"}function jr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var qr=(Object.defineProperty(Gr.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Gr.prototype.isEqual=function(t){return t instanceof Gr&&t.projectId===this.projectId&&t.database===this.database},Gr.prototype.o=function(t){return Vr(this.projectId,t.projectId)||Vr(this.database,t.database)},Gr);function Gr(t,e){this.projectId=t,this.database=e||"(default)"}function Br(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function zr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Kr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Xr,Hr,Wr,Qr=(li.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},li.prototype.has=function(t){return void 0!==this.get(t)},li.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},li.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},li.prototype.forEach=function(u){zr(this.l,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},li.prototype._=function(){return Kr(this.l)},li),Yr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Jr=(n(fi,Wr=Error),fi),$r=(ci.now=function(){return ci.fromMillis(Date.now())},ci.fromDate=function(t){return ci.fromMillis(t.getTime())},ci.fromMillis=function(t){var e=Math.floor(t/1e3);return new ci(e,1e6*(t-1e3*e))},ci.prototype.toDate=function(){return new Date(this.toMillis())},ci.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ci.prototype.T=function(t){return this.seconds===t.seconds?Vr(this.nanoseconds,t.nanoseconds):Vr(this.seconds,t.seconds)},ci.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ci.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ci.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ci),Zr=(hi.I=function(t){return new hi(t)},hi.min=function(){return new hi(new $r(0,0))},hi.prototype.o=function(t){return this.timestamp.T(t.timestamp)},hi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},hi.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},hi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},hi.prototype.A=function(){return this.timestamp},hi),ti=(Object.defineProperty(ai.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),ai.prototype.isEqual=function(t){return 0===ai.P(this,t)},ai.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ai?t.forEach(function(t){e.push(t)}):e.push(t),this.V(e)},ai.prototype.limit=function(){return this.offset+this.length},ai.prototype.g=function(t){return t=void 0===t?1:t,this.V(this.segments,this.offset+t,this.length-t)},ai.prototype.p=function(){return this.V(this.segments,this.offset,this.length-1)},ai.prototype.v=function(){return this.segments[this.offset]},ai.prototype.S=function(){return this.get(this.length-1)},ai.prototype.get=function(t){return this.segments[this.offset+t]},ai.prototype._=function(){return 0===this.length},ai.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ai.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ai.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ai.prototype.N=function(){return this.segments.slice(this.offset,this.limit())},ai.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ai),ei=(n(ui,Hr=ti),ui.prototype.V=function(t,e,n){return new ui(t,e,n)},ui.prototype.F=function(){return this.N().join("/")},ui.prototype.toString=function(){return this.F()},ui.k=function(t){if(0<=t.indexOf("//"))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new ui(t.split("/").filter(function(t){return 0<t.length}))},ui.$=function(){return new ui([])},ui),ni=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ri=(n(si,Xr=ti),si.prototype.V=function(t,e,n){return new si(t,e,n)},si.M=function(t){return ni.test(t)},si.prototype.F=function(){return this.N().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),si.M(t)||(t="`"+t+"`"),t}).join(".")},si.prototype.toString=function(){return this.F()},si.prototype.O=function(){return 1===this.length&&"__name__"===this.get(0)},si.L=function(){return new si(["__name__"])},si.q=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Jr(Yr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Jr(Yr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Jr(Yr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new si(e)},si.$=function(){return new si([])},si),ii=(oi.B=function(t){return new oi(ei.k(t).g(5))},oi.prototype.U=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},oi.prototype.isEqual=function(t){return null!==t&&0===ei.P(this.path,t.path)},oi.prototype.toString=function(){return this.path.toString()},oi.P=function(t,e){return ei.P(t.path,e.path)},oi.W=function(t){return t.length%2==0},oi.j=function(t){return new oi(new ei(t.slice()))},oi);function oi(t){this.path=t}function si(){return null!==Xr&&Xr.apply(this,arguments)||this}function ui(){return null!==Hr&&Hr.apply(this,arguments)||this}function ai(t,e,n){void 0===e?e=0:e>t.length&&Lr(),void 0===n?n=t.length-e:n>t.length-e&&Lr(),this.segments=t,this.offset=e,this.R=n}function hi(t){this.timestamp=t}function ci(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Jr(Yr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Jr(Yr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Jr(Yr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Jr(Yr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function fi(t,e){var n=this;return(n=Wr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function li(t,e){this.h=t,this.u=e,this.l={}}function pi(t){return null==t}function di(t){return-0===t&&1/t==-1/0}function yi(t){return"number"==typeof t&&Number.isInteger(t)&&!di(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var vi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.K=null};function gi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new vi(t,e,n,r,i,o,s)}function mi(t){var e,n=t;return null===n.K&&(e=n.path.F(),null!==n.collectionGroup&&(e+="|cg:"+n.collectionGroup),e+="|f:",e+=n.filters.map(function(t){return(e=t).field.F()+e.op.toString()+Eo(e.value);var e}).join(","),e+="|ob:",e+=n.orderBy.map(function(t){return(e=t).field.F()+e.dir;var e}).join(","),pi(n.limit)||(e+="|l:",e+=n.limit),n.startAt&&(e+="|lb:",e+=Zu(n.startAt)),n.endAt&&(e+="|ub:",e+=Zu(n.endAt)),n.K=e),n.K}function wi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!go(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ea(t.startAt,e.startAt)&&ea(t.endAt,e.endAt)}function bi(t){return ii.W(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ei=(Ii.fromBase64String=function(t){return new Ii(atob(t))},Ii.fromUint8Array=function(t){return new Ii(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Ii.prototype.toBase64=function(){return t=this.G,btoa(t);var t},Ii.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.G)},Ii.prototype.H=function(){return 2*this.G.length},Ii.prototype.o=function(t){return Vr(this.G,t.G)},Ii.prototype.isEqual=function(t){return this.G===t.G},Ii);function Ii(t){this.G=t}Ei.Y=new Ei("");function Ti(t){this.count=t}var Ni,Ai,_i=(Di.prototype.Z=function(t){return new Di(this.target,this.targetId,this.J,t,this.X,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Di.prototype.tt=function(t,e){return new Di(this.target,this.targetId,this.J,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Di.prototype.et=function(t){return new Di(this.target,this.targetId,this.J,this.sequenceNumber,this.X,t,this.resumeToken)},Di);function Di(t,e,n,r,i,o,s){void 0===i&&(i=Zr.min()),void 0===o&&(o=Zr.min()),void 0===s&&(s=Ei.Y),this.target=t,this.targetId=e,this.J=n,this.sequenceNumber=r,this.X=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Si(t){switch(t){case Yr.OK:return Lr(),0;case Yr.CANCELLED:case Yr.UNKNOWN:case Yr.DEADLINE_EXCEEDED:case Yr.RESOURCE_EXHAUSTED:case Yr.INTERNAL:case Yr.UNAVAILABLE:case Yr.UNAUTHENTICATED:return;case Yr.INVALID_ARGUMENT:case Yr.NOT_FOUND:case Yr.ALREADY_EXISTS:case Yr.PERMISSION_DENIED:case Yr.FAILED_PRECONDITION:case Yr.ABORTED:case Yr.OUT_OF_RANGE:case Yr.UNIMPLEMENTED:case Yr.DATA_LOSS:return 1;default:return Lr(),0}}function xi(t){if(void 0===t)return kr("GRPC error has no .code"),Yr.UNKNOWN;switch(t){case Ni.OK:return Yr.OK;case Ni.CANCELLED:return Yr.CANCELLED;case Ni.UNKNOWN:return Yr.UNKNOWN;case Ni.DEADLINE_EXCEEDED:return Yr.DEADLINE_EXCEEDED;case Ni.RESOURCE_EXHAUSTED:return Yr.RESOURCE_EXHAUSTED;case Ni.INTERNAL:return Yr.INTERNAL;case Ni.UNAVAILABLE:return Yr.UNAVAILABLE;case Ni.UNAUTHENTICATED:return Yr.UNAUTHENTICATED;case Ni.INVALID_ARGUMENT:return Yr.INVALID_ARGUMENT;case Ni.NOT_FOUND:return Yr.NOT_FOUND;case Ni.ALREADY_EXISTS:return Yr.ALREADY_EXISTS;case Ni.PERMISSION_DENIED:return Yr.PERMISSION_DENIED;case Ni.FAILED_PRECONDITION:return Yr.FAILED_PRECONDITION;case Ni.ABORTED:return Yr.ABORTED;case Ni.OUT_OF_RANGE:return Yr.OUT_OF_RANGE;case Ni.UNIMPLEMENTED:return Yr.UNIMPLEMENTED;case Ni.DATA_LOSS:return Yr.DATA_LOSS;default:return Lr()}}(Ai=Ni=Ni||{})[Ai.OK=0]="OK",Ai[Ai.CANCELLED=1]="CANCELLED",Ai[Ai.UNKNOWN=2]="UNKNOWN",Ai[Ai.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ai[Ai.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ai[Ai.NOT_FOUND=5]="NOT_FOUND",Ai[Ai.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ai[Ai.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ai[Ai.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ai[Ai.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ai[Ai.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ai[Ai.ABORTED=10]="ABORTED",Ai[Ai.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ai[Ai.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ai[Ai.INTERNAL=13]="INTERNAL",Ai[Ai.UNAVAILABLE=14]="UNAVAILABLE",Ai[Ai.DATA_LOSS=15]="DATA_LOSS";var ki=(Ci.prototype.nt=function(t,e){return new Ci(this.P,this.root.nt(t,e,this.P).copy(null,null,Pi.st,null,null))},Ci.prototype.remove=function(t){return new Ci(this.P,this.root.remove(t,this.P).copy(null,null,Pi.st,null,null))},Ci.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Ci.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Ci.prototype._=function(){return this.root._()},Object.defineProperty(Ci.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Ci.prototype.it=function(){return this.root.it()},Ci.prototype.rt=function(){return this.root.rt()},Ci.prototype.ot=function(t){return this.root.ot(t)},Ci.prototype.forEach=function(n){this.ot(function(t,e){return n(t,e),!1})},Ci.prototype.toString=function(){var n=[];return this.ot(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Ci.prototype.ht=function(t){return this.root.ht(t)},Ci.prototype.at=function(){return new Oi(this.root,null,this.P,!1)},Ci.prototype.ut=function(t){return new Oi(this.root,t,this.P,!1)},Ci.prototype.ct=function(){return new Oi(this.root,null,this.P,!0)},Ci.prototype.lt=function(t){return new Oi(this.root,t,this.P,!0)},Ci),Oi=(Ri.prototype.dt=function(){var t=this.ft.pop(),e={key:t.key,value:t.value};if(this._t)for(t=t.left;!t._();)this.ft.push(t),t=t.right;else for(t=t.right;!t._();)this.ft.push(t),t=t.left;return e},Ri.prototype.wt=function(){return 0<this.ft.length},Ri.prototype.Tt=function(){if(0===this.ft.length)return null;var t=this.ft[this.ft.length-1];return{key:t.key,value:t.value}},Ri),Pi=(Li.prototype.copy=function(t,e,n,r,i){return new Li(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Li.prototype._=function(){return!1},Li.prototype.ot=function(t){return this.left.ot(t)||t(this.key,this.value)||this.right.ot(t)},Li.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},Li.prototype.min=function(){return this.left._()?this:this.left.min()},Li.prototype.it=function(){return this.min().key},Li.prototype.rt=function(){return this.right._()?this.key:this.right.rt()},Li.prototype.nt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.nt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.nt(t,e,n))).Et()},Li.prototype.It=function(){if(this.left._())return Li.EMPTY;var t=this;return t.left.At()||t.left.left.At()||(t=t.Rt()),(t=t.copy(null,null,null,t.left.It(),null)).Et()},Li.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left._()||r.left.At()||r.left.left.At()||(r=r.Rt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.At()&&(r=r.Pt()),r.right._()||r.right.At()||r.right.left.At()||(r=r.Vt()),0===e(t,r.key)){if(r.right._())return Li.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.It())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Et()},Li.prototype.At=function(){return this.color},Li.prototype.Et=function(){var t=this;return t.right.At()&&!t.left.At()&&(t=t.gt()),t.left.At()&&t.left.left.At()&&(t=t.Pt()),t.left.At()&&t.right.At()&&(t=t.yt()),t},Li.prototype.Rt=function(){var t=this.yt();return t.right.left.At()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Pt())).gt()).yt()),t},Li.prototype.Vt=function(){var t=this.yt();return t.left.left.At()&&(t=(t=t.Pt()).yt()),t},Li.prototype.gt=function(){var t=this.copy(null,null,Li.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Li.prototype.Pt=function(){var t=this.copy(null,null,Li.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Li.prototype.yt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Li.prototype.pt=function(){var t=this.bt();return Math.pow(2,t)<=this.size+1},Li.prototype.bt=function(){if(this.At()&&this.left.At())throw Lr();if(this.right.At())throw Lr();var t=this.left.bt();if(t!==this.right.bt())throw Lr();return t+(this.At()?0:1)},Li);function Li(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Li.RED,this.left=null!=r?r:Li.EMPTY,this.right=null!=i?i:Li.EMPTY,this.size=this.left.size+1+this.right.size}function Ri(t,e,n,r){this._t=r,this.ft=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this._t?t.left:t.right;else{if(0===i){this.ft.push(t);break}this.ft.push(t),t=this._t?t.right:t.left}}function Ci(t,e){this.P=t,this.root=e||Pi.EMPTY}function Ui(){this.size=0}Pi.EMPTY=null,Pi.RED=!0,Pi.st=!1,Pi.EMPTY=(Object.defineProperty(Ui.prototype,"key",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(Ui.prototype,"value",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(Ui.prototype,"color",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(Ui.prototype,"left",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(Ui.prototype,"right",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Ui.prototype.copy=function(t,e,n,r,i){return this},Ui.prototype.nt=function(t,e,n){return new Pi(t,e)},Ui.prototype.remove=function(t,e){return this},Ui.prototype._=function(){return!0},Ui.prototype.ot=function(t){return!1},Ui.prototype.ht=function(t){return!1},Ui.prototype.it=function(){return null},Ui.prototype.rt=function(){return null},Ui.prototype.At=function(){return!1},Ui.prototype.pt=function(){return!0},Ui.prototype.bt=function(){return 0},new Ui);var Vi=(qi.prototype.has=function(t){return null!==this.data.get(t)},qi.prototype.first=function(){return this.data.it()},qi.prototype.last=function(){return this.data.rt()},Object.defineProperty(qi.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),qi.prototype.indexOf=function(t){return this.data.indexOf(t)},qi.prototype.forEach=function(n){this.data.ot(function(t,e){return n(t),!1})},qi.prototype.vt=function(t,e){for(var n=this.data.ut(t[0]);n.wt();){var r=n.dt();if(0<=this.P(r.key,t[1]))return;e(r.key)}},qi.prototype.St=function(t,e){for(var n=void 0!==e?this.data.ut(e):this.data.at();n.wt();)if(!t(n.dt().key))return},qi.prototype.Dt=function(t){var e=this.data.ut(t);return e.wt()?e.dt().key:null},qi.prototype.at=function(){return new Mi(this.data.at())},qi.prototype.ut=function(t){return new Mi(this.data.ut(t))},qi.prototype.add=function(t){return this.copy(this.data.remove(t).nt(t,!0))},qi.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},qi.prototype._=function(){return this.data._()},qi.prototype.Ct=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},qi.prototype.isEqual=function(t){if(!(t instanceof qi))return!1;if(this.size!==t.size)return!1;for(var e=this.data.at(),n=t.data.at();e.wt();){var r=e.dt().key,i=n.dt().key;if(0!==this.P(r,i))return!1}return!0},qi.prototype.N=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},qi.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},qi.prototype.copy=function(t){var e=new qi(this.P);return e.data=t,e},qi),Mi=(ji.prototype.dt=function(){return this.Nt.dt().key},ji.prototype.wt=function(){return this.Nt.wt()},ji),Fi=new ki(ii.P);function ji(t){this.Nt=t}function qi(t){this.P=t,this.data=new ki(this.P)}var Gi=new ki(ii.P);var Bi=new ki(ii.P),zi=new Vi(ii.P);function Ki(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=zi,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Xi=new Vi(Vr);function Hi(t,e,n,r){this.Zt=t,this.removedTargetIds=e,this.key=n,this.te=r}function Wi(t,e){this.targetId=t,this.ee=e}function Qi(t,e,n,r){void 0===n&&(n=Ei.Y),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Yi=(ho.xt=function(t){return new ho(t.P)},ho.prototype.has=function(t){return null!=this.Ft.get(t)},ho.prototype.get=function(t){return this.Ft.get(t)},ho.prototype.first=function(){return this.kt.it()},ho.prototype.last=function(){return this.kt.rt()},ho.prototype._=function(){return this.kt._()},ho.prototype.indexOf=function(t){var e=this.Ft.get(t);return e?this.kt.indexOf(e):-1},Object.defineProperty(ho.prototype,"size",{get:function(){return this.kt.size},enumerable:!1,configurable:!0}),ho.prototype.forEach=function(n){this.kt.ot(function(t,e){return n(t),!1})},ho.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ft.nt(t.key,t),e.kt.nt(t,null))},ho.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ft.remove(t),this.kt.remove(e)):this},ho.prototype.isEqual=function(t){if(!(t instanceof ho))return!1;if(this.size!==t.size)return!1;for(var e=this.kt.at(),n=t.kt.at();e.wt();){var r=e.dt().key,i=n.dt().key;if(!r.isEqual(i))return!1}return!0},ho.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ho.prototype.copy=function(t,e){var n=new ho;return n.P=this.P,n.Ft=t,n.kt=e,n},ho),Ji=(ao.prototype.track=function(t){var e=t.doc.key,n=this.$t.get(e);!n||0!==t.type&&3===n.type?this.$t=this.$t.nt(e,t):3===t.type&&1!==n.type?this.$t=this.$t.nt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.$t=this.$t.nt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.$t=this.$t.nt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.$t=this.$t.remove(e):1===t.type&&2===n.type?this.$t=this.$t.nt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.$t=this.$t.nt(e,{type:2,doc:t.doc}):Lr()},ao.prototype.Mt=function(){var n=[];return this.$t.ot(function(t,e){n.push(e)}),n},ao),$i=(uo.Ut=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new uo(t,e,Yi.xt(e),i,n,r,!0,!1)},Object.defineProperty(uo.prototype,"hasPendingWrites",{get:function(){return!this.Lt._()},enumerable:!1,configurable:!0}),uo.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.qt===t.qt&&this.Lt.isEqual(t.Lt)&&Iu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ot.isEqual(t.Ot)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},uo),Zi=(so.Gt=function(t,e){var n=new Map;return n.set(t,to.zt(t,e)),new so(Zr.min(),n,Xi,Fi,Ki())},so),to=(oo.zt=function(t,e){return new oo(Ei.Y,e,Ki(),Ki(),Ki())},oo),eo=(Object.defineProperty(io.prototype,"Ht",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(io.prototype,"resumeToken",{get:function(){return this.ie},enumerable:!1,configurable:!0}),Object.defineProperty(io.prototype,"he",{get:function(){return 0!==this.ne},enumerable:!1,configurable:!0}),Object.defineProperty(io.prototype,"ae",{get:function(){return this.oe},enumerable:!1,configurable:!0}),io.prototype.ue=function(t){0<t.H()&&(this.oe=!0,this.ie=t)},io.prototype.ce=function(){var n=Ki(),r=Ki(),i=Ki();return this.se.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Lr()}}),new to(this.ie,this.re,n,r,i)},io.prototype.le=function(){this.oe=!1,this.se=fo()},io.prototype._e=function(t,e){this.oe=!0,this.se=this.se.nt(t,e)},io.prototype.fe=function(t){this.oe=!0,this.se=this.se.remove(t)},io.prototype.de=function(){this.ne+=1},io.prototype.we=function(){--this.ne},io.prototype.Te=function(){this.oe=!0,this.re=!0},io),no=(ro.prototype.Pe=function(t){for(var e=0,n=t.Zt;e<n.length;e++){var r=n[e];t.te instanceof ou?this.Ve(r,t.te):t.te instanceof su&&this.ge(r,t.key,t.te)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ge(s,t.key,t.te)}},ro.prototype.ye=function(n){var r=this;this.pe(n,function(t){var e=r.be(t);switch(n.state){case 0:r.ve(t)&&e.ue(n.resumeToken);break;case 1:e.we(),e.he||e.le(),e.ue(n.resumeToken);break;case 2:e.we(),e.he||r.removeTarget(t);break;case 3:r.ve(t)&&(e.Te(),e.ue(n.resumeToken));break;case 4:r.ve(t)&&(r.Se(t),e.ue(n.resumeToken));break;default:Lr()}})},ro.prototype.pe=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ie.forEach(function(t,e){r.ve(e)&&n(e)})},ro.prototype.De=function(t){var e,n,r=t.targetId,i=t.ee.count,o=this.Ce(r);o&&(bi(e=o.target)?0===i?(n=new ii(e.path),this.ge(r,n,new su(n,Zr.min()))):Rr(1===i):this.Ne(r)!==i&&(this.Se(r),this.Re=this.Re.add(r)))},ro.prototype.Fe=function(i){var o=this,s=new Map;this.Ie.forEach(function(t,e){var n,r=o.Ce(e);r&&(t.Ht&&bi(r.target)&&(n=new ii(r.target.path),null!==o.me.get(n)||o.ke(e,n)||o.ge(e,n,new su(n,i))),t.ae&&(s.set(e,t.ce()),t.le()))});var r=Ki();this.Ae.forEach(function(t,e){var n=!0;e.St(function(t){var e=o.Ce(t);return!e||2===e.J||(n=!1)}),n&&(r=r.add(t))});var t=new Zi(i,s,this.Re,this.me,r);return this.me=Fi,this.Ae=co(),this.Re=new Vi(Vr),t},ro.prototype.Ve=function(t,e){var n;this.ve(t)&&(n=this.ke(t,e.key)?2:0,this.be(t)._e(e.key,n),this.me=this.me.nt(e.key,e),this.Ae=this.Ae.nt(e.key,this.xe(e.key).add(t)))},ro.prototype.ge=function(t,e,n){var r;this.ve(t)&&(r=this.be(t),this.ke(t,e)?r._e(e,1):r.fe(e),this.Ae=this.Ae.nt(e,this.xe(e).delete(t)),n&&(this.me=this.me.nt(e,n)))},ro.prototype.removeTarget=function(t){this.Ie.delete(t)},ro.prototype.Ne=function(t){var e=this.be(t).ce();return this.Ee.$e(t).size+e.Yt.size-e.Xt.size},ro.prototype.de=function(t){this.be(t).de()},ro.prototype.be=function(t){var e=this.Ie.get(t);return e||(e=new eo,this.Ie.set(t,e)),e},ro.prototype.xe=function(t){var e=this.Ae.get(t);return e||(e=new Vi(Vr),this.Ae=this.Ae.nt(t,e)),e},ro.prototype.ve=function(t){var e=null!==this.Ce(t);return e||xr("WatchChangeAggregator","Detected inactive target",t),e},ro.prototype.Ce=function(t){var e=this.Ie.get(t);return e&&e.he?null:this.Ee.Me(t)},ro.prototype.Se=function(e){var n=this;this.Ie.set(e,new eo),this.Ee.$e(e).forEach(function(t){n.ge(e,t,null)})},ro.prototype.ke=function(t,e){return this.Ee.$e(t).has(e)},ro);function ro(t){this.Ee=t,this.Ie=new Map,this.me=Fi,this.Ae=co(),this.Re=new Vi(Vr)}function io(){this.ne=0,this.se=fo(),this.ie=Ei.Y,this.re=!1,this.oe=!0}function oo(t,e,n,r,i){this.resumeToken=t,this.Ht=e,this.Yt=n,this.Jt=r,this.Xt=i}function so(t,e,n,r,i){this.X=t,this.Qt=e,this.Wt=n,this.jt=r,this.Kt=i}function uo(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ot=n,this.docChanges=r,this.Lt=i,this.fromCache=o,this.qt=s,this.Bt=u}function ao(){this.$t=new ki(ii.P)}function ho(n){this.P=n?function(t,e){return n(t,e)||ii.P(t.key,e.key)}:function(t,e){return ii.P(t.key,e.key)},this.Ft=Gi,this.kt=new ki(this.P)}function co(){return new ki(ii.P)}function fo(){return new ki(ii.P)}function lo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function po(t){var e=Io(t.mapValue.fields.__local_write_time__.timestampValue);return new $r(e.seconds,e.nanos)}var yo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?lo(t)?4:10:Lr()}function go(r,i){var t,e,n,o=vo(r);if(o!==vo(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return po(r).isEqual(po(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=Io(r.timestampValue),n=Io(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,No(r.bytesValue).isEqual(No(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,To((t=r).geoPointValue.latitude)===To(e.geoPointValue.latitude)&&To(t.geoPointValue.longitude)===To(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return To(t.integerValue)===To(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=To(t.doubleValue),r=To(e.doubleValue);return n===r?di(n)===di(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Mr(r.arrayValue.values||[],i.arrayValue.values||[],go);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Br(t)!==Br(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!go(t[n],e[n])))return!1;return!0}();default:return Lr()}}function mo(t,e){return void 0!==(t.values||[]).find(function(t){return go(t,e)})}function wo(t,e){var n,r,i,o,s,u,a,h,c,f,l=vo(t),p=vo(e);if(l!==p)return Vr(l,p);switch(l){case 0:return 0;case 1:return Vr(t.booleanValue,e.booleanValue);case 2:return h=e,c=To(t.integerValue||t.doubleValue),f=To(h.integerValue||h.doubleValue),c<f?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return bo(t.timestampValue,e.timestampValue);case 4:return bo(po(t),po(e));case 5:return Vr(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=No(o),a=No(s),u.o(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Vr(n[i],r[i]);if(0!==o)return o}return Vr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Vr(To(n.latitude),To(r.latitude)))?i:Vr(To(n.longitude),To(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=wo(n[i],r[i]);if(o)return o}return Vr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Vr(r[s],o[s]);if(0!==u)return u;var a=wo(n[r[s]],i[o[s]]);if(0!==a)return a}return Vr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Lr()}}function bo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Vr(t,e);var n=Io(t),r=Io(e),i=Vr(n.seconds,r.seconds);return 0!==i?i:Vr(n.nanos,r.nanos)}function Eo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=Io(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?No(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,ii.B(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Lr();var t,e,n}(t)}function Io(t){if(Rr(!!t),"string"!=typeof t)return{seconds:To(t.seconds),nanos:To(t.nanos)};var e,n=0,r=yo.exec(t);Rr(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function To(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function No(t){return"string"==typeof t?Ei.fromBase64String(t):Ei.fromUint8Array(t)}function Ao(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.F()}}function _o(t){return t&&"integerValue"in t}function Do(t){return!!t&&"arrayValue"in t}function So(t){return t&&"nullValue"in t}function xo(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ko(t){return t&&"mapValue"in t}var Oo={asc:"ASCENDING",desc:"DESCENDING"},Po={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Lo=function(t,e){this.s=t,this.Oe=e};function Ro(t){return{integerValue:""+t}}function Co(t,e){if(t.Oe){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:di(e)?"-0":e}}function Uo(t,e){return yi(e)?Ro(e):Co(t,e)}function Vo(t,e){return t.Oe?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Mo(t,e){return t.Oe?e.toBase64():e.toUint8Array()}function Fo(t){return Rr(!!t),Zr.I((e=Io(t),new $r(e.seconds,e.nanos)));var e}function jo(t,e){return new ei(["projects",t.projectId,"databases",t.database]).child("documents").child(e).F()}function qo(t){var e=ei.k(t);return Rr(rs(e)),e}function Go(t,e){return jo(t.s,e.path)}function Bo(t,e){var n=qo(e);return Rr(n.get(1)===t.s.projectId),Rr(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new ii(Ho(n))}function zo(t,e){return jo(t.s,e)}function Ko(t){var e=qo(t);return 4===e.length?ei.$():Ho(e)}function Xo(t){return new ei(["projects",t.s.projectId,"databases",t.s.database]).F()}function Ho(t){return Rr(4<t.length&&"documents"===t.get(4)),t.g(5)}function Wo(t,e,n){return{name:Go(t,e),fields:n.proto.mapValue.fields}}function Qo(t,e){var n,r,i,o,s,u;if(e instanceof Us)n={update:Wo(t,e.key,e.value)};else if(e instanceof Hs)n={delete:Go(t,e.key)};else if(e instanceof Vs)n={update:Wo(t,e.key,e.data),updateMask:(r=e.Le,i=[],r.fields.forEach(function(t){return i.push(t.F())}),{fieldPaths:i})};else if(e instanceof Gs)n={transform:{document:Go(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof as)return{fieldPath:t.field.F(),setToServerValue:"REQUEST_TIME"};if(e instanceof hs)return{fieldPath:t.field.F(),appendMissingElements:{values:e.elements}};if(e instanceof ds)return{fieldPath:t.field.F(),removeAllFromArray:{values:e.elements}};if(e instanceof ms)return{fieldPath:t.field.F(),increment:e.qe};throw Lr()})}};else{if(!(e instanceof Ws))return Lr();n={verify:Go(t,e.key)}}return e.Ue.Be||(n.currentDocument=void 0!==(o=e.Ue).updateTime?{updateTime:(s=t,u=o.updateTime,Vo(s,u.A()))}:void 0!==o.exists?{exists:o.exists}:Lr()),n}function Yo(e,t){var n,r,i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?_s.updateTime(Fo(n.updateTime)):void 0!==n.exists?_s.exists(n.exists):_s.Qe():_s.Qe();if(t.update){t.update.name;var o=Bo(e,t.update.name),s=new Qs({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=(r=t.updateMask.fieldPaths||[],new Is(r.map(function(t){return ri.q(t)})));return new Vs(o,s,u,i)}return new Us(o,s,i)}if(t.delete){var a=Bo(e,t.delete);return new Hs(a,i)}if(t.transform){var h=Bo(e,t.transform.document),c=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r,i=null;"setToServerValue"in e?(Rr("REQUEST_TIME"===e.setToServerValue),i=new as):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],i=new hs(n)):"removeAllFromArray"in e?(r=e.removeAllFromArray.values||[],i=new ds(r)):"increment"in e?i=new ms(t,e.increment):Lr();var o=ri.q(e.fieldPath);return new Ts(o,i)}(e,t)});return Rr(!0===i.exists),new Gs(h,c)}if(t.verify){var f=Bo(e,t.verify);return new Ws(f,i)}return Lr()}function Jo(t,e){return{documents:[zo(t,e.path)]}}function $o(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=zo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=zo(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){if("=="===t.op){if(xo(t.value))return{unaryFilter:{field:es(t.field),op:"IS_NAN"}};if(So(t.value))return{unaryFilter:{field:es(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(xo(t.value))return{unaryFilter:{field:es(t.field),op:"IS_NOT_NAN"}};if(So(t.value))return{unaryFilter:{field:es(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:es(t.field),op:(e=t.op,Po[e]),value:t.value}};var e});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return{field:es((e=t).field),direction:(n=e.dir,Oo[n])};var e,n})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u=(s=e.limit,t.Oe||pi(s)?s:{value:s});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Zo(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Zo(e.endAt)),n}function Zo(t){return{before:t.before,values:t.position}}function ts(t){var e=!!t.before,n=t.values||[];return new Wu(n,e)}function es(t){return{fieldPath:t.F()}}function ns(t){return ri.q(t.fieldPath)}function rs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function is(){this.We=void 0}function os(t,e){return t instanceof ms?_o(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var ss,us,as=(n(fs,us=is),fs),hs=(n(cs,ss=is),cs);function cs(t){var e=this;return(e=ss.call(this)||this).elements=t,e}function fs(){return null!==us&&us.apply(this,arguments)||this}function ls(t,e){for(var n=Es(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return go(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var ps,ds=(n(ys,ps=is),ys);function ys(t){var e=this;return(e=ps.call(this)||this).elements=t,e}function vs(t,e){for(var n=Es(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!go(t,e)})}(i[r]);return{arrayValue:{values:n}}}var gs,ms=(n(ws,gs=is),ws);function ws(t,e){var n=this;return(n=gs.call(this)||this).serializer=t,n.qe=e,n}function bs(t){return To(t.integerValue||t.doubleValue)}function Es(t){return Do(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Is=(Ns.prototype.je=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},Ns.prototype.isEqual=function(t){return Mr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Ns),Ts=function(t,e){this.field=t,this.transform=e};function Ns(t){(this.fields=t).sort(ri.P)}function As(t,e){this.version=t,this.transformResults=e}var _s=(Ds.Qe=function(){return new Ds},Ds.exists=function(t){return new Ds(void 0,t)},Ds.updateTime=function(t){return new Ds(t)},Object.defineProperty(Ds.prototype,"Be",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Ds.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Ds);function Ds(t,e){this.updateTime=t,this.exists=e}function Ss(t,e){return void 0!==t.updateTime?e instanceof ou&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof ou}function xs(){}function ks(t,e,n){return t instanceof Us?new ou(t.key,n.version,t.value,{hasCommittedMutations:!0}):t instanceof Vs?function(t,e,n){if(!Ss(t.Ue,e))return new uu(t.key,n.version);var r=js(t,e);return new ou(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Gs?function(t,e,n){if(Rr(null!=n.transformResults),!Ss(t.Ue,e))return new uu(t.key,n.version);var r=e,i=function(t,e,n){var r=[];Rr(t.length===n.length);for(var i,o,s,u=0;u<n.length;u++){var a=t[u],h=a.transform,c=null;e instanceof ou&&(c=e.field(a.field)),r.push((i=h,o=c,s=n[u],i instanceof hs?ls(i,o):i instanceof ds?vs(i,o):s))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=zs(t,r.data(),i);return new ou(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):new su(t.key,n.version,{hasCommittedMutations:!0})}function Os(t,e,n,r){return t instanceof Us?function(t,e){if(!Ss(t.Ue,e))return e;var n=Ls(e);return new ou(t.key,n,t.value,{Ke:!0})}(t,e):t instanceof Vs?function(t,e){if(!Ss(t.Ue,e))return e;var n=Ls(e),r=js(t,e);return new ou(t.key,n,r,{Ke:!0})}(t,e):t instanceof Gs?function(t,e,n,r){if(!Ss(t.Ue,e))return e;var i=e,o=function(t,e,n,r){for(var i,o,s,u,a,h,c,f=[],l=0,p=t;l<p.length;l++){var d=p[l],y=d.transform,v=null;n instanceof ou&&(v=n.field(d.field)),null===v&&r instanceof ou&&(v=r.field(d.field)),f.push((o=v,s=e,c=h=a=u=void 0,(i=y)instanceof as?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}},o&&(c.fields.__previous_value__=o),{mapValue:c}):i instanceof hs?ls(i,o):i instanceof ds?vs(i,o):(a=os(u=i,o),h=bs(a)+bs(u.qe),_o(a)&&_o(u.qe)?Ro(h):Co(u.serializer,h))))}return f}(t.fieldTransforms,n,e,r),s=zs(t,i.data(),o);return new ou(t.key,i.version,s,{Ke:!0})}(t,e,r,n):(o=e,Ss((i=t).Ue,o)?new su(i.key,Zr.min()):o);var i,o}function Ps(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ue.isEqual(e.Ue)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Le.isEqual(e.Le):2!==t.type||Mr(t.fieldTransforms,t.fieldTransforms,function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof hs&&o instanceof hs||i instanceof ds&&o instanceof ds?Mr(i.elements,o.elements,go):i instanceof ms&&o instanceof ms?go(i.qe,o.qe):i instanceof as&&o instanceof as);var n,r,i,o}))}function Ls(t){return t instanceof ou?t.version:Zr.min()}var Rs,Cs,Us=(n(Fs,Cs=xs),Fs),Vs=(n(Ms,Rs=xs),Ms);function Ms(t,e,n,r){var i=this;return(i=Rs.call(this)||this).key=t,i.data=e,i.Le=n,i.Ue=r,i.type=1,i}function Fs(t,e,n){var r=this;return(r=Cs.call(this)||this).key=t,r.value=e,r.Ue=n,r.type=0,r}function js(t,e){return n=t,r=e instanceof ou?e.data():Qs.empty(),i=new Ys(r),n.Le.fields.forEach(function(t){var e;t._()||(null!==(e=n.data.field(t))?i.set(t,e):i.delete(t))}),i.Ge();var n,r,i}var qs,Gs=(n(Bs,qs=xs),Bs);function Bs(t,e){var n=this;return(n=qs.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ue=_s.exists(!0),n}function zs(t,e,n){for(var r=new Ys(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Ge()}var Ks,Xs,Hs=(n(tu,Xs=xs),tu),Ws=(n(Zs,Ks=xs),Zs),Qs=($s.empty=function(){return new $s({mapValue:{}})},$s.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!ko(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},$s.prototype.isEqual=function(t){return go(this.proto,t.proto)},$s),Ys=(Js.prototype.set=function(t,e){return this.Ye(t,e),this},Js.prototype.delete=function(t){return this.Ye(t,null),this},Js.prototype.Ye=function(t,e){for(var n=this.He,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===vo(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.S(),e)},Js.prototype.Ge=function(){var t=this.Je(ri.$(),this.He);return null!=t?new Qs(t):this.ze},Js.prototype.Je=function(r,t){var i=this,o=!1,e=this.ze.field(r),s=ko(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.Je(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Js);function Js(t){void 0===t&&(t=Qs.empty()),this.ze=t,this.He=new Map}function $s(t){this.proto=t}function Zs(t,e){var n=this;return(n=Ks.call(this)||this).key=t,n.Ue=e,n.type=4,n}function tu(t,e){var n=this;return(n=Xs.call(this)||this).key=t,n.Ue=e,n.type=3,n}function eu(t,e){this.key=t,this.version=e}var nu,ru,iu,ou=(n(cu,iu=eu),cu.prototype.field=function(t){return this.Xe.field(t)},cu.prototype.data=function(){return this.Xe},cu.prototype.Ze=function(){return this.Xe.proto},cu.prototype.isEqual=function(t){return t instanceof cu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ke===t.Ke&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Xe.isEqual(t.Xe)},cu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Xe.toString()+", {hasLocalMutations: "+this.Ke+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(cu.prototype,"hasPendingWrites",{get:function(){return this.Ke||this.hasCommittedMutations},enumerable:!1,configurable:!0}),cu),su=(n(hu,ru=eu),hu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(hu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),hu.prototype.isEqual=function(t){return t instanceof hu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},hu),uu=(n(au,nu=eu),au.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(au.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),au.prototype.isEqual=function(t){return t instanceof au&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},au);function au(){return null!==nu&&nu.apply(this,arguments)||this}function hu(t,e,n){var r=this;return(r=ru.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function cu(t,e,n,r){var i=this;return(i=iu.call(this,t,e)||this).Xe=n,i.Ke=!!r.Ke,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function fu(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new Jr(Yr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass '"+e.name+"' from a different Firestore SDK?"):new Jr(Yr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but was '"+t.constructor.name+"'");return t}var lu=(pu.prototype.rn=function(t){return new pu(t,null,this.tn.slice(),this.filters.slice(),this.limit,this.en,this.startAt,this.endAt)},pu.prototype.on=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.tn.length||1===this.tn.length&&this.tn[0].field.O())},pu.prototype.hn=function(){return!pi(this.limit)&&"F"===this.en},pu.prototype.an=function(){return!pi(this.limit)&&"L"===this.en},pu.prototype.un=function(){return 0<this.tn.length?this.tn[0].field:null},pu.prototype.cn=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n.ln())return n.field}return null},pu.prototype._n=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(0<=t.indexOf(r.op))return r.op}return null},pu);function pu(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.tn=n,this.filters=r,this.limit=i,this.en=o,this.startAt=s,this.endAt=u,this.nn=null,this.sn=null,this.startAt,this.endAt}function du(t,e,n,r,i,o,s,u){return new lu(t,e,n,r,i,o,s,u)}function yu(t){return new lu(t)}function vu(t){return null!==t.collectionGroup}function gu(t){var e=fu(t,lu);if(null===e.nn){e.nn=[];var n=e.cn(),r=e.un();if(null!==n&&null===r)n.O()||e.nn.push(new na(n)),e.nn.push(new na(ri.L(),"asc"));else{for(var i,o=!1,s=0,u=e.tn;s<u.length;s++){var a=u[s];e.nn.push(a),a.field.O()&&(o=!0)}o||(i=0<e.tn.length?e.tn[e.tn.length-1].dir:"asc",e.nn.push(new na(ri.L(),i)))}}return e.nn}function mu(t){var e=fu(t,lu);if(!e.sn)if("F"===e.en)e.sn=gi(e.path,e.collectionGroup,gu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=gu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new na(o.field,s))}var u=e.endAt?new Wu(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Wu(e.startAt.position,!e.startAt.before):null;e.sn=gi(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.sn}function wu(t,e,n){return new lu(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function bu(t,e){return new lu(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),t.limit,t.en,e,t.endAt)}function Eu(t,e){return new lu(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),t.limit,t.en,t.startAt,e)}function Iu(t,e){return wi(mu(t),mu(e))&&t.en===e.en}function Tu(t){return mi(mu(t))+"|lt:"+t.en}function Nu(t){return"Query(target="+(e=mu(t),n=e.path.F(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(e=t).field.F()+" "+e.op+" "+Eo(e.value);var e}).join(", ")+"]"),pi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(e=t).field.F()+" ("+e.dir+")";var e}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Zu(e.startAt)),e.endAt&&(n+=", endAt: "+Zu(e.endAt)),"Target("+n+")")+"; limitType="+t.en+")";var e,n}function Au(i,t){return r=i,o=t.key.path,(null!==r.collectionGroup?t.key.U(r.collectionGroup)&&r.path.D(o):ii.W(r.path)?r.path.isEqual(o):r.path.C(o))&&function(t){for(var e=0,n=i.tn;e<n.length;e++){var r=n[e];if(!r.field.O()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(e=i).startAt||ta(e.startAt,gu(e),n))&&(!e.endAt||!ta(e.endAt,gu(e),n)));var e,n,r,o}function _u(u){return function(t,e){for(var n=!1,r=0,i=gu(u);r<i.length;r++){var o=i[r],s=function(t,i,e){var n=t.field.O()?ii.P(i.key,e.key):function(t,e){var n=i.field(t),r=e.field(t);return null!==n&&null!==r?wo(n,r):Lr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Lr()}}(o,t,e);if(0!==s)return s;n=n||o.field.O()}return 0}}var Du,Su=(n(xu,Du=function(){}),xu.create=function(t,e,n){if(t.O())return"in"===e||"not-in"===e?this.fn(t,e,n):new Lu(t,e,n);if(So(n)){if("=="!==e&&"!="!==e)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new xu(t,e,n)}if(xo(n)){if("=="!==e&&"!="!==e)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new xu(t,e,n)}return"array-contains"===e?new zu(t,n):"in"===e?new Ku(t,n):"not-in"===e?new Xu(t,n):"array-contains-any"===e?new Hu(t,n):new xu(t,e,n)},xu.fn=function(t,e,n){return new("in"===e?Ru:Cu)(t,n)},xu.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.dn(wo(e,this.value)):null!==e&&vo(this.value)===vo(e)&&this.dn(wo(e,this.value))},xu.prototype.dn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Lr()}},xu.prototype.ln=function(){return 0<=["<","<=",">",">=","!="].indexOf(this.op)},xu);function xu(t,e,n){var r=this;return(r=Du.call(this)||this).field=t,r.op=e,r.value=n,r}var ku,Ou,Pu,Lu=(n(Mu,Pu=Su),Mu.prototype.matches=function(t){var e=ii.P(t.key,this.key);return this.dn(e)},Mu),Ru=(n(Vu,Ou=Su),Vu.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Vu),Cu=(n(Uu,ku=Su),Uu.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Uu);function Uu(t,e){var n=this;return(n=ku.call(this,t,"not-in",e)||this).keys=Fu(0,e),n}function Vu(t,e){var n=this;return(n=Ou.call(this,t,"in",e)||this).keys=Fu(0,e),n}function Mu(t,e,n){var r=this;return(r=Pu.call(this,t,e,n)||this).key=ii.B(n.referenceValue),r}function Fu(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return ii.B(t.referenceValue)})}var ju,qu,Gu,Bu,zu=(n($u,Bu=Su),$u.prototype.matches=function(t){var e=t.field(this.field);return Do(e)&&mo(e.arrayValue,this.value)},$u),Ku=(n(Ju,Gu=Su),Ju.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&mo(this.value.arrayValue,e)},Ju),Xu=(n(Yu,qu=Su),Yu.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&!mo(this.value.arrayValue,e)},Yu),Hu=(n(Qu,ju=Su),Qu.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Do(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return mo(e.value.arrayValue,t)})},Qu),Wu=function(t,e){this.position=t,this.before=e};function Qu(t,e){return ju.call(this,t,"array-contains-any",e)||this}function Yu(t,e){return qu.call(this,t,"not-in",e)||this}function Ju(t,e){return Gu.call(this,t,"in",e)||this}function $u(t,e){return Bu.call(this,t,"array-contains",e)||this}function Zu(t){return(t.before?"b":"a")+":"+t.position.map(Eo).join(",")}function ta(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.O()?ii.P(ii.B(s.referenceValue),n.key):wo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ea(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!go(t.position[n],e.position[n]))return!1;return!0}var na=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};var ra=(wa.prototype.Tn=function(t,e,n){for(var r=n.En,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=ks(o,e,r[i]))}return e},wa.prototype.In=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Os(i,e,e,this.wn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Os(a,e,o,this.wn))}return e},wa.prototype.mn=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.In(t.key,n.get(t.key));e&&(i=i.nt(t.key,e))}),i},wa.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ki())},wa.prototype.isEqual=function(t){return this.batchId===t.batchId&&Mr(this.mutations,t.mutations,Ps)&&Mr(this.baseMutations,t.baseMutations,Ps)},wa),ia=(ma.from=function(t,e,n){Rr(t.mutations.length===n.length);for(var r=Bi,i=t.mutations,o=0;o<i.length;o++)r=r.nt(i[o].key,n[o].version);return new ma(t,e,n,r)},ma),oa=(ga.prototype.catch=function(t){return this.next(void 0,t)},ga.prototype.next=function(r,i){var o=this;return this.yn&&Lr(),this.yn=!0,this.gn?this.error?this.pn(i,this.error):this.bn(r,this.result):new ga(function(e,n){o.Pn=function(t){o.bn(r,t).next(e,n)},o.Vn=function(t){o.pn(i,t).next(e,n)}})},ga.prototype.vn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},ga.prototype.Sn=function(t){try{var e=t();return e instanceof ga?e:ga.resolve(e)}catch(t){return ga.reject(t)}},ga.prototype.bn=function(t,e){return t?this.Sn(function(){return t(e)}):ga.resolve(e)},ga.prototype.pn=function(t,e){return t?this.Sn(function(){return t(e)}):ga.reject(e)},ga.resolve=function(n){return new ga(function(t,e){t(n)})},ga.reject=function(n){return new ga(function(t,e){e(n)})},ga.Dn=function(t){return new ga(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},ga.Cn=function(t){for(var n=ga.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?ga.resolve(t):e()})}(r[e]);return n},ga.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Dn(i)},ga),sa=(Object.defineProperty(va.prototype,"readTime",{get:function(){return this.kn},set:function(t){this.kn=t},enumerable:!1,configurable:!0}),va.prototype.xn=function(t,e){this.$n(),this.readTime=e,this.Nn.set(t.key,t)},va.prototype.Mn=function(t,e){this.$n(),e&&(this.readTime=e),this.Nn.set(t,null)},va.prototype.On=function(t,e){this.$n();var n=this.Nn.get(e);return void 0!==n?oa.resolve(n):this.Ln(t,e)},va.prototype.getEntries=function(t,e){return this.qn(t,e)},va.prototype.apply=function(t){return this.$n(),this.Fn=!0,this.Bn(t)},va.prototype.$n=function(){},va),ua="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",aa=(ya.prototype.Qn=function(t){this.Un.push(t)},ya.prototype.Wn=function(){this.Un.forEach(function(t){return t()})},ya),ha=(da.prototype.zn=function(e,n){var r=this;return this.Kn.Hn(e,n).next(function(t){return r.Yn(e,n,t)})},da.prototype.Yn=function(t,r,i){return this.jn.On(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].In(r,t);return t})},da.prototype.Jn=function(t,e,i){var o=Fi;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].In(t,e);o=o.nt(t,e)}),o},da.prototype.Xn=function(e,t){var n=this;return this.jn.getEntries(e,t).next(function(t){return n.Zn(e,t)})},da.prototype.Zn=function(r,i){var o=this;return this.Kn.ts(r,i).next(function(t){var e=o.Jn(r,i,t),n=Fi;return e.forEach(function(t,e){e=e||new su(t,Zr.min()),n=n.nt(t,e)}),n})},da.prototype.es=function(t,e,n){return r=e,ii.W(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.ns(t,e.path):vu(e)?this.ss(t,e,n):this.rs(t,e,n);var r},da.prototype.ns=function(t,e){return this.zn(t,new ii(e)).next(function(t){var e=Gi;return t instanceof ou&&(e=e.nt(t.key,t)),e})},da.prototype.ss=function(n,r,i){var o=this,s=r.collectionGroup,u=Gi;return this.Gn.os(n,s).next(function(t){return oa.forEach(t,function(t){var e=r.rn(t.child(s));return o.rs(n,e,i).next(function(t){t.forEach(function(t,e){u=u.nt(t,e)})})}).next(function(){return u})})},da.prototype.rs=function(e,n,t){var c,f,r=this;return this.jn.es(e,n,t).next(function(t){return c=t,r.Kn.hs(e,n)}).next(function(t){return f=t,r.as(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=Os(s,a,a,r.wn);c=h instanceof ou?c.nt(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){Au(n,e)||(c=c.remove(t))}),c})},da.prototype.as=function(t,e,n){for(var r=Ki(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Vs&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.jn.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof ou&&(h=h.nt(t,e))}),h})},da),ca=(pa.ls=function(t,e){for(var n=Ki(),r=Ki(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new pa(t,e.fromCache,n,r)},pa),fa=(la.prototype.fs=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},la.prototype.next=function(){var t=++this.previousValue;return this.ds&&this.ds(t),t},la);function la(t,e){var n=this;this.previousValue=t,e&&(e._s=function(t){return n.fs(t)},this.ds=function(t){return e.ws(t)})}function pa(t,e,n,r){this.targetId=t,this.fromCache=e,this.us=n,this.cs=r}function da(t,e,n){this.jn=t,this.Kn=e,this.Gn=n}function ya(){this.Un=[]}function va(){this.Nn=new Qr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.Fn=!1}function ga(t){var e=this;this.Pn=null,this.Vn=null,this.result=void 0,this.error=void 0,this.gn=!1,this.yn=!1,t(function(t){e.gn=!0,e.result=t,e.Pn&&e.Pn(t)},function(t){e.gn=!0,e.error=t,e.Vn&&e.Vn(t)})}function ma(t,e,n,r){this.batch=t,this.An=e,this.En=n,this.Rn=r}function wa(t,e,n,r){this.batchId=t,this.wn=e,this.baseMutations=n,this.mutations=r}fa.Ts=-1;function ba(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Ea,Ia=(xa.prototype.reset=function(){this.Ps=0},xa.prototype.ys=function(){this.Ps=this.Rs},xa.prototype.ps=function(t){var e=this;this.cancel();var n=Math.floor(this.Ps+this.bs()),r=Math.max(0,Date.now()-this.gs),i=Math.max(0,n-r);0<i&&xr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Ps+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Vs=this.Es.vs(this.Is,i,function(){return e.gs=Date.now(),t()}),this.Ps*=this.As,this.Ps<this.ms&&(this.Ps=this.ms),this.Ps>this.Rs&&(this.Ps=this.Rs)},xa.prototype.Ss=function(){null!==this.Vs&&(this.Vs.Ds(),this.Vs=null)},xa.prototype.cancel=function(){null!==this.Vs&&(this.Vs.cancel(),this.Vs=null)},xa.prototype.bs=function(){return(Math.random()-.5)*this.Ps},xa),Ta=(Sa.delete=function(t){return xr("SimpleDb","Removing database:",t),Ca(window.indexedDB.deleteDatabase(t)).vn()},Sa.Fs=function(){if("undefined"==typeof indexedDB)return!1;if(Sa.ks())return!0;var t=p(),e=Sa.Ns(t),n=0<e&&e<10,r=Sa.xs(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Sa.ks=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.$s)},Sa.Ms=function(t,e){return t.store(e)},Sa.Ns=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Sa.xs=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Sa.prototype.Os=function(){return g(this,void 0,void 0,function(){var e,o=this;return w(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(xr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(n,r){var i=indexedDB.open(o.name,o.version);i.onsuccess=function(t){var e=t.target.result;n(e)},i.onblocked=function(){r(new Aa("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Jr(Yr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new Aa(e))},i.onupgradeneeded=function(t){xr("SimpleDb",'Database "'+o.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;o.Cs.createOrUpgrade(e,i.transaction,t.oldVersion,o.version).next(function(){xr("SimpleDb","Database upgrade to version "+o.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Ls&&(this.db.onversionchange=function(t){return o.Ls(t)}),this.db)]}})})},Sa.prototype.qs=function(e){this.Ls=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Sa.prototype.runTransaction=function(r,h,c){return g(this,void 0,void 0,function(){var s,u,e,a,n;return w(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:++u,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,a.Os()];case 2:return a.db=t.sent(),e=Oa.open(a.db,s?"readonly":"readwrite",h),n=c(e).catch(function(t){return e.abort(t),oa.reject(t)}).vn(),r={},n.catch(function(){}),[4,e.Bs];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,xr("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),a.close(),o?[3,5]:[2,{value:Promise.reject(i)}];case 5:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Sa.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Sa),Na=(Object.defineProperty(Da.prototype,"gn",{get:function(){return this.Qs},enumerable:!1,configurable:!0}),Object.defineProperty(Da.prototype,"js",{get:function(){return this.Ws},enumerable:!1,configurable:!0}),Object.defineProperty(Da.prototype,"cursor",{set:function(t){this.Us=t},enumerable:!1,configurable:!0}),Da.prototype.done=function(){this.Qs=!0},Da.prototype.Ks=function(t){this.Ws=t},Da.prototype.delete=function(){return Ca(this.Us.delete())},Da),Aa=(n(_a,Ea=Jr),_a);function _a(t){var e=this;return(e=Ea.call(this,Yr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Da(t){this.Us=t,this.Qs=!1,this.Ws=null}function Sa(t,e,n){this.name=t,this.version=e,this.Cs=n,12.2===Sa.Ns(p())&&kr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function xa(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Es=t,this.Is=e,this.ms=n,this.As=r,this.Rs=i,this.Ps=0,this.Vs=null,this.gs=Date.now(),this.reset()}function ka(t){return"IndexedDbTransactionError"===t.name}var Oa=(Ra.open=function(t,e,n){try{return new Ra(t.transaction(n,e))}catch(t){throw new Aa(t)}},Object.defineProperty(Ra.prototype,"Bs",{get:function(){return this.Gs.promise},enumerable:!1,configurable:!0}),Ra.prototype.abort=function(t){t&&this.Gs.reject(t),this.aborted||(xr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ra.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Pa(e)},Ra),Pa=(La.prototype.put=function(t,e){var n=void 0!==e?(xr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(xr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Ca(n)},La.prototype.add=function(t){return xr("SimpleDb","ADD",this.store.name,t,t),Ca(this.store.add(t))},La.prototype.get=function(e){var n=this;return Ca(this.store.get(e)).next(function(t){return void 0===t&&(t=null),xr("SimpleDb","GET",n.store.name,e,t),t})},La.prototype.delete=function(t){return xr("SimpleDb","DELETE",this.store.name,t),Ca(this.store.delete(t))},La.prototype.count=function(){return xr("SimpleDb","COUNT",this.store.name),Ca(this.store.count())},La.prototype.zs=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Hs(n,function(t,e){r.push(e)}).next(function(){return r})},La.prototype.Ys=function(t,e){xr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Js=!1;var r=this.cursor(n);return this.Hs(r,function(t,e,n){return n.delete()})},La.prototype.Xs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Hs(r,e)},La.prototype.Zs=function(i){var t=this.cursor({});return new oa(function(n,r){t.onerror=function(t){var e=Va(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},La.prototype.Hs=function(t,s){var u=[];return new oa(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Na(i),(n=s(i.primaryKey,i.value,e))instanceof oa&&(r=n.catch(function(t){return e.done(),oa.reject(t)}),u.push(r)),e.gn?o():null===e.js?i.continue():i.continue(e.js)):o()}}).next(function(){return oa.Dn(u)})},La.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},La.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Js?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},La);function La(t){this.store=t}function Ra(t){var n=this;this.transaction=t,this.aborted=!1,this.Gs=new ba,this.transaction.oncomplete=function(){n.Gs.resolve()},this.transaction.onabort=function(){t.error?n.Gs.reject(new Aa(t.error)):n.Gs.resolve()},this.transaction.onerror=function(t){var e=Va(t.target.error);n.Gs.reject(new Aa(e))}}function Ca(t){return new oa(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Va(t.target.error);r(e)}})}var Ua=!1;function Va(t){var e=Ta.Ns(p());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Jr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ua||(Ua=!0,setTimeout(function(){throw r},0)),r}}return t}function Ma(){return"undefined"!=typeof window?window:null}function Fa(){return"undefined"!=typeof document?document:null}var ja=(Ba.ii=function(t,e,n,r,i){var o=new Ba(t,e,Date.now()+n,r,i);return o.start(n),o},Ba.prototype.start=function(t){var e=this;this.ri=setTimeout(function(){return e.oi()},t)},Ba.prototype.Ds=function(){return this.oi()},Ba.prototype.cancel=function(t){null!==this.ri&&(this.clearTimeout(),this.si.reject(new Jr(Yr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Ba.prototype.oi=function(){var e=this;this.ti.hi(function(){return null!==e.ri?(e.clearTimeout(),e.op().then(function(t){return e.si.resolve(t)})):Promise.resolve()})},Ba.prototype.clearTimeout=function(){null!==this.ri&&(this.ni(this),clearTimeout(this.ri),this.ri=null)},Ba),qa=(Object.defineProperty(Ga.prototype,"Ei",{get:function(){return this.ci},enumerable:!1,configurable:!0}),Ga.prototype.hi=function(t){this.enqueue(t)},Ga.prototype.Ii=function(t){this.mi(),this.Ai(t)},Ga.prototype.Ri=function(t){return this.mi(),this.Ai(t)},Ga.prototype.Pi=function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return this.mi(),this.ci?[3,2]:(this.ci=!0,(e=Fa())&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ti),[4,this.Ri(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ga.prototype.enqueue=function(t){return this.mi(),this.ci?new Promise(function(t){}):this.Ai(t)},Ga.prototype.Vi=function(t){var e=this;this.ui.push(t),this.hi(function(){return e.gi()})},Ga.prototype.gi=function(){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(0===this.ui.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.ui[0]()];case 2:return t.sent(),this.ui.shift(),this.wi.reset(),[3,4];case 3:if(!ka(e=t.sent()))throw e;return xr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.ui.length&&this.wi.ps(function(){return n.gi()}),t.label=5;case 5:return[2]}})})},Ga.prototype.Ai=function(t){var r=this,e=this.ai.then(function(){return r.fi=!0,t().catch(function(t){throw r._i=t,r.fi=!1,kr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.fi=!1,t})});return this.ai=e},Ga.prototype.vs=function(t,e,n){var r=this;this.mi(),-1<this.di.indexOf(t)&&(e=0);var i=ja.ii(this,t,e,n,function(t){return r.yi(t)});return this.li.push(i),i},Ga.prototype.mi=function(){this._i&&Lr()},Ga.prototype.pi=function(){},Ga.prototype.bi=function(){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return[4,e=this.ai];case 1:t.sent(),t.label=2;case 2:if(e!==this.ai)return[3,0];t.label=3;case 3:return[2]}})})},Ga.prototype.vi=function(t){for(var e=0,n=this.li;e<n.length;e++)if(n[e].Is===t)return!0;return!1},Ga.prototype.Si=function(r){var i=this;return this.bi().then(function(){i.li.sort(function(t,e){return t.ei-e.ei});for(var t=0,e=i.li;t<e.length;t++){var n=e[t];if(n.Ds(),"all"!==r&&n.Is===r)break}return i.bi()})},Ga.prototype.Di=function(t){this.di.push(t)},Ga.prototype.yi=function(t){var e=this.li.indexOf(t);this.li.splice(e,1)},Ga);function Ga(){var e=this;this.ai=Promise.resolve(),this.ui=[],this.ci=!1,this.li=[],this._i=null,this.fi=!1,this.di=[],this.wi=new Ia(this,"async_queue_retry"),this.Ti=function(){var t=Fa();t&&xr("AsyncQueue","Visibility state changed to  ",t.visibilityState),e.wi.Ss()};var t=Fa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ti)}function Ba(t,e,n,r,i){this.ti=t,this.Is=e,this.ei=n,this.op=r,this.ni=i,this.si=new ba,this.then=this.si.promise.then.bind(this.si.promise),this.si.promise.catch(function(t){})}function za(t,e){if(kr("AsyncQueue",e+": "+t),ka(t))return new Jr(Yr.UNAVAILABLE,e+": "+t);throw t}function Ka(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Vr(n,i);return 0===s?Vr(r,o):s}var Xa=(Ya.prototype.Fi=function(){return++this.Ni},Ya.prototype.ki=function(t){var e,n=[t,this.Fi()];this.buffer.size<this.Ci?this.buffer=this.buffer.add(n):Ka(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(Ya.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Ya),Ha={xi:!1,$i:0,Mi:0,Oi:0},Wa=(Qa.Ui=function(t){return new Qa(t,Qa.Qi,Qa.Wi)},Qa);function Qa(t,e,n){this.Li=t,this.qi=e,this.Bi=n}function Ya(t){this.Ci=t,this.buffer=new Vi(Ka),this.Ni=0}Wa.ji=-1,Wa.Ki=1048576,Wa.Gi=41943040,Wa.Qi=10,Wa.Wi=1e3,Wa.zi=new Wa(Wa.Gi,Wa.Qi,Wa.Wi),Wa.Hi=new Wa(Wa.ji,0,0);var Ja=(th.prototype.start=function(t){this.Yi.params.Li!==Wa.ji&&this.Zi(t)},th.prototype.stop=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},Object.defineProperty(th.prototype,"tr",{get:function(){return null!==this.Xi},enumerable:!1,configurable:!0}),th.prototype.Zi=function(n){var t=this,e=this.Ji?3e5:6e4;xr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Xi=this.ti.vs("lru_garbage_collection",e,function(){return g(t,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:this.Xi=null,this.Ji=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.er(this.Yi)];case 2:return t.sent(),[3,7];case 3:return ka(e=t.sent())?(xr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Tc(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Zi(n)];case 8:return t.sent(),[2]}})})})},th),$a=(Za.prototype.sr=function(t,e){return this.nr.ir(t).next(function(t){return Math.floor(e/100*t)})},Za.prototype.rr=function(t,e){var n=this;if(0===e)return oa.resolve(fa.Ts);var r=new Xa(e);return this.nr.pe(t,function(t){return r.ki(t.sequenceNumber)}).next(function(){return n.nr.or(t,function(t){return r.ki(t)})}).next(function(){return r.maxValue})},Za.prototype.hr=function(t,e,n){return this.nr.hr(t,e,n)},Za.prototype.ar=function(t,e){return this.nr.ar(t,e)},Za.prototype.ur=function(e,n){var r=this;return this.params.Li===Wa.ji?(xr("LruGarbageCollector","Garbage collection skipped; disabled"),oa.resolve(Ha)):this.cr(e).next(function(t){return t<r.params.Li?(xr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Li),Ha):r.lr(e,n)})},Za.prototype.cr=function(t){return this.nr.cr(t)},Za.prototype.lr=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.sr(e,this.params.qi).next(function(t){return i=t>c.params.Bi?(xr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.Bi+" from "+t),c.params.Bi):t,s=Date.now(),c.rr(e,i)}).next(function(t){return r=t,u=Date.now(),c.hr(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.ar(e,r)}).next(function(t){return h=Date.now(),Sr()<=l.DEBUG&&xr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),oa.resolve({xi:!0,$i:i,Mi:o,Oi:t})})},Za);function Za(t,e){this.nr=t,this.params=e}function th(t,e){this.Yi=t,this.ti=e,this.Ji=!1,this.Xi=null}function eh(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=nh(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}(t.get(n),e);return nh(e)}function nh(t){return t+""}function rh(t){var e=t.length;if(Rr(2<=e),2===e)return Rr(""===t.charAt(0)&&""===t.charAt(1)),ei.$();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Lr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Lr()}o=s+2}return new ei(r)}var ih=function(t){this._r=t};function oh(t,e){if(e.document)return n=t._r,r=e.document,i=!!e.hasCommittedMutations,o=Bo(n,r.name),s=Fo(r.updateTime),u=new Qs({mapValue:{fields:r.fields}}),new ou(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=ii.j(e.noDocument.path),h=ch(e.noDocument.readTime);return new su(a,h,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var c=ii.j(e.unknownDocument.path),f=ch(e.unknownDocument.version);return new uu(c,f)}return Lr()}function sh(t,e,n){var r,i,o=uh(n),s=e.key.path.p().N();if(e instanceof ou){var u={name:Go(r=t._r,(i=e).key),fields:i.Ze().mapValue.fields,updateTime:Vo(r,i.version.A())},a=e.hasCommittedMutations;return new Bh(null,null,u,a,o,s)}if(e instanceof su){var h=e.key.path.N(),c=hh(e.version),f=e.hasCommittedMutations;return new Bh(null,new qh(h,c),null,f,o,s)}if(e instanceof uu){var l=e.key.path.N(),p=hh(e.version);return new Bh(new Gh(l,p),null,null,!0,o,s)}return Lr()}function uh(t){var e=t.A();return[e.seconds,e.nanoseconds]}function ah(t){var e=new $r(t[0],t[1]);return Zr.I(e)}function hh(t){var e=t.A();return new Ph(e.seconds,e.nanoseconds)}function ch(t){var e=new $r(t.seconds,t.nanoseconds);return Zr.I(e)}function fh(e,t){var n=(t.baseMutations||[]).map(function(t){return Yo(e._r,t)}),r=t.mutations.map(function(t){return Yo(e._r,t)}),i=$r.fromMillis(t.localWriteTimeMs);return new ra(t.batchId,i,n,r)}function lh(t){var e,n=ch(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?ch(t.lastLimboFreeSnapshotVersion):Zr.min(),i=void 0!==t.query.documents?(Rr(1===(e=t.query).documents.length),mu(yu(Ko(e.documents[0])))):function(t){var e,n=Ko(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Rr(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ns(t.unaryFilter.field);return Su.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ns(t.unaryFilter.field);return Su.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ns(t.unaryFilter.field);return Su.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ns(t.unaryFilter.field);return Su.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Lr()}}(e)]:void 0!==e.fieldFilter?[(n=e,Su.create(ns(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Lr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Lr():[];var n}(r.where));var u=[];r.orderBy&&(u=r.orderBy.map(function(t){return new na(ns((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));var a,h,c=null;r.limit&&(a=r.limit,c=pi(h="object"==typeof a?a.value:a)?null:h);var f=null;r.startAt&&(f=ts(r.startAt));var l=null;return r.endAt&&(l=ts(r.endAt)),mu(du(n,o,u,s,c,"F",f,l))}(t.query);return new _i(i,t.targetId,0,t.lastListenSequenceNumber,n,r,Ei.fromBase64String(t.resumeToken))}function ph(t,e){var n=hh(e.X),r=hh(e.lastLimboFreeSnapshotVersion),i=(bi(e.target)?Jo:$o)(t._r,e.target),o=e.resumeToken.toBase64();return new Kh(e.targetId,mi(e.target),n,o,e.sequenceNumber,r,i)}var dh=(yh.Tr=function(t,e,n,r){return Rr(""!==t.uid),new yh(t.Er()?t.uid:"",e,n,r)},yh.prototype.Ir=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mh(t).Xs({index:Mh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},yh.prototype.mr=function(d,y,v,g){var m=this,w=wh(d),b=mh(d);return b.add({}).next(function(t){Rr("number"==typeof t);for(var e,n,r,i,o,s=new ra(t,y,v,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return Qo(e._r,t)}),o=r.mutations.map(function(t){return Qo(e._r,t)}),new Mh(n,r.batchId,r.wn.toMillis(),i,o)),a=[],h=new Vi(function(t,e){return Vr(t.F(),e.F())}),c=0,f=g;c<f.length;c++){var l=f[c],p=Fh.key(m.userId,l.key.path,t),h=h.add(l.key.path.p());a.push(b.put(u)),a.push(w.put(p,Fh.PLACEHOLDER))}return h.forEach(function(t){a.push(m.Gn.Ar(d,t))}),d.Qn(function(){m.wr[t]=s.keys()}),oa.Dn(a).next(function(){return s})})},yh.prototype.Rr=function(t,e){var n=this;return mh(t).get(e).next(function(t){return t?(Rr(t.userId===n.userId),fh(n.serializer,t)):null})},yh.prototype.Pr=function(t,n){var r=this;return this.wr[n]?oa.resolve(this.wr[n]):this.Rr(t,n).next(function(t){if(t){var e=t.keys();return r.wr[n]=e}return null})},yh.prototype.Vr=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return mh(t).Xs({index:Mh.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Rr(e.batchId>=i),o=fh(r.serializer,e)),n.done()}).next(function(){return o})},yh.prototype.gr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return mh(t).Xs({index:Mh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},yh.prototype.yr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mh(t).zs(Mh.userMutationsIndex,n).next(function(t){return t.map(function(t){return fh(e.serializer,t)})})},yh.prototype.Hn=function(u,a){var h=this,t=Fh.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return wh(u).Xs({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=rh(i);if(r===h.userId&&a.path.isEqual(s))return mh(u).get(o).next(function(t){if(!t)throw Lr();Rr(t.userId===h.userId),c.push(fh(h.serializer,t))});n.done()}).next(function(){return c})},yh.prototype.ts=function(r,t){var a=this,h=new Vi(Vr),i=[];return t.forEach(function(u){var t=Fh.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=wh(r).Xs({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=rh(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),oa.Dn(i).next(function(){return a.pr(r,h)})},yh.prototype.hs=function(t,e){var u=this,a=e.path,h=a.length+1,n=Fh.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new Vi(Vr);return wh(t).Xs({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=rh(i);r===u.userId&&a.D(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.pr(t,c)})},yh.prototype.pr=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(mh(e).get(t).next(function(t){if(null===t)throw Lr();Rr(t.userId===n.userId),r.push(fh(n.serializer,t))}))}),oa.Dn(i).next(function(){return r})},yh.prototype.br=function(e,n){var r=this;return gh(e.vr,this.userId,n).next(function(t){return e.Qn(function(){r.Sr(n.batchId)}),oa.forEach(t,function(t){return r.dr.Dr(e,t)})})},yh.prototype.Sr=function(t){delete this.wr[t]},yh.prototype.Cr=function(n){var o=this;return this.Ir(n).next(function(t){if(!t)return oa.resolve();var e=IDBKeyRange.lowerBound(Fh.prefixForUser(o.userId)),i=[];return wh(n).Xs({range:e},function(t,e,n){var r;t[0]===o.userId?(r=rh(t[1]),i.push(r)):n.done()}).next(function(){Rr(0===i.length)})})},yh.prototype.Nr=function(t,e){return vh(t,this.userId,e)},yh.prototype.Fr=function(t){var e=this;return bh(t).get(this.userId).next(function(t){return t||new Vh(e.userId,-1,"")})},yh);function yh(t,e,n,r){this.userId=t,this.serializer=e,this.Gn=n,this.dr=r,this.wr={}}function vh(t,o,e){var n=Fh.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return wh(t).Xs({range:r,Js:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function gh(t,e,n){var r=t.store(Mh.store),i=t.store(Fh.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Xs({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Rr(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Fh.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return oa.Dn(o).next(function(){return h})}function mh(t){return fc.Ms(t,Mh.store)}function wh(t){return fc.Ms(t,Fh.store)}function bh(t){return fc.Ms(t,Vh.store)}var Eh,Ih=(Th.prototype.xn=function(t,e,n){return Ah(t).put(_h(e),n)},Th.prototype.Mn=function(t,e){var n=Ah(t),r=_h(e);return n.delete(r)},Th.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.kr(e,t)})},Th.prototype.On=function(t,e){var n=this;return Ah(t).get(_h(e)).next(function(t){return n.xr(t)})},Th.prototype.$r=function(t,e){var n=this;return Ah(t).get(_h(e)).next(function(t){var e=n.xr(t);return e?{Mr:e,size:Dh(t)}:null})},Th.prototype.getEntries=function(t,e){var r=this,i=Fi;return this.Or(t,e,function(t,e){var n=r.xr(e);i=i.nt(t,n)}).next(function(){return i})},Th.prototype.Lr=function(t,e){var r=this,i=Fi,o=new ki(ii.P);return this.Or(t,e,function(t,e){var n=r.xr(e);o=n?(i=i.nt(t,n),o.nt(t,Dh(e))):(i=i.nt(t,null),o.nt(t,0))}).next(function(){return{qr:i,Br:o}})},Th.prototype.Or=function(t,e,i){if(e._())return oa.resolve();var n=IDBKeyRange.bound(e.first().path.N(),e.last().path.N()),o=e.at(),s=o.dt();return Ah(t).Xs({range:n},function(t,e,n){for(var r=ii.j(t);s&&ii.P(s,r)<0;)i(s,null),s=o.dt();s&&s.isEqual(r)&&(i(s,e),s=o.wt()?o.dt():null),s?n.Ks(s.path.N()):n.done()}).next(function(){for(;s;)i(s,null),s=o.wt()?o.dt():null})},Th.prototype.es=function(t,i,e){var n,r,o,s=this,u=Gi,a=i.path.length+1,h={};return e.isEqual(Zr.min())?(n=i.path.N(),h.range=IDBKeyRange.lowerBound(n)):(r=i.path.N(),o=uh(e),h.range=IDBKeyRange.lowerBound([r,o],!0),h.index=Bh.collectionReadTimeIndex),Ah(t).Xs(h,function(t,e,n){var r;t.length===a&&(r=oh(s.serializer,e),i.path.D(r.key.path)?r instanceof ou&&Au(i,r)&&(u=u.nt(r.key,r)):n.done())}).next(function(){return u})},Th.prototype.Ur=function(t,e){var r=this,i=Fi,o=uh(e),n=Ah(t),s=IDBKeyRange.lowerBound(o,!0);return n.Xs({index:Bh.readTimeIndex,range:s},function(t,e){var n=oh(r.serializer,e);i=i.nt(n.key,n),o=e.readTime}).next(function(){return{Qr:i,readTime:ah(o)}})},Th.prototype.Wr=function(t){var e=Ah(t),r=Zr.min();return e.Xs({index:Bh.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=ah(e.readTime)),n.done()}).next(function(){return r})},Th.prototype.jr=function(t){return new Th.Kr(this,!!t&&t.Gr)},Th.prototype.zr=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Th.prototype.getMetadata=function(t){return Nh(t).get(zh.key).next(function(t){return Rr(!!t),t})},Th.prototype.kr=function(t,e){return Nh(t).put(zh.key,e)},Th.prototype.xr=function(t){if(t){var e=oh(this.serializer,t);return e instanceof su&&e.version.isEqual(Zr.min())?null:e}return null},Th);function Th(t,e){this.serializer=t,this.Gn=e}function Nh(t){return fc.Ms(t,zh.store)}function Ah(t){return fc.Ms(t,Bh.store)}function _h(t){return t.path.N()}function Dh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Lr();e=t.noDocument}return JSON.stringify(e).length}function Sh(t,e){var n=this;return(n=Eh.call(this)||this).Hr=t,n.Gr=e,n.Yr=new Qr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}Ih.Kr=(n(Sh,Eh=sa),Sh.prototype.Bn=function(s){var u=this,a=[],h=0,c=new Vi(function(t,e){return Vr(t.F(),e.F())});return this.Nn.forEach(function(t,e){var n,r,i,o=u.Yr.get(t);e?(n=sh(u.Hr.serializer,e,u.readTime),c=c.add(t.path.p()),r=Dh(n),h+=r-o,a.push(u.Hr.xn(s,t,n))):(h-=o,u.Gr?(i=sh(u.Hr.serializer,new su(t,Zr.min()),u.readTime),a.push(u.Hr.xn(s,t,i))):a.push(u.Hr.Mn(s,t)))}),c.forEach(function(t){a.push(u.Hr.Gn.Ar(s,t))}),a.push(this.Hr.updateMetadata(s,h)),oa.Dn(a)},Sh.prototype.Ln=function(t,e){var n=this;return this.Hr.$r(t,e).next(function(t){return null===t?(n.Yr.set(e,0),null):(n.Yr.set(e,t.size),t.Mr)})},Sh.prototype.qn=function(t,e){var n=this;return this.Hr.Lr(t,e).next(function(t){var e=t.qr;return t.Br.forEach(function(t,e){n.Yr.set(t,e)}),e})},Sh);var xh=(Uh.prototype.Ar=function(t,e){return this.Jr.add(e),oa.resolve()},Uh.prototype.os=function(t,e){return oa.resolve(this.Jr.getEntries(e))},Uh),kh=(Ch.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new Vi(ei.P),i=!r.has(n);return this.index[e]=r.add(n),i},Ch.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},Ch.prototype.getEntries=function(t){return(this.index[t]||new Vi(ei.P)).N()},Ch),Oh=(Rh.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Rr(t<e&&0<=t&&e<=10);var o,s=new Oa(r);t<1&&1<=e&&(n.createObjectStore(Lh.store),(o=n).createObjectStore(Vh.store,{keyPath:Vh.keyPath}),o.createObjectStore(Mh.store,{keyPath:Mh.keyPath,autoIncrement:!0}).createIndex(Mh.userMutationsIndex,Mh.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Fh.store),Qh(n),n.createObjectStore(Bh.store));var u,a=oa.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(Xh.store),u.deleteObjectStore(Kh.store),u.deleteObjectStore(Hh.store),Qh(n)),a=a.next(function(){return t=s.store(Hh.store),e=new Hh(0,0,Zr.min().A(),0),t.put(Hh.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(Mh.store).zs().next(function(t){r.deleteObjectStore(Mh.store),r.createObjectStore(Mh.store,{keyPath:Mh.keyPath,autoIncrement:!0}).createIndex(Mh.userMutationsIndex,Mh.userMutationsKeyPath,{unique:!0});var e=i.store(Mh.store),n=t.map(function(t){return e.put(t)});return oa.Dn(n)});var r,i})),a=a.next(function(){n.createObjectStore(Yh.store,{keyPath:Yh.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(zh.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Bh.store)).createIndex(Bh.readTimeIndex,Bh.readTimeIndexPath,{unique:!1}),t.createIndex(Bh.collectionReadTimeIndex,Bh.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Rh.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Bh.store).Xs(function(t,e){n+=Dh(e)}).next(function(){var t=new zh(n);return e.store(zh.store).put(zh.key,t)})},Rh.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Vh.store),e=r.store(Mh.store);return t.zs().next(function(t){return oa.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.zs(Mh.userMutationsIndex,t).next(function(t){return oa.forEach(t,function(t){Rr(t.userId===n.userId);var e=fh(i.serializer,t);return gh(r,n.userId,e).next(function(){})})})})})},Rh.prototype.ensureSequenceNumbers=function(t){var s=t.store(Xh.store),e=t.store(Bh.store);return t.store(Hh.store).get(Hh.key).next(function(i){var o=[];return e.Xs(function(t,e){var n=new ei(t),r=[0,eh(n)];o.push(s.get(r).next(function(t){return t?oa.resolve():s.put(new Xh(0,eh(n),i.highestListenSequenceNumber))}))}).next(function(){return oa.Dn(o)})})},Rh.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.S(),n=t.p();return r.put({collectionId:e,parent:eh(n)})}}t.createObjectStore(Wh.store,{keyPath:Wh.keyPath});var r=e.store(Wh.store),o=new kh;return e.store(Bh.store).Xs({Js:!0},function(t,e){var n=new ei(t);return i(n.p())}).next(function(){return e.store(Fh.store).Xs({Js:!0},function(t,e){t[0];var n=t[1],r=(t[2],rh(n));return i(r.p())})})},Rh.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Kh.store);return o.Xs(function(t,e){var n=lh(e),r=ph(i.serializer,n);return o.put(r)})},Rh),Ph=function(t,e){this.seconds=t,this.nanoseconds=e},Lh=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Rh(t){this.serializer=t}function Ch(){this.index={}}function Uh(){this.Jr=new kh}Lh.store="owner",Lh.key="owner";var Vh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Vh.store="mutationQueues",Vh.keyPath="userId";var Mh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Mh.store="mutations",Mh.keyPath="batchId",Mh.userMutationsIndex="userMutationsIndex",Mh.userMutationsKeyPath=["userId","batchId"];var Fh=(jh.prefixForUser=function(t){return[t]},jh.prefixForPath=function(t,e){return[t,eh(e)]},jh.key=function(t,e,n){return[t,eh(e),n]},jh);function jh(){}Fh.store="documentMutations",Fh.PLACEHOLDER=new Fh;var qh=function(t,e){this.path=t,this.readTime=e},Gh=function(t,e){this.path=t,this.version=e},Bh=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Bh.store="remoteDocuments",Bh.readTimeIndex="readTimeIndex",Bh.readTimeIndexPath="readTime",Bh.collectionReadTimeIndex="collectionReadTimeIndex",Bh.collectionReadTimeIndexPath=["parentPath","readTime"];var zh=function(t){this.byteSize=t};zh.store="remoteDocumentGlobal",zh.key="remoteDocumentGlobalKey";var Kh=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Kh.store="targets",Kh.keyPath="targetId",Kh.queryTargetsIndexName="queryTargetsIndex",Kh.queryTargetsKeyPath=["canonicalId","targetId"];var Xh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Xh.store="targetDocuments",Xh.keyPath=["targetId","path"],Xh.documentTargetsIndex="documentTargetsIndex",Xh.documentTargetsKeyPath=["path","targetId"];var Hh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Hh.key="targetGlobalKey",Hh.store="targetGlobal";var Wh=function(t,e){this.collectionId=t,this.parent=e};function Qh(t){t.createObjectStore(Xh.store,{keyPath:Xh.keyPath}).createIndex(Xh.documentTargetsIndex,Xh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Kh.store,{keyPath:Kh.keyPath}).createIndex(Kh.queryTargetsIndexName,Kh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Hh.store)}Wh.store="collectionParents",Wh.keyPath=["collectionId","parent"];var Yh=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Yh.store="clientMetadata",Yh.keyPath="clientId";var Jh=i(i(i([Vh.store,Mh.store,Fh.store,Bh.store,Kh.store,Lh.store,Hh.store,Xh.store],[Yh.store]),[zh.store]),[Wh.store]),$h=(Zh.prototype.Ar=function(t,e){var n=this;if(this.Xr.has(e))return oa.resolve();var r=e.S(),i=e.p();t.Qn(function(){n.Xr.add(e)});var o={collectionId:r,parent:eh(i)};return tc(t).put(o)},Zh.prototype.os=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Fr(i),""],!1,!0);return tc(t).zs(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(rh(r.parent))}return o})},Zh);function Zh(){this.Xr=new kh}function tc(t){return fc.Ms(t,Wh.store)}var ec=(ic.prototype.next=function(){return this.Zr+=2,this.Zr},ic.to=function(){return new ic(0)},ic.eo=function(){return new ic(-1)},ic),nc=(rc.prototype.no=function(n){var r=this;return this.so(n).next(function(t){var e=new ec(t.highestTargetId);return t.highestTargetId=e.next(),r.io(n,t).next(function(){return t.highestTargetId})})},rc.prototype.ro=function(t){return this.so(t).next(function(t){return Zr.I(new $r(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},rc.prototype.oo=function(t){return this.so(t).next(function(t){return t.highestListenSequenceNumber})},rc.prototype.ho=function(e,n,r){var i=this;return this.so(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.A()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.io(e,t)})},rc.prototype.ao=function(e,n){var r=this;return this.uo(e,n).next(function(){return r.so(e).next(function(t){return t.targetCount+=1,r.co(n,t),r.io(e,t)})})},rc.prototype.lo=function(t,e){return this.uo(t,e)},rc.prototype._o=function(e,t){var n=this;return this.fo(e,t.targetId).next(function(){return oc(e).delete(t.targetId)}).next(function(){return n.so(e)}).next(function(t){return Rr(0<t.targetCount),--t.targetCount,n.io(e,t)})},rc.prototype.hr=function(r,i,o){var s=this,u=0,a=[];return oc(r).Xs(function(t,e){var n=lh(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s._o(r,n)))}).next(function(){return oa.Dn(a)}).next(function(){return u})},rc.prototype.pe=function(t,r){return oc(t).Xs(function(t,e){var n=lh(e);r(n)})},rc.prototype.so=function(t){return sc(t).get(Hh.key).next(function(t){return Rr(null!==t),t})},rc.prototype.io=function(t,e){return sc(t).put(Hh.key,e)},rc.prototype.uo=function(t,e){return oc(t).put(ph(this.serializer,e))},rc.prototype.co=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},rc.prototype.do=function(t){return this.so(t).next(function(t){return t.targetCount})},rc.prototype.wo=function(t,i){var e=mi(i),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),o=null;return oc(t).Xs({range:n,index:Kh.queryTargetsIndexName},function(t,e,n){var r=lh(e);wi(i,r.target)&&(o=r,n.done())}).next(function(){return o})},rc.prototype.To=function(n,t,r){var i=this,o=[],s=uc(n);return t.forEach(function(t){var e=eh(t.path);o.push(s.put(new Xh(r,e))),o.push(i.dr.Eo(n,r,t))}),oa.Dn(o)},rc.prototype.Io=function(n,t,r){var i=this,o=uc(n);return oa.forEach(t,function(t){var e=eh(t.path);return oa.Dn([o.delete([r,e]),i.dr.mo(n,r,t)])})},rc.prototype.fo=function(t,e){var n=uc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},rc.prototype.Ao=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=uc(t),o=Ki();return r.Xs({range:n,Js:!0},function(t,e,n){var r=rh(t[1]),i=new ii(r);o=o.add(i)}).next(function(){return o})},rc.prototype.Nr=function(t,e){var n=eh(e.path),r=IDBKeyRange.bound([n],[Fr(n)],!1,!0),i=0;return uc(t).Xs({index:Xh.documentTargetsIndex,Js:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},rc.prototype.Me=function(t,e){return oc(t).get(e).next(function(t){return t?lh(t):null})},rc);function rc(t,e){this.dr=t,this.serializer=e}function ic(t){this.Zr=t}function oc(t){return fc.Ms(t,Kh.store)}function sc(t){return fc.Ms(t,Hh.store)}function uc(t){return fc.Ms(t,Xh.store)}var ac,hc="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",cc=(n(pc,ac=aa),pc),fc=(lc.Ms=function(t,e){if(t instanceof cc)return Ta.Ms(t.vr,e);throw Lr()},lc.prototype.start=function(){var e=this;return this.$o().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Jr(Yr.FAILED_PRECONDITION,hc);return e.Mo(),e.Oo(),e.Lo(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.ko.oo(t)})}).then(function(t){e.yo=new fa(t,e.Po)}).then(function(){e.po=!0}).catch(function(t){return e.Fo&&e.Fo.close(),Promise.reject(t)})},lc.prototype.qo=function(n){var t=this;return this.Co=function(e){return g(t,void 0,void 0,function(){return w(this,function(t){return this.tr?[2,n(e)]:[2]})})},n(this.isPrimary)},lc.prototype.Bo=function(n){var t=this;this.Fo.qs(function(e){return g(t,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},lc.prototype.Uo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Es.hi(function(){return g(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.tr?[4,this.$o()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},lc.prototype.$o=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return yc(e).put(new Yh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Qo(e).next(function(t){t||(n.isPrimary=!1,n.Es.Vi(function(){return n.Co(!1)}))})}).next(function(){return n.Wo(e)}).next(function(t){return n.isPrimary&&!t?n.jo(e).next(function(){return!1}):!!t&&n.Ko(e).next(function(){return!0})})}).catch(function(t){if(ka(t))return xr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return xr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Es.Vi(function(){return n.Co(t)}),n.isPrimary=t})},lc.prototype.Qo=function(t){var e=this;return dc(t).get(Lh.key).next(function(t){return oa.resolve(e.Go(t))})},lc.prototype.zo=function(t){return yc(t).delete(this.clientId)},lc.prototype.Ho=function(){return g(this,void 0,void 0,function(){var e,n,r,i,o=this;return w(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Yo(this.Do,18e5)?[3,2]:(this.Do=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=lc.Ms(t,Yh.store);return r.zs().next(function(t){var e=o.Jo(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return oa.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.xo)for(n=0,r=e;n<r.length;n++)i=r[n],this.xo.removeItem(this.Xo(i.clientId));t.label=2;case 2:return[2]}})})},lc.prototype.Lo=function(){var t=this;this.So=this.Es.vs("client_metadata_refresh",4e3,function(){return t.$o().then(function(){return t.Ho()}).then(function(){return t.Lo()})})},lc.prototype.Go=function(t){return!!t&&t.ownerId===this.clientId},lc.prototype.Wo=function(e){var i=this;return this.Vo?oa.resolve(!0):dc(e).get(Lh.key).next(function(t){if(null!==t&&i.Yo(t.leaseTimestampMs,5e3)&&!i.Zo(t.ownerId)){if(i.Go(t)&&i.networkEnabled)return!0;if(!i.Go(t)){if(!t.allowTabSynchronization)throw new Jr(Yr.FAILED_PRECONDITION,hc);return!1}}return!(!i.networkEnabled||!i.inForeground)||yc(e).zs().next(function(t){return void 0===i.Jo(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&xr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},lc.prototype.th=function(){return g(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:return this.po=!1,this.eh(),this.So&&(this.So.cancel(),this.So=null),this.nh(),this.sh(),[4,this.runTransaction("shutdown","readwrite",function(t){return e.jo(t).next(function(){return e.zo(t)})}).catch(function(t){xr("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)})];case 1:return t.sent(),this.Fo.close(),this.ih(),[2]}})})},lc.prototype.Jo=function(t,e){var n=this;return t.filter(function(t){return n.Yo(t.updateTimeMs,e)&&!n.Zo(t.clientId)})},lc.prototype.rh=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return yc(t).zs().next(function(t){return e.Jo(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(lc.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),lc.prototype.oh=function(t){return dh.Tr(t,this.serializer,this.Gn,this.dr)},lc.prototype.hh=function(){return this.ko},lc.prototype.ah=function(){return this.jn},lc.prototype.uh=function(){return this.Gn},lc.prototype.runTransaction=function(e,n,r){var i=this;xr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Fo.runTransaction(t,Jh,function(t){return o=new cc(t,i.yo?i.yo.next():fa.Ts),"readwrite-primary"===n?i.Qo(o).next(function(t){return!!t||i.Wo(o)}).next(function(t){if(!t)throw kr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Es.Vi(function(){return i.Co(!1)}),new Jr(Yr.FAILED_PRECONDITION,ua);return r(o)}).next(function(t){return i.Ko(o).next(function(){return t})}):i.lh(o).next(function(){return r(o)})}).then(function(t){return o.Wn(),t})},lc.prototype.lh=function(t){var e=this;return dc(t).get(Lh.key).next(function(t){if(null!==t&&e.Yo(t.leaseTimestampMs,5e3)&&!e.Zo(t.ownerId)&&!e.Go(t)&&!(e.Vo||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Jr(Yr.FAILED_PRECONDITION,hc)})},lc.prototype.Ko=function(t){var e=new Lh(this.clientId,this.allowTabSynchronization,Date.now());return dc(t).put(Lh.key,e)},lc.Fs=function(){return Ta.Fs()},lc.prototype.jo=function(t){var e=this,n=dc(t);return n.get(Lh.key).next(function(t){return e.Go(t)?(xr("IndexedDbPersistence","Releasing primary lease."),n.delete(Lh.key)):oa.resolve()})},lc.prototype.Yo=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(kr("Detected an update time that is in the future: "+t+" > "+n),1))},lc.prototype.Mo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.vo=function(){t.Es.hi(function(){return t.inForeground="visible"===t.document.visibilityState,t.$o()})},this.document.addEventListener("visibilitychange",this.vo),this.inForeground="visible"===this.document.visibilityState)},lc.prototype.nh=function(){this.vo&&(this.document.removeEventListener("visibilitychange",this.vo),this.vo=null)},lc.prototype.Oo=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.bo=function(){e.eh(),e.Es.hi(function(){return e.th()})},this.window.addEventListener("unload",this.bo))},lc.prototype.sh=function(){this.bo&&(this.window.removeEventListener("unload",this.bo),this.bo=null)},lc.prototype.Zo=function(t){var e;try{var n=null!==(null===(e=this.xo)||void 0===e?void 0:e.getItem(this.Xo(t)));return xr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return kr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},lc.prototype.eh=function(){if(this.xo)try{this.xo.setItem(this.Xo(this.clientId),String(Date.now()))}catch(t){kr("Failed to set zombie client id.",t)}},lc.prototype.ih=function(){if(this.xo)try{this.xo.removeItem(this.Xo(this.clientId))}catch(t){}},lc.prototype.Xo=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},lc);function lc(t,e,n,r,i,o,s,u,a,h){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Es=i,this.window=o,this.document=s,this.Po=a,this.Vo=h,this.yo=null,this.po=!1,this.isPrimary=!1,this.networkEnabled=!0,this.bo=null,this.inForeground=!1,this.vo=null,this.So=null,this.Do=Number.NEGATIVE_INFINITY,this.Co=function(t){return Promise.resolve()},!lc.Fs())throw new Jr(Yr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.dr=new vc(this,r),this.No=e+"main",this.serializer=new ih(u),this.Fo=new Ta(this.No,10,new Oh(this.serializer)),this.ko=new nc(this.dr,this.serializer),this.Gn=new $h,this.jn=new Ih(this.serializer,this.Gn),this.window&&this.window.localStorage?this.xo=this.window.localStorage:(this.xo=null,!1===h&&kr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function pc(t,e){var n=this;return(n=ac.call(this)||this).vr=t,n.Ro=e,n}function dc(t){return fc.Ms(t,Lh.store)}function yc(t){return fc.Ms(t,Yh.store)}var vc=(gc.prototype.ir=function(t){var n=this._h(t);return this.db.hh().do(t).next(function(e){return n.next(function(t){return e+t})})},gc.prototype._h=function(t){var e=0;return this.or(t,function(t){e++}).next(function(){return e})},gc.prototype.pe=function(t,e){return this.db.hh().pe(t,e)},gc.prototype.or=function(t,n){return this.fh(t,function(t,e){return n(e)})},gc.prototype.Eo=function(t,e,n){return mc(t,n)},gc.prototype.mo=function(t,e,n){return mc(t,n)},gc.prototype.hr=function(t,e,n){return this.db.hh().hr(t,e,n)},gc.prototype.Dr=mc,gc.prototype.dh=function(t,e){return r=e,i=!1,bh(n=t).Zs(function(t){return vh(n,t,r).next(function(t){return t&&(i=!0),oa.resolve(!t)})}).next(function(){return i});var n,r,i},gc.prototype.ar=function(r,i){var o=this,s=this.db.ah().jr(),u=[],a=0;return this.fh(r,function(e,t){var n;t<=i&&(n=o.dh(r,e).next(function(t){if(!t)return a++,s.On(r,e).next(function(){return s.Mn(e),uc(r).delete([0,eh(e.path)])})}),u.push(n))}).next(function(){return oa.Dn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},gc.prototype.removeTarget=function(t,e){var n=e.Z(t.Ro);return this.db.hh().lo(t,n)},gc.prototype.wh=mc,gc.prototype.fh=function(t,o){var s,e=uc(t),u=fa.Ts;return e.Xs({index:Xh.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==fa.Ts&&o(new ii(rh(s)),u),u=i,s=r):u=fa.Ts}).next(function(){u!==fa.Ts&&o(new ii(rh(s)),u)})},gc.prototype.cr=function(t){return this.db.ah().zr(t)},gc);function gc(t,e){this.db=t,this.Yi=new $a(this,e)}function mc(t,e){return uc(t).put((n=t.Ro,new Xh(0,eh(e.path),n)));var n}function wc(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var bc=(Ec.prototype.Vh=function(i){return g(this,void 0,void 0,function(){var e,m,n,r=this;return w(this,function(t){switch(t.label){case 0:return e=this.Kn,m=this.Rh,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var g;return r.Kn.yr(v).next(function(t){return g=t,e=r.persistence.oh(i),m=new ha(r.Ah,e,r.persistence.uh()),e.yr(v)}).next(function(t){for(var e=[],n=[],r=Ki(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var h=a[u],r=r.add(h.key)}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Xn(v,r).next(function(t){return{gh:t,yh:e,ph:n}})})})];case 1:return n=t.sent(),[2,(this.Kn=e,this.Rh=m,this.Th.Ph(this.Rh),n)]}})})},Ec.prototype.bh=function(h){var c,f=this,l=$r.now(),t=h.reduce(function(t,e){return t.add(e.key)},Ki());return this.persistence.runTransaction("Locally write mutations","readwrite",function(a){return f.Rh.Xn(a,t).next(function(t){c=t;for(var u,e,n=[],r=0,i=h;r<i.length;r++){var o=i[r],s=(u=o,e=c.get(o.key),u instanceof Gs?function(t){for(var e=null,n=0,r=u.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof ou?t.field(i.field):void 0,s=os(i.transform,o||null);null!=s&&(e=null==e?(new Ys).set(i.field,s):e.set(i.field,s))}return e?e.Ge():null}(e):null);null!=s&&n.push(new Vs(o.key,s,function u(t){var a=[];return zr(t.fields||{},function(t,e){var n=new ri([t]);if(ko(e)){var r=u(e.mapValue).fields;if(0===r.length)a.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];a.push(n.child(s))}}else a.push(n)}),new Is(a)}(s.proto.mapValue),_s.exists(!0)))}return f.Kn.mr(a,l,n,h)})}).then(function(t){var e=t.mn(c);return{batchId:t.batchId,Nn:e}})},Ec.prototype.vh=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.Ah.jr({Gr:!0});return i.Sh(t,r,n).next(function(){return n.apply(t)}).next(function(){return i.Kn.Cr(t)}).next(function(){return i.Rh.Xn(t,e)})})},Ec.prototype.Dh=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.Kn.Rr(e,t).next(function(t){return Rr(null!==t),n=t.keys(),r.Kn.br(e,t)}).next(function(){return r.Kn.Cr(e)}).next(function(){return r.Rh.Xn(e,n)})})},Ec.prototype.gr=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Kn.gr(t)})},Ec.prototype.ro=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.ko.ro(t)})},Ec.prototype.Ch=function(a){var h=this,c=a.X,f=this.Eh;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.Ah.jr({Gr:!0});f=h.Eh;var s=[];a.Qt.forEach(function(t,e){var n,r,i=f.get(e);i&&(s.push(h.ko.Io(o,t.Xt,e).next(function(){return h.ko.To(o,t.Yt,e)})),0<(n=t.resumeToken).H()&&(r=i.tt(n,c).Z(o.Ro),f=f.nt(e,r),Ec.Nh(i,r,t)&&s.push(h.ko.lo(o,r))))});var t,u=Fi,n=Ki();return a.jt.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.jt.forEach(function(t,e){var n=r.get(t);e instanceof su&&e.version.isEqual(Zr.min())?(i.Mn(t,c),u=u.nt(t,e)):null==n||0<e.version.o(n.version)||0===e.version.o(n.version)&&n.hasPendingWrites?(i.xn(e,c),u=u.nt(t,e)):xr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Kt.has(t)&&s.push(h.persistence.dr.wh(o,t))})})),c.isEqual(Zr.min())||(t=h.ko.ro(o).next(function(t){return h.ko.ho(o,o.Ro,c)}),s.push(t)),oa.Dn(s).next(function(){return i.apply(o)}).next(function(){return h.Rh.Zn(o,u)})}).then(function(t){return h.Eh=f,t})},Ec.Nh=function(t,e,n){return Rr(0<e.resumeToken.H()),0===t.resumeToken.H()||e.X.m()-t.X.m()>=this.Fh||0<n.Yt.size+n.Jt.size+n.Xt.size},Ec.prototype.kh=function(c){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h=this;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return oa.forEach(c,function(e){return oa.forEach(e.us,function(t){return h.persistence.dr.Eo(n,e.targetId,t)}).next(function(){return oa.forEach(e.cs,function(t){return h.persistence.dr.mo(n,e.targetId,t)})})})})];case 1:return t.sent(),[3,3];case 2:if(!ka(e=t.sent()))throw e;return xr("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=c;n<r.length;n++)i=r[n],o=i.targetId,i.fromCache||(s=this.Eh.get(o),u=s.X,a=s.et(u),this.Eh=this.Eh.nt(o,a));return[2]}})})},Ec.prototype.xh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.Kn.Vr(t,e)})},Ec.prototype.$h=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.Rh.zn(t,e)})},Ec.prototype.Mh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.ko.wo(e,r).next(function(t){return t?(n=t,oa.resolve(n)):i.ko.no(e).next(function(t){return n=new _i(r,t,0,e.Ro),i.ko.ao(e,n).next(function(){return n})})})}).then(function(t){var e=i.Eh.get(t.targetId);return(null===e||0<t.X.o(e.X))&&(i.Eh=i.Eh.nt(t.targetId,t),i.Ih.set(r,t.targetId)),t})},Ec.prototype.wo=function(t,e){var n=this.Ih.get(e);return void 0!==n?oa.resolve(this.Eh.get(n)):this.ko.wo(t,e)},Ec.prototype.Oh=function(o,s){return g(this,void 0,void 0,function(){var e,n,r,i=this;return w(this,function(t){switch(t.label){case 0:e=this.Eh.get(o),n=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,this.persistence.runTransaction("Release target",n,function(t){return i.persistence.dr.removeTarget(t,e)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!ka(r=t.sent()))throw r;return xr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return this.Eh=this.Eh.remove(o),this.Ih.delete(e.target),[2]}})})},Ec.prototype.Lh=function(t,n){var r=this,i=Zr.min(),o=Ki();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.wo(e,mu(t)).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.ko.Ao(e,t.targetId).next(function(t){o=t})}).next(function(){return r.Th.es(e,t,n?i:Zr.min(),n?o:Ki())}).next(function(t){return{documents:t,qh:o}})})},Ec.prototype.Sh=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=oa.resolve();return n.forEach(function(r){u=u.next(function(){return o.On(t,r)}).next(function(t){var e=t,n=i.Rn.get(r);Rr(null!==n),(!e||e.version.o(n)<0)&&(e=s.Tn(r,e,i))&&o.xn(e,i.An)})}),u.next(function(){return e.Kn.br(t,s)})},Ec.prototype.er=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.ur(t,n.Eh)})},Ec);function Ec(t,e,n){this.persistence=t,this.Th=e,this.Eh=new ki(Vr),this.Ih=new Qr(mi,wi),this.mh=Zr.min(),this.Kn=t.oh(n),this.Ah=t.ah(),this.ko=t.hh(),this.Rh=new ha(this.Ah,this.Kn,this.persistence.uh()),this.Th.Ph(this.Rh)}function Ic(t,e){var n=t,r=n.ko,i=n.Eh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Me(t,e).next(function(t){return t?t.target:null})})}function Tc(e){return g(this,void 0,void 0,function(){return w(this,function(t){if(e.code!==Yr.FAILED_PRECONDITION||e.message!==ua)throw e;return xr("LocalStore","Unexpectedly lost primary lease"),[2]})})}bc.Fh=3e8;var Nc=(xc.prototype._=function(){return this.Bh._()},xc.prototype.Eo=function(t,e){var n=new Ac(t,e);this.Bh=this.Bh.add(n),this.Qh=this.Qh.add(n)},xc.prototype.jh=function(t,e){var n=this;t.forEach(function(t){return n.Eo(t,e)})},xc.prototype.mo=function(t,e){this.Kh(new Ac(t,e))},xc.prototype.Gh=function(t,e){var n=this;t.forEach(function(t){return n.mo(t,e)})},xc.prototype.zh=function(t){var e=this,n=new ii(new ei([])),r=new Ac(n,t),i=new Ac(n,t+1),o=[];return this.Qh.vt([r,i],function(t){e.Kh(t),o.push(t.key)}),o},xc.prototype.Hh=function(){var e=this;this.Bh.forEach(function(t){return e.Kh(t)})},xc.prototype.Kh=function(t){this.Bh=this.Bh.delete(t),this.Qh=this.Qh.delete(t)},xc.prototype.Yh=function(t){var e=new ii(new ei([])),n=new Ac(e,t),r=new Ac(e,t+1),i=Ki();return this.Qh.vt([n,r],function(t){i=i.add(t.key)}),i},xc.prototype.Nr=function(t){var e=new Ac(t,0),n=this.Bh.Dt(e);return null!==n&&t.isEqual(n.key)},xc),Ac=(Sc.Uh=function(t,e){return ii.P(t.key,e.key)||Vr(t.Jh,e.Jh)},Sc.Wh=function(t,e){return Vr(t.Jh,e.Jh)||ii.P(t.key,e.key)},Sc),_c=(Dc.prototype.Er=function(){return null!=this.uid},Dc.prototype.Xh=function(){return this.Er()?"uid:"+this.uid:"anonymous-user"},Dc.prototype.isEqual=function(t){return t.uid===this.uid},Dc);function Dc(t){this.uid=t}function Sc(t,e){this.key=t,this.Jh=e}function xc(){this.Bh=new Vi(Ac.Uh),this.Qh=new Vi(Ac.Wh)}_c.UNAUTHENTICATED=new _c(null),_c.Zh=new _c("google-credentials-uid"),_c.ta=new _c("first-party-uid");function kc(t,e){this.user=e,this.type="OAuth",this.ea={},this.ea.Authorization="Bearer "+t}var Oc,Pc,Lc,Rc=(Zc.prototype.getToken=function(){return Promise.resolve(null)},Zc.prototype.sa=function(){},Zc.prototype.ia=function(t){(this.na=t)(_c.UNAUTHENTICATED)},Zc.prototype.ra=function(){this.na=null},Zc),Cc=($c.prototype.getToken=function(){var e=this,n=this.aa,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.aa!==n?(xr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Rr("string"==typeof t.accessToken),new kc(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},$c.prototype.sa=function(){this.forceRefresh=!0},$c.prototype.ia=function(t){this.na=t,this.ha&&t(this.currentUser)},$c.prototype.ra=function(){this.auth&&this.auth.removeAuthTokenListener(this.oa),this.oa=null,this.na=null},$c.prototype.ua=function(){var t=this.auth&&this.auth.getUid();return Rr(null===t||"string"==typeof t),new _c(t)},$c),Uc=(Object.defineProperty(Jc.prototype,"ea",{get:function(){var t={"X-Goog-AuthUser":this.la},e=this.ca.auth._a([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),Jc),Vc=(Yc.prototype.getToken=function(){return Promise.resolve(new Uc(this.ca,this.la))},Yc.prototype.ia=function(t){t(_c.ta)},Yc.prototype.ra=function(){},Yc.prototype.sa=function(){},Yc),Mc=(Qc.prototype.Ia=function(){return 1===this.state||2===this.state||4===this.state},Qc.prototype.ma=function(){return 2===this.state},Qc.prototype.start=function(){3!==this.state?this.auth():this.Aa()},Qc.prototype.stop=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ia()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Qc.prototype.Ra=function(){this.state=0,this.wi.reset()},Qc.prototype.Pa=function(){var t=this;this.ma()&&null===this.Ea&&(this.Ea=this.Es.vs(this.fa,6e4,function(){return t.Va()}))},Qc.prototype.ga=function(t){this.ya(),this.stream.send(t)},Qc.prototype.Va=function(){return g(this,void 0,void 0,function(){return w(this,function(t){return this.ma()?[2,this.close(0)]:[2]})})},Qc.prototype.ya=function(){this.Ea&&(this.Ea.cancel(),this.Ea=null)},Qc.prototype.close=function(e,n){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ya(),this.wi.cancel(),this.Ta++,3!==e?this.wi.reset():n&&n.code===Yr.RESOURCE_EXHAUSTED?(kr(n.toString()),kr("Using maximum backoff delay to prevent overloading the backend."),this.wi.ys()):n&&n.code===Yr.UNAUTHENTICATED&&this.wa.sa(),null!==this.stream&&(this.pa(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.ba(n)];case 1:return t.sent(),[2]}})})},Qc.prototype.pa=function(){},Qc.prototype.auth=function(){var n=this;this.state=1;var t=this.va(this.Ta),e=this.Ta;this.wa.getToken().then(function(t){n.Ta===e&&n.Sa(t)},function(e){t(function(){var t=new Jr(Yr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Da(t)})})},Qc.prototype.Sa=function(t){var e=this,n=this.va(this.Ta);this.stream=this.Ca(t),this.stream.Na(function(){n(function(){return e.state=2,e.listener.Na()})}),this.stream.ba(function(t){n(function(){return e.Da(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Qc.prototype.Aa=function(){var t=this;this.state=4,this.wi.ps(function(){return g(t,void 0,void 0,function(){return w(this,function(t){return this.state=0,this.start(),[2]})})})},Qc.prototype.Da=function(t){return xr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Qc.prototype.va=function(e){var n=this;return function(t){n.Es.hi(function(){return n.Ta===e?t():(xr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Qc),Fc=(n(Wc,Lc=Mc),Wc.prototype.Ca=function(t){return this.da.Fa("Listen",t)},Wc.prototype.onMessage=function(t){this.wi.reset();var e=function(t,e){var n,r,i,o;if("targetChange"in e){e.targetChange;var s="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Lr(),u=e.targetChange.targetIds||[],a=(i=e.targetChange.resumeToken,t.Oe?(Rr(void 0===i||"string"==typeof i),Ei.fromBase64String(i||"")):(Rr(void 0===i||i instanceof Uint8Array),Ei.fromUint8Array(i||new Uint8Array))),h=e.targetChange.cause,c=h&&(r=void 0===(n=h).code?Yr.UNKNOWN:xi(n.code),new Jr(r,n.message||"")),f=new Qi(s,u,a,c||null)}else if("documentChange"in e){e.documentChange;var l=e.documentChange;l.document,l.document.name,l.document.updateTime;var p=Bo(t,l.document.name),d=Fo(l.document.updateTime),y=new Qs({mapValue:{fields:l.document.fields}}),v=new ou(p,d,y,{}),g=l.targetIds||[],m=l.removedTargetIds||[];f=new Hi(g,m,v.key,v)}else if("documentDelete"in e){e.documentDelete;var w=e.documentDelete;w.document;var b=Bo(t,w.document),E=w.readTime?Fo(w.readTime):Zr.min(),I=new su(b,E),T=w.removedTargetIds||[];f=new Hi([],T,I.key,I)}else if("documentRemove"in e){e.documentRemove;var N=e.documentRemove;N.document;var A=Bo(t,N.document),_=N.removedTargetIds||[];f=new Hi([],_,A,null)}else{if(!("filter"in e))return Lr();e.filter;var D=e.filter;D.targetId;var S=D.count||0,x=new Ti(S),k=D.targetId;f=new Wi(k,x)}return f}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Zr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Zr.min():Fo(e.readTime)}(t);return this.listener.ka(e,n)},Wc.prototype.xa=function(t){var e,n,r,i,o={};o.database=Xo(this.serializer),o.addTarget=(e=this.serializer,i=(n=t).target,(r=bi(i)?{documents:Jo(e,i)}:{query:$o(e,i)}).targetId=n.targetId,0<n.resumeToken.H()&&(r.resumeToken=Mo(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.J){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Lr()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.ga(o)},Wc.prototype.$a=function(t){var e={};e.database=Xo(this.serializer),e.removeTarget=t,this.ga(e)},Wc),jc=(n(Hc,Pc=Mc),Object.defineProperty(Hc.prototype,"Oa",{get:function(){return this.Ma},enumerable:!1,configurable:!0}),Hc.prototype.start=function(){this.Ma=!1,this.lastStreamToken=void 0,Pc.prototype.start.call(this)},Hc.prototype.pa=function(){this.Ma&&this.La([])},Hc.prototype.Ca=function(t){return this.da.Fa("Write",t)},Hc.prototype.onMessage=function(t){if(Rr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Ma){this.wi.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(Rr(void 0!==i),r.map(function(t){return function(t,e){var n=t.updateTime?Fo(t.updateTime):Fo(e);n.isEqual(Zr.min())&&(n=Fo(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new As(n,r)}(t,i)})):[]),n=Fo(t.commitTime);return this.listener.qa(n,e)}var r,i;return Rr(!t.writeResults||0===t.writeResults.length),this.Ma=!0,this.listener.Ba()},Hc.prototype.Ua=function(){var t={};t.database=Xo(this.serializer),this.ga(t)},Hc.prototype.La=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Qo(e.serializer,t)})};this.ga(n)},Hc),qc=(n(Xc,Oc=function(){}),Xc.prototype.Wa=function(){if(this.Qa)throw new Jr(Yr.FAILED_PRECONDITION,"The client has already been terminated.")},Xc.prototype.ja=function(e,n,r){var i=this;return this.Wa(),this.credentials.getToken().then(function(t){return i.da.ja(e,n,r,t)}).catch(function(t){throw t.code===Yr.UNAUTHENTICATED&&i.credentials.sa(),t})},Xc.prototype.Ka=function(e,n,r){var i=this;return this.Wa(),this.credentials.getToken().then(function(t){return i.da.Ka(e,n,r,t)}).catch(function(t){throw t.code===Yr.UNAUTHENTICATED&&i.credentials.sa(),t})},Xc.prototype.terminate=function(){this.Qa=!1},Xc),Gc=(Kc.prototype.Ja=function(){var t=this;0===this.za&&(this.Xa("Unknown"),this.Ha=this.ti.vs("online_state_timeout",1e4,function(){return t.Ha=null,t.Za("Backend didn't respond within 10 seconds."),t.Xa("Offline"),Promise.resolve()}))},Kc.prototype.tu=function(t){"Online"===this.state?this.Xa("Unknown"):(this.za++,1<=this.za&&(this.eu(),this.Za("Connection failed 1 times. Most recent error: "+t.toString()),this.Xa("Offline")))},Kc.prototype.set=function(t){this.eu(),this.za=0,"Online"===t&&(this.Ya=!1),this.Xa(t)},Kc.prototype.Xa=function(t){t!==this.state&&(this.state=t,this.Ga(t))},Kc.prototype.Za=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Ya?(kr(e),this.Ya=!1):xr("OnlineStateTracker",e)},Kc.prototype.eu=function(){null!==this.Ha&&(this.Ha.cancel(),this.Ha=null)},Kc),Bc=(zc.prototype.start=function(){return this.enableNetwork()},zc.prototype.enableNetwork=function(){return this.hu.delete(0),this.Ru()},zc.prototype.Ru=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.cu()?(this.Pu()?this.Vu():this._u.set("Unknown"),[4,this.gu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},zc.prototype.disableNetwork=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.hu.add(0),[4,this.yu()];case 1:return t.sent(),this._u.set("Offline"),[2]}})})},zc.prototype.yu=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.Eu.stop()];case 1:return t.sent(),[4,this.fu.stop()];case 2:return t.sent(),0<this.iu.length&&(xr("RemoteStore","Stopping write stream with "+this.iu.length+" pending writes"),this.iu=[]),this.pu(),[2]}})})},zc.prototype.th=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return xr("RemoteStore","RemoteStore shutting down."),this.hu.add(5),[4,this.yu()];case 1:return t.sent(),this.au.th(),this._u.set("Unknown"),[2]}})})},zc.prototype.listen=function(t){this.ru.has(t.targetId)||(this.ru.set(t.targetId,t),this.Pu()?this.Vu():this.fu.ma()&&this.bu(t))},zc.prototype.vu=function(t){this.ru.delete(t),this.fu.ma()&&this.Su(t),0===this.ru.size&&(this.fu.ma()?this.fu.Pa():this.cu()&&this._u.set("Unknown"))},zc.prototype.Me=function(t){return this.ru.get(t)||null},zc.prototype.$e=function(t){return this.Du.$e(t)},zc.prototype.bu=function(t){this.ou.de(t.targetId),this.fu.xa(t)},zc.prototype.Su=function(t){this.ou.de(t),this.fu.$a(t)},zc.prototype.Vu=function(){this.ou=new no(this),this.fu.start(),this._u.Ja()},zc.prototype.Pu=function(){return this.cu()&&!this.fu.Ia()&&0<this.ru.size},zc.prototype.cu=function(){return 0===this.hu.size},zc.prototype.pu=function(){this.ou=null},zc.prototype.du=function(){return g(this,void 0,void 0,function(){var n=this;return w(this,function(t){return this.ru.forEach(function(t,e){n.bu(t)}),[2]})})},zc.prototype.wu=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){return this.pu(),this.Pu()?(this._u.tu(e),this.Vu()):this._u.set("Unknown"),[2]})})},zc.prototype.Tu=function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:if(this._u.set("Online"),!(i instanceof Qi&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.Cu(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),xr("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.Nu(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof Hi?this.ou.Pe(i):i instanceof Wi?this.ou.De(i):this.ou.ye(i),o.isEqual(Zr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.nu.ro()];case 8:return n=t.sent(),0<=o.o(n)?[4,this.Fu(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return xr("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.Nu(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},zc.prototype.Nu=function(n,r){return g(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:if(!ka(n))throw n;return this.hu.add(1),[4,this.yu()];case 1:return t.sent(),this._u.set("Offline"),r=r||function(){return e.nu.ro()},this.ti.Vi(function(){return g(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return xr("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return t.sent(),this.hu.delete(1),[4,this.Ru()];case 2:return t.sent(),[2]}})})}),[2]}})})},zc.prototype.ku=function(e){var n=this;return e().catch(function(t){return n.Nu(t,e)})},zc.prototype.Fu=function(r){var i=this,t=this.ou.Fe(r);return t.Qt.forEach(function(t,e){var n;0<t.resumeToken.H()&&(n=i.ru.get(e))&&i.ru.set(e,n.tt(t.resumeToken,r))}),t.Wt.forEach(function(t){var e,n=i.ru.get(t);n&&(i.ru.set(t,n.tt(Ei.Y,n.X)),i.Su(t),e=new _i(n.target,t,1,n.sequenceNumber),i.bu(e))}),this.Du.Ch(t)},zc.prototype.Cu=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.ru.has(i)?[4,this.Du.xu(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.ru.delete(i),this.ou.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},zc.prototype.gu=function(){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:e=0<this.iu.length?this.iu[this.iu.length-1].batchId:-1,t.label=1;case 1:if(!this.$u())return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,this.nu.xh(e)];case 3:return null===(n=t.sent())?(0===this.iu.length&&this.Eu.Pa(),[3,7]):(e=n.batchId,this.Mu(n),[3,6]);case 4:return r=t.sent(),[4,this.Nu(r)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return this.Ou()&&this.Lu(),[2]}})})},zc.prototype.$u=function(){return this.cu()&&this.iu.length<10},zc.prototype.qu=function(){return this.iu.length},zc.prototype.Mu=function(t){this.iu.push(t),this.Eu.ma()&&this.Eu.Oa&&this.Eu.La(t.mutations)},zc.prototype.Ou=function(){return this.cu()&&!this.Eu.Ia()&&0<this.iu.length},zc.prototype.Lu=function(){this.Eu.start()},zc.prototype.Iu=function(){return g(this,void 0,void 0,function(){return w(this,function(t){return this.Eu.Ua(),[2]})})},zc.prototype.Au=function(){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){for(e=0,n=this.iu;e<n.length;e++)r=n[e],this.Eu.La(r.mutations);return[2]})})},zc.prototype.qa=function(i,o){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return e=this.iu.shift(),n=ia.from(e,i,o),[4,this.ku(function(){return r.Du.Bu(n)})];case 1:return t.sent(),[4,this.gu()];case 2:return t.sent(),[2]}})})},zc.prototype.mu=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e&&this.Eu.Oa?[4,this.Uu(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Ou()&&this.Lu(),[2]}})})},zc.prototype.Uu=function(i){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return Si(n=i.code)&&n!==Yr.ABORTED?(e=this.iu.shift(),this.Eu.Ra(),[4,this.ku(function(){return r.Du.Qu(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,this.gu()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},zc.prototype.lu=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.hu.add(4),[4,this.yu()];case 1:return t.sent(),this._u.set("Unknown"),this.Eu.Ra(),this.fu.Ra(),this.hu.delete(4),[4,this.Ru()];case 2:return t.sent(),[2]}})})},zc.prototype.Wu=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ti.pi(),xr("RemoteStore","RemoteStore received new credentials"),this.hu.add(3),[4,this.yu()];case 1:return t.sent(),this._u.set("Unknown"),[4,this.Du.Wu(e)];case 2:return t.sent(),this.hu.delete(3),[4,this.Ru()];case 3:return t.sent(),[2]}})})},zc.prototype.ju=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(this.hu.delete(2),[4,this.Ru()]):[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:(this.hu.add(2),[4,this.yu()]);case 3:t.sent(),this._u.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},zc);function zc(t,e,n,r,i){var o,s,u,a,h,c,f,l,p=this;this.nu=t,this.su=e,this.ti=n,this.iu=[],this.ru=new Map,this.ou=null,this.hu=new Set,this.au=i,this.au.uu(function(t){n.hi(function(){return g(p,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.cu()?(xr("RemoteStore","Restarting streams for network reachability change."),[4,this.lu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this._u=new Gc(n,r),this.fu=(h=this.su,c=n,f={Na:this.du.bind(this),ba:this.wu.bind(this),ka:this.Tu.bind(this)},(l=h).Wa(),new Fc(c,l.da,l.credentials,l.serializer,f)),this.Eu=(o=this.su,s=n,u={Na:this.Iu.bind(this),ba:this.mu.bind(this),Ba:this.Au.bind(this),qa:this.qa.bind(this)},(a=o).Wa(),new jc(s,a.da,a.credentials,a.serializer,u))}function Kc(t,e){this.ti=t,this.Ga=e,this.state="Unknown",this.za=0,this.Ha=null,this.Ya=!0}function Xc(t,e,n){var r=this;return(r=Oc.call(this)||this).credentials=t,r.da=e,r.serializer=n,r.Qa=!1,r}function Hc(t,e,n,r,i){var o=this;return(o=Pc.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Ma=!1,o}function Wc(t,e,n,r,i){var o=this;return(o=Lc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Qc(t,e,n,r,i,o){this.Es=t,this.fa=n,this.da=r,this.wa=i,this.listener=o,this.state=0,this.Ta=0,this.Ea=null,this.stream=null,this.wi=new Ia(t,e)}function Yc(t,e){this.ca=t,this.la=e}function Jc(t,e){this.ca=t,this.la=e,this.type="FirstParty",this.user=_c.ta}function $c(t){var e=this;this.oa=null,this.currentUser=_c.UNAUTHENTICATED,this.ha=!1,this.aa=0,this.na=null,this.forceRefresh=!1,this.oa=function(){e.aa++,e.currentUser=e.ua(),e.ha=!0,e.na&&e.na(e.currentUser)},this.aa=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oa):(this.oa(null),t.get().then(function(t){e.auth=t,e.oa&&e.auth.addAuthTokenListener(e.oa)},function(){}))}function Zc(){this.na=null}function tf(t,e){return"firestore_clients_"+t+"_"+e}function ef(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Er()&&(r+="_"+e.uid),r}function nf(t,e){return"firestore_targets_"+t+"_"+e}function rf(t){this.key=t}function of(t){this.key=t}function sf(t,e,n){this.query=t,this.targetId=e,this.view=n}function uf(t){this.key=t,this.el=!1}var af=(Af.Ku=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Jr(r.error.code,r.error.message)),i?new Af(t,e,r.state,o):(kr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Af.prototype.Gu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Af),hf=(Nf.Ku=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Jr(n.error.code,n.error.message)),r?new Nf(t,n.state,i):(kr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Nf.prototype.Gu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Nf),cf=(Tf.Ku=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Xi,o=0;r&&o<n.activeTargetIds.length;++o)r=yi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Tf(t,i):(kr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Tf),ff=(If.Ku=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new If(e.clientId,e.onlineState):(kr("SharedClientState","Failed to parse online state: "+t),null)},If),lf=(Ef.prototype.zu=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Ef.prototype.Hu=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Ef.prototype.Gu=function(){var t={activeTargetIds:this.activeTargetIds.N(),updateTimeMs:Date.now()};return JSON.stringify(t)},Ef),pf=(bf.Fs=function(t){return!(!t||!t.localStorage)},bf.prototype.start=function(){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return w(this,function(t){switch(t.label){case 0:return[4,this.Du.rh()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.Yu&&(o=this.getItem(tf(this.persistenceKey,i)))&&(s=cf.Ku(i,o))&&(this.Zu=this.Zu.nt(s.clientId,s));for(this.hc(),(u=this.storage.getItem(this.oc))&&(a=this.ac(u))&&this.uc(a),h=0,c=this.tc;h<c.length;h++)f=c[h],this.Xu(f);return this.tc=[],this.window.addEventListener("unload",function(){return l.th()}),this.tr=!0,[2]}})})},bf.prototype.ws=function(t){this.setItem(this.nc,JSON.stringify(t))},bf.prototype.cc=function(){return this.lc(this.Zu)},bf.prototype._c=function(n){var r=!1;return this.Zu.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},bf.prototype.fc=function(t){this.dc(t,"pending")},bf.prototype.wc=function(t,e,n){this.dc(t,e,n),this.Tc(t)},bf.prototype.Ec=function(t){var e,n,r="not-current";return this._c(t)&&(!(e=this.storage.getItem(nf(this.persistenceKey,t)))||(n=hf.Ku(t,e))&&(r=n.state)),this.Ic.zu(t),this.hc(),r},bf.prototype.mc=function(t){this.Ic.Hu(t),this.hc()},bf.prototype.Ac=function(t){return this.Ic.activeTargetIds.has(t)},bf.prototype.Rc=function(t){this.removeItem(nf(this.persistenceKey,t))},bf.prototype.Pc=function(t,e,n){this.Vc(t,e,n)},bf.prototype.Vh=function(t,e,n){var r=this;e.forEach(function(t){r.Tc(t)}),this.currentUser=t,n.forEach(function(t){r.fc(t)})},bf.prototype.gc=function(t){this.yc(t)},bf.prototype.th=function(){this.tr&&(this.window.removeEventListener("storage",this.Ju),this.removeItem(this.ec),this.tr=!1)},bf.prototype.getItem=function(t){var e=this.storage.getItem(t);return xr("SharedClientState","READ",t,e),e},bf.prototype.setItem=function(t,e){xr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},bf.prototype.removeItem=function(t){xr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},bf.prototype.Xu=function(t){var e=this,u=t;if(u.storageArea===this.storage){if(xr("SharedClientState","EVENT",u.key,u.newValue),u.key===this.ec)return void kr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Es.Vi(function(){return g(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){if(this.tr){if(null!==u.key)if(this.sc.test(u.key)){if(null==u.newValue)return e=this.pc(u.key),[2,this.bc(e,null)];if(n=this.vc(u.key,u.newValue))return[2,this.bc(n.clientId,n)]}else if(this.ic.test(u.key)){if(null!==u.newValue&&(r=this.Sc(u.key,u.newValue)))return[2,this.Dc(r)]}else if(this.rc.test(u.key)){if(null!==u.newValue&&(i=this.Cc(u.key,u.newValue)))return[2,this.Nc(i)]}else if(u.key===this.oc){if(null!==u.newValue&&(o=this.ac(u.newValue)))return[2,this.uc(o)]}else u.key===this.nc&&(s=function(t){var e=fa.Ts;if(null!=t)try{var n=JSON.parse(t);Rr("number"==typeof n),e=n}catch(t){kr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==fa.Ts&&this._s(s)}else this.tc.push(u);return[2]})})})}},Object.defineProperty(bf.prototype,"Ic",{get:function(){return this.Zu.get(this.Yu)},enumerable:!1,configurable:!0}),bf.prototype.hc=function(){this.setItem(this.ec,this.Ic.Gu())},bf.prototype.dc=function(t,e,n){var r=new af(this.currentUser,t,e,n),i=ef(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Gu())},bf.prototype.Tc=function(t){var e=ef(this.persistenceKey,this.currentUser,t);this.removeItem(e)},bf.prototype.yc=function(t){var e={clientId:this.Yu,onlineState:t};this.storage.setItem(this.oc,JSON.stringify(e))},bf.prototype.Vc=function(t,e,n){var r=nf(this.persistenceKey,t),i=new hf(t,e,n);this.setItem(r,i.Gu())},bf.prototype.pc=function(t){var e=this.sc.exec(t);return e?e[1]:null},bf.prototype.vc=function(t,e){var n=this.pc(t);return cf.Ku(n,e)},bf.prototype.Sc=function(t,e){var n=this.ic.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return af.Ku(new _c(i),r,e)},bf.prototype.Cc=function(t,e){var n=this.rc.exec(t),r=Number(n[1]);return hf.Ku(r,e)},bf.prototype.ac=function(t){return ff.Ku(t)},bf.prototype.Dc=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.Du.Fc(e.batchId,e.state,e.error)]:(xr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},bf.prototype.Nc=function(t){return this.Du.kc(t.targetId,t.state,t.error)},bf.prototype.bc=function(t,e){var n=this,r=e?this.Zu.nt(t,e):this.Zu.remove(t),i=this.lc(this.Zu),o=this.lc(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.Du.xc(s,u).then(function(){n.Zu=r})},bf.prototype.uc=function(t){this.Zu.get(t.clientId)&&this.Ga(t.onlineState)},bf.prototype.lc=function(t){var n=Xi;return t.forEach(function(t,e){n=n.Ct(e.activeTargetIds)}),n},bf),df=(wf.prototype.fc=function(t){},wf.prototype.wc=function(t,e,n){},wf.prototype.Ec=function(t){return this.$c.zu(t),this.Mc[t]||"not-current"},wf.prototype.Pc=function(t,e,n){this.Mc[t]=e},wf.prototype.mc=function(t){this.$c.Hu(t)},wf.prototype.Ac=function(t){return this.$c.activeTargetIds.has(t)},wf.prototype.Rc=function(t){delete this.Mc[t]},wf.prototype.cc=function(){return this.$c.activeTargetIds},wf.prototype._c=function(t){return this.$c.activeTargetIds.has(t)},wf.prototype.start=function(){return this.$c=new lf,Promise.resolve()},wf.prototype.Vh=function(t,e,n){},wf.prototype.gc=function(t){},wf.prototype.th=function(){},wf.prototype.ws=function(t){},wf),yf=(Object.defineProperty(mf.prototype,"Qc",{get:function(){return this.Oc},enumerable:!1,configurable:!0}),mf.prototype.Wc=function(t,e){var u=this,a=e?e.jc:new Ji,h=e?e.Uc:this.Uc,c=e?e.Lt:this.Lt,f=h,l=!1,p=this.query.hn()&&h.size===this.query.limit?h.last():null,d=this.query.an()&&h.size===this.query.limit?h.first():null;if(t.ot(function(t,e){var n=h.get(t),r=(r=e instanceof ou?e:null)&&(Au(u.query,r)?r:null),i=!!n&&u.Lt.has(n.key),o=!!r&&(r.Ke||u.Lt.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.Kc(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.Bc(r,p)||d&&u.Bc(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.hn()||this.query.an())for(;f.size>this.query.limit;){var n=this.query.hn()?f.last():f.first(),f=f.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{Uc:f,jc:a,Gc:l,Lt:c}},mf.prototype.Kc=function(t,e){return t.Ke&&e.hasCommittedMutations&&!e.Ke},mf.prototype.Bn=function(t,e,n){var o=this,r=this.Uc;this.Uc=t.Uc,this.Lt=t.Lt;var i=t.jc.Mt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.Bc(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Lr()}}var r,i}),this.zc(n);var s=e?this.Hc():[],u=0===this.qc.size&&this.Ht?1:0,a=u!==this.Lc;return this.Lc=u,0!==i.length||a?{snapshot:new $i(this.query,t.Uc,r,i,t.Lt,0==u,a,!1),Yc:s}:{Yc:s}},mf.prototype.Jc=function(t){return this.Ht&&"Offline"===t?(this.Ht=!1,this.Bn({Uc:this.Uc,jc:new Ji,Lt:this.Lt,Gc:!1},!1)):{Yc:[]}},mf.prototype.Xc=function(t){return!this.Oc.has(t)&&!!this.Uc.has(t)&&!this.Uc.get(t).Ke},mf.prototype.zc=function(t){var e=this;t&&(t.Yt.forEach(function(t){return e.Oc=e.Oc.add(t)}),t.Jt.forEach(function(t){}),t.Xt.forEach(function(t){return e.Oc=e.Oc.delete(t)}),this.Ht=t.Ht)},mf.prototype.Hc=function(){var e=this;if(!this.Ht)return[];var n=this.qc;this.qc=Ki(),this.Uc.forEach(function(t){e.Xc(t.key)&&(e.qc=e.qc.add(t.key))});var r=[];return n.forEach(function(t){e.qc.has(t)||r.push(new of(t))}),this.qc.forEach(function(t){n.has(t)||r.push(new rf(t))}),r},mf.prototype.Zc=function(t){this.Oc=t.qh,this.qc=Ki();var e=this.Wc(t.documents);return this.Bn(e,!0)},mf.prototype.tl=function(){return $i.Ut(this.query,this.Uc,this.Lt,0===this.Lc)},mf),vf=(Object.defineProperty(gf.prototype,"Tl",{get:function(){return!0===this.wl},enumerable:!1,configurable:!0}),gf.prototype.subscribe=function(t){this.rl=t},gf.prototype.listen=function(s){return g(this,void 0,void 0,function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:return this.El("listen()"),(r=this.ol.get(s))?(e=r.targetId,this.sl.Ec(e),n=r.view.tl(),[3,4]):[3,1];case 1:return[4,this.nu.Mh(mu(s))];case 2:return i=t.sent(),o=this.sl.Ec(i.targetId),e=i.targetId,[4,this.Il(s,e,"current"===o)];case 3:n=t.sent(),this.Tl&&this.nl.listen(i),t.label=4;case 4:return[2,n]}})})},gf.prototype.Il=function(u,a,h){return g(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return[4,this.nu.Lh(u,!0)];case 1:return e=t.sent(),n=new yf(u,e.qh),r=n.Wc(e.documents),i=to.zt(a,h&&"Offline"!==this.onlineState),o=n.Bn(r,this.Tl,i),this.ml(a,o.Yc),s=new sf(u,a,n),[2,(this.ol.set(u,s),this.hl.has(a)?this.hl.get(a).push(u):this.hl.set(a,[u]),o.snapshot)]}})})},gf.prototype.vu=function(i){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return this.El("unlisten()"),e=this.ol.get(i),1<(n=this.hl.get(e.targetId)).length?[2,(this.hl.set(e.targetId,n.filter(function(t){return!Iu(t,i)})),void this.ol.delete(i))]:this.Tl?(this.sl.mc(e.targetId),this.sl._c(e.targetId)?[3,2]:[4,this.nu.Oh(e.targetId,!1).then(function(){r.sl.Rc(e.targetId),r.nl.vu(e.targetId),r.Al(e.targetId)}).catch(Tc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.Al(e.targetId),[4,this.nu.Oh(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},gf.prototype.write=function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:this.El("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this.nu.bh(i)];case 2:return e=t.sent(),this.sl.fc(e.batchId),this.Rl(e.batchId,o),[4,this.Pl(e.Nn)];case 3:return t.sent(),[4,this.nl.gu()];case 4:return t.sent(),[3,6];case 5:return n=t.sent(),r=za(n,"Failed to persist write"),o.reject(r),[3,6];case 6:return[2]}})})},gf.prototype.Ch=function(n){return g(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:this.El("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.nu.Ch(n)];case 2:return e=t.sent(),n.Qt.forEach(function(t,e){var n=r.cl.get(e);n&&(Rr(t.Yt.size+t.Jt.size+t.Xt.size<=1),0<t.Yt.size?n.el=!0:0<t.Jt.size?Rr(n.el):0<t.Xt.size&&(Rr(n.el),n.el=!1))}),[4,this.Pl(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,Tc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},gf.prototype.Jc=function(r,t){var i;(this.Tl&&0===t||!this.Tl&&1===t)&&(this.El("applyOnlineStateChange()"),i=[],this.ol.forEach(function(t,e){var n=e.view.Jc(r);n.snapshot&&i.push(n.snapshot)}),this.rl.Vl(r),this.rl.ka(i),this.onlineState=r,this.Tl&&this.sl.gc(r))},gf.prototype.xu=function(u,a){return g(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return w(this,function(t){switch(t.label){case 0:return this.El("rejectListens()"),this.sl.Pc(u,"rejected",a),e=this.cl.get(u),(n=e&&e.key)?(r=(r=new ki(ii.P)).nt(n,new su(n,Zr.min())),i=Ki().add(n),o=new Zi(Zr.min(),new Map,new Vi(Vr),r,i),[4,this.Ch(o)]):[3,2];case 1:return t.sent(),this.ul=this.ul.remove(n),this.cl.delete(u),this.gl(),[3,4];case 2:return[4,this.nu.Oh(u,!1).then(function(){return s.Al(u,a)}).catch(Tc)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},gf.prototype.Bu=function(r){return g(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:this.El("applySuccessfulWrite()"),e=r.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.nu.vh(r)];case 2:return n=t.sent(),this.yl(e,null),this.pl(e),this.sl.wc(e,"acknowledged"),[4,this.Pl(n)];case 3:return t.sent(),[3,6];case 4:return[4,Tc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},gf.prototype.Qu=function(n,r){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:this.El("rejectFailedWrite()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.nu.Dh(n)];case 2:return e=t.sent(),this.yl(n,r),this.pl(n),this.sl.wc(n,"rejected",r),[4,this.Pl(e)];case 3:return t.sent(),[3,6];case 4:return[4,Tc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},gf.prototype.bl=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:this.nl.cu()||xr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.nu.gr()];case 2:return-1===(e=t.sent())?[2,void o.resolve()]:((n=this.fl.get(e)||[]).push(o),this.fl.set(e,n),[3,4]);case 3:return r=t.sent(),i=za(r,"Initialization of waitForPendingWrites() operation failed"),o.reject(i),[3,4];case 4:return[2]}})})},gf.prototype.pl=function(t){(this.fl.get(t)||[]).forEach(function(t){t.resolve()}),this.fl.delete(t)},gf.prototype.vl=function(e){this.fl.forEach(function(t){t.forEach(function(t){t.reject(new Jr(Yr.CANCELLED,e))})}),this.fl.clear()},gf.prototype.Rl=function(t,e){var n=this._l[this.currentUser.Xh()];n=(n=n||new ki(Vr)).nt(t,e),this._l[this.currentUser.Xh()]=n},gf.prototype.yl=function(t,e){var n,r=this._l[this.currentUser.Xh()];r&&((n=r.get(t))&&(e?n.reject(e):n.resolve(),r=r.remove(t)),this._l[this.currentUser.Xh()]=r)},gf.prototype.Al=function(t,e){var n=this;void 0===e&&(e=null),this.sl.mc(t);for(var r=0,i=this.hl.get(t);r<i.length;r++){var o=i[r];this.ol.delete(o),e&&this.rl.Sl(o,e)}this.hl.delete(t),this.Tl&&this.ll.zh(t).forEach(function(t){n.ll.Nr(t)||n.Dl(t)})},gf.prototype.Dl=function(t){var e=this.ul.get(t);null!==e&&(this.nl.vu(e),this.ul=this.ul.remove(t),this.cl.delete(e),this.gl())},gf.prototype.ml=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof rf?(this.ll.Eo(i.key,t),this.Cl(i)):i instanceof of?(xr("SyncEngine","Document no longer in limbo: "+i.key),this.ll.mo(i.key,t),this.ll.Nr(i.key)||this.Dl(i.key)):Lr()}},gf.prototype.Cl=function(t){var e=t.key;this.ul.get(e)||(xr("SyncEngine","New document in limbo: "+e),this.al.push(e),this.gl())},gf.prototype.gl=function(){for(;0<this.al.length&&this.ul.size<this.il;){var t=this.al.shift(),e=this.dl.next();this.cl.set(e,new uf(t)),this.ul=this.ul.nt(t,e),this.nl.listen(new _i(mu(yu(t.path)),e,2,fa.Ts))}},gf.prototype.Nl=function(){return this.ul},gf.prototype.Fl=function(){return this.al},gf.prototype.Pl=function(r,a){return g(this,void 0,void 0,function(){var o,s,e,u=this;return w(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.ol.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Wc(r);return n.Gc?u.nu.Lh(i.query,!1).then(function(t){var e=t.documents;return i.view.Wc(e,n)}):n}).then(function(t){var e,n=a&&a.Qt.get(i.targetId),r=i.view.Bn(t,u.Tl,n);u.ml(i.targetId,r.Yc),r.snapshot&&(u.Tl&&u.sl.Pc(i.targetId,r.snapshot.fromCache?"not-current":"current"),o.push(r.snapshot),e=ca.ls(i.targetId,r.snapshot),s.push(e))}))}),[4,Promise.all(e)];case 1:return t.sent(),this.rl.ka(o),[4,this.nu.kh(s)];case 2:return t.sent(),[2]}})})},gf.prototype.El=function(t){},gf.prototype.Wu=function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return this.currentUser.isEqual(n)?[3,3]:(xr("SyncEngine","User change. New user:",n.Xh()),[4,this.nu.Vh(n)]);case 1:return e=t.sent(),this.currentUser=n,this.vl("'waitForPendingWrites' promise is rejected due to a user change."),this.sl.Vh(n,e.yh,e.ph),[4,this.Pl(e.gh)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},gf.prototype.$e=function(t){var e=this.cl.get(t);if(e&&e.el)return Ki().add(e.key);var n=Ki(),r=this.hl.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++)var s=o[i],u=this.ol.get(s),n=n.Ct(u.view.Qc);return n},gf);function gf(t,e,n,r,i,o){this.nu=t,this.nl=e,this.su=n,this.sl=r,this.currentUser=i,this.il=o,this.rl=null,this.ol=new Qr(Tu,Iu),this.hl=new Map,this.al=[],this.ul=new ki(ii.P),this.cl=new Map,this.ll=new Nc,this._l={},this.fl=new Map,this.dl=ec.eo(),this.onlineState="Unknown",this.wl=void 0}function mf(t,e){this.query=t,this.Oc=e,this.Lc=null,this.Ht=!1,this.qc=Ki(),this.Lt=Ki(),this.Bc=_u(t),this.Uc=new Yi(this.Bc)}function wf(){this.$c=new lf,this.Mc={},this.Ga=null,this._s=null}function bf(t,e,n,r,i){this.window=t,this.Es=e,this.persistenceKey=n,this.Yu=r,this.Du=null,this.Ga=null,this._s=null,this.Ju=this.Xu.bind(this),this.Zu=new ki(Vr),this.tr=!1,this.tc=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ec=tf(this.persistenceKey,this.Yu),this.nc="firestore_sequence_number_"+this.persistenceKey,this.Zu=this.Zu.nt(this.Yu,new lf),this.sc=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.ic=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.rc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.oc="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.Ju)}function Ef(){this.activeTargetIds=Xi}function If(t,e){this.clientId=t,this.onlineState=e}function Tf(t,e){this.clientId=t,this.activeTargetIds=e}function Nf(t,e,n){this.targetId=t,this.state=e,this.error=n}function Af(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function _f(u,a,h,c){return g(this,void 0,void 0,function(){var o,s;return w(this,function(t){switch(t.label){case 0:return(o=u).El("applyBatchState()"),[4,(e=o.nu,n=a,i=(r=e).Kn,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Pr(e,n).next(function(t){return t?r.Rh.Xn(e,t):oa.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==h?[3,3]:[4,o.nl.gu()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===h||"rejected"===h?(o.yl(a,c||null),o.nu.Kn.Sr(a)):Lr(),t.label=4;case 4:return[4,o.Pl(s)];case 5:return t.sent(),[3,7];case 6:xr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function Df(c,f){return g(this,void 0,void 0,function(){var r,e,i,o,s,u,a,h;return w(this,function(t){switch(t.label){case 0:return r=c,!0!==f||!0===r.wl?[3,3]:(e=r.sl.cc(),[4,Sf(r,e.N())]);case 1:return i=t.sent(),r.wl=!0,[4,r.nl.ju(!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],r.nl.listen(u);return[3,7];case 3:return!1!==f||!1===r.wl?[3,7]:(a=[],h=Promise.resolve(),r.hl.forEach(function(t,e){r.sl.Ac(e)?a.push(e):h=h.then(function(){return r.Al(e),r.nu.Oh(e,!0)}),r.nl.vu(e)}),[4,h]);case 4:return t.sent(),[4,Sf(r,a)];case 5:return t.sent(),(n=r).cl.forEach(function(t,e){n.nl.vu(e)}),n.ll.Hh(),n.cl=new Map,n.ul=new ki(ii.P),r.wl=!1,[4,r.nl.ju(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Sf(y,v){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p,d;return w(this,function(t){switch(t.label){case 0:e=y,n=[],r=[],i=0,o=v,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.hl.get(s))&&0!==a.length?[4,e.nu.Mh(mu(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),h=0,c=a,t.label=3;case 3:return h<c.length?(f=c[h],l=e.ol.get(f),[4,function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return[4,(e=i).nu.Lh(o.query,!0)];case 1:return n=t.sent(),r=o.view.Zc(n),[2,(e.Tl&&e.ml(o.targetId,r.Yc),r)]}})})}(e,l)]):[3,6];case 4:(p=t.sent()).snapshot&&r.push(p.snapshot),t.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Ic(e.nu,s)];case 8:return d=t.sent(),[4,e.nu.Mh(d)];case 9:return u=t.sent(),[4,e.Il(xf(d),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.rl.ka(r),n)]}})})}function xf(t){return du(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function kf(s,u,a,h){return g(this,void 0,void 0,function(){var n,i,o;return w(this,function(t){switch(t.label){case 0:return(n=s).wl?(xr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!n.hl.has(u))return[3,8];switch(a){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,(r=n.nu,e=r.Ah,r.persistence.runTransaction("Get new document changes","readonly",function(t){return e.Ur(t,r.mh)}).then(function(t){var e=t.Qr,n=t.readTime;return r.mh=n,e}))];case 3:return i=t.sent(),o=Zi.Gt(u,"current"===a),[4,n.Pl(i,o)];case 4:return t.sent(),[3,8];case 5:return[4,n.nu.Oh(u,!0)];case 6:return t.sent(),n.Al(u,h),[3,8];case 7:Lr(),t.label=8;case 8:return[2]}var r,e})})}function Of(){this.kl=void 0,this.listeners=[]}var Pf,Lf=(Gf.prototype.listen=function(u){return g(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.xl.get(e))||(n=!0,r=new Of),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.Du.listen(e)];case 2:return i.kl=t.sent(),[3,4];case 3:return o=t.sent(),s=za(o,"Initialization of query '"+Nu(u.query)+"' failed"),[2,void u.onError(s)];case 4:return this.xl.set(e,r),r.listeners.push(u),u.Jc(this.onlineState),r.kl&&u.Ml(r.kl)&&this.Ol(),[2]}})})},Gf.prototype.vu=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){return e=o.query,n=!1,(r=this.xl.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?[2,(this.xl.delete(e),this.Du.vu(e))]:[2]})})},Gf.prototype.ka=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.xl.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].Ml(i)&&(e=!0);s.kl=i}}e&&this.Ol()},Gf.prototype.Sl=function(t,e){var n=this.xl.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.xl.delete(t)},Gf.prototype.Vl=function(i){this.onlineState=i;var o=!1;this.xl.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Jc(i)&&(o=!0)}),o&&this.Ol()},Gf.prototype.Ll=function(t){this.$l.add(t),t.next()},Gf.prototype.ql=function(t){this.$l.delete(t)},Gf.prototype.Ol=function(){this.$l.forEach(function(t){t.next()})},Gf),Rf=(qf.prototype.Ml=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new $i(t.query,t.docs,t.Ot,e,t.Lt,t.fromCache,t.qt,!0)}var o=!1;return this.Ul?this.Wl(t)&&(this.Bl.next(t),o=!0):this.jl(t,this.onlineState)&&(this.Kl(t),o=!0),this.Ql=t,o},qf.prototype.onError=function(t){this.Bl.error(t)},qf.prototype.Jc=function(t){this.onlineState=t;var e=!1;return this.Ql&&!this.Ul&&this.jl(this.Ql,t)&&(this.Kl(this.Ql),e=!0),e},qf.prototype.jl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Gl&&n||t.docs._()&&"Offline"!==e)},qf.prototype.Wl=function(t){if(0<t.docChanges.length)return!0;var e=this.Ql&&this.Ql.hasPendingWrites!==t.hasPendingWrites;return!(!t.qt&&!e)&&!0===this.options.includeMetadataChanges},qf.prototype.Kl=function(t){t=$i.Ut(t.query,t.docs,t.Lt,t.fromCache),this.Ul=!0,this.Bl.next(t)},qf),Cf=(jf.prototype.Ph=function(t){this.zl=t},jf.prototype.es=function(e,r,i,o){var s=this;return r.on()||i.isEqual(Zr.min())?this.Hl(e,r):this.zl.Xn(e,o).next(function(t){var n=s.Yl(r,t);return(r.hn()||r.an())&&s.Gc(r.en,n,o,i)?s.Hl(e,r):(Sr()<=l.DEBUG&&xr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Nu(r)),s.zl.es(e,r,i).next(function(e){return n.forEach(function(t){e=e.nt(t.key,t)}),e}))})},jf.prototype.Yl=function(n,t){var r=new Vi(_u(n));return t.forEach(function(t,e){e instanceof ou&&Au(n,e)&&(r=r.add(e))}),r},jf.prototype.Gc=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.o(r))},jf.prototype.Hl=function(t,e){return Sr()<=l.DEBUG&&xr("IndexFreeQueryEngine","Using full collection scan to execute query:",Nu(e)),this.zl.es(t,e,Zr.min())},jf),Uf=(Ff.prototype.Ir=function(t){return oa.resolve(0===this.Kn.length)},Ff.prototype.mr=function(t,e,n,r){var i=this.Jl;this.Jl++,0<this.Kn.length&&this.Kn[this.Kn.length-1];var o=new ra(i,e,n,r);this.Kn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Xl=this.Xl.add(new Ac(a.key,i)),this.Gn.Ar(t,a.key.path.p())}return oa.resolve(o)},Ff.prototype.Rr=function(t,e){return oa.resolve(this.Zl(e))},Ff.prototype.Vr=function(t,e){var n=e+1,r=this.t_(n),i=r<0?0:r;return oa.resolve(this.Kn.length>i?this.Kn[i]:null)},Ff.prototype.gr=function(){return oa.resolve(0===this.Kn.length?-1:this.Jl-1)},Ff.prototype.yr=function(t){return oa.resolve(this.Kn.slice())},Ff.prototype.Hn=function(t,e){var n=this,r=new Ac(e,0),i=new Ac(e,Number.POSITIVE_INFINITY),o=[];return this.Xl.vt([r,i],function(t){var e=n.Zl(t.Jh);o.push(e)}),oa.resolve(o)},Ff.prototype.ts=function(t,e){var r=this,i=new Vi(Vr);return e.forEach(function(t){var e=new Ac(t,0),n=new Ac(t,Number.POSITIVE_INFINITY);r.Xl.vt([e,n],function(t){i=i.add(t.Jh)})}),oa.resolve(this.e_(i))},Ff.prototype.hs=function(t,e){var n=e.path,r=n.length+1,i=n;ii.W(i)||(i=i.child(""));var o=new Ac(new ii(i),0),s=new Vi(Vr);return this.Xl.St(function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.Jh)),!0)},o),oa.resolve(this.e_(s))},Ff.prototype.e_=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Zl(t);null!==e&&r.push(e)}),r},Ff.prototype.br=function(n,r){var i=this;Rr(0===this.n_(r.batchId,"removed")),this.Kn.shift();var o=this.Xl;return oa.forEach(r.mutations,function(t){var e=new Ac(t.key,r.batchId);return o=o.delete(e),i.dr.Dr(n,t.key)}).next(function(){i.Xl=o})},Ff.prototype.Sr=function(t){},Ff.prototype.Nr=function(t,e){var n=new Ac(e,0),r=this.Xl.Dt(n);return oa.resolve(e.isEqual(r&&r.key))},Ff.prototype.Cr=function(t){return this.Kn.length,oa.resolve()},Ff.prototype.n_=function(t,e){return this.t_(t)},Ff.prototype.t_=function(t){return 0===this.Kn.length?0:t-this.Kn[0].batchId},Ff.prototype.Zl=function(t){var e=this.t_(t);return e<0||e>=this.Kn.length?null:this.Kn[e]},Ff),Vf=(Mf.prototype.xn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.s_(e);return this.docs=this.docs.nt(r,{Mr:e,size:s,readTime:n}),this.size+=s-o,this.Gn.Ar(t,r.path.p())},Mf.prototype.Mn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Mf.prototype.On=function(t,e){var n=this.docs.get(e);return oa.resolve(n?n.Mr:null)},Mf.prototype.getEntries=function(t,e){var n=this,r=Fi;return e.forEach(function(t){var e=n.docs.get(t);r=r.nt(t,e?e.Mr:null)}),oa.resolve(r)},Mf.prototype.es=function(t,e,n){for(var r=Gi,i=new ii(e.path.child("")),o=this.docs.ut(i);o.wt();){var s=o.dt(),u=s.key,a=s.value,h=a.Mr,c=a.readTime;if(!e.path.D(u.path))break;c.o(n)<=0||h instanceof ou&&Au(e,h)&&(r=r.nt(h.key,h))}return oa.resolve(r)},Mf.prototype.i_=function(t,e){return oa.forEach(this.docs,function(t){return e(t)})},Mf.prototype.jr=function(t){return new Mf.Kr(this)},Mf.prototype.zr=function(t){return oa.resolve(this.size)},Mf);function Mf(t,e){this.Gn=t,this.s_=e,this.docs=new ki(ii.P),this.size=0}function Ff(t,e){this.Gn=t,this.dr=e,this.Kn=[],this.Jl=1,this.Xl=new Vi(Ac.Uh)}function jf(){}function qf(t,e,n){this.query=t,this.Bl=e,this.Ul=!1,this.Ql=null,this.onlineState="Unknown",this.options=n||{}}function Gf(t){this.Du=t,this.xl=new Qr(Tu,Iu),this.onlineState="Unknown",this.$l=new Set,this.Du.subscribe(this)}function Bf(t){var e=this;return(e=Pf.call(this)||this).Hr=t,e}Vf.Kr=(n(Bf,Pf=sa),Bf.prototype.Bn=function(n){var r=this,i=[];return this.Nn.forEach(function(t,e){e?i.push(r.Hr.xn(n,e,r.readTime)):r.Hr.Mn(t)}),oa.Dn(i)},Bf.prototype.Ln=function(t,e){return this.Hr.On(t,e)},Bf.prototype.qn=function(t,e){return this.Hr.getEntries(t,e)},Bf);var zf,Kf,Xf=(hl.prototype.pe=function(t,n){return this.r_.forEach(function(t,e){return n(e)}),oa.resolve()},hl.prototype.ro=function(t){return oa.resolve(this.lastRemoteSnapshotVersion)},hl.prototype.oo=function(t){return oa.resolve(this.o_)},hl.prototype.no=function(t){return this.highestTargetId=this.a_.next(),oa.resolve(this.highestTargetId)},hl.prototype.ho=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.o_&&(this.o_=e),oa.resolve()},hl.prototype.uo=function(t){this.r_.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.a_=new ec(e),this.highestTargetId=e),t.sequenceNumber>this.o_&&(this.o_=t.sequenceNumber)},hl.prototype.ao=function(t,e){return this.uo(e),this.targetCount+=1,oa.resolve()},hl.prototype.lo=function(t,e){return this.uo(e),oa.resolve()},hl.prototype._o=function(t,e){return this.r_.delete(e.target),this.h_.zh(e.targetId),--this.targetCount,oa.resolve()},hl.prototype.hr=function(n,r,i){var o=this,s=0,u=[];return this.r_.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.r_.delete(t),u.push(o.fo(n,e.targetId)),s++)}),oa.Dn(u).next(function(){return s})},hl.prototype.do=function(t){return oa.resolve(this.targetCount)},hl.prototype.wo=function(t,e){var n=this.r_.get(e)||null;return oa.resolve(n)},hl.prototype.To=function(t,e,n){return this.h_.jh(e,n),oa.resolve()},hl.prototype.Io=function(e,t,n){this.h_.Gh(t,n);var r=this.persistence.dr,i=[];return r&&t.forEach(function(t){i.push(r.Dr(e,t))}),oa.Dn(i)},hl.prototype.fo=function(t,e){return this.h_.zh(e),oa.resolve()},hl.prototype.Ao=function(t,e){var n=this.h_.Yh(e);return oa.resolve(n)},hl.prototype.Nr=function(t,e){return oa.resolve(this.h_.Nr(e))},hl),Hf=(al.prototype.start=function(){return Promise.resolve()},al.prototype.th=function(){return this.po=!1,Promise.resolve()},Object.defineProperty(al.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),al.prototype.Bo=function(){},al.prototype.Uo=function(){},al.prototype.uh=function(){return this.Gn},al.prototype.oh=function(t){var e=this.u_[t.Xh()];return e||(e=new Uf(this.Gn,this.dr),this.u_[t.Xh()]=e),e},al.prototype.hh=function(){return this.ko},al.prototype.ah=function(){return this.jn},al.prototype.runTransaction=function(t,e,n){var r=this;xr("MemoryPersistence","Starting transaction:",t);var i=new Wf(this.yo.next());return this.dr.l_(),n(i).next(function(t){return r.dr.__(i).next(function(){return t})}).vn().then(function(t){return i.Wn(),t})},al.prototype.f_=function(e,n){return oa.Cn(Object.values(this.u_).map(function(t){return function(){return t.Nr(e,n)}}))},al),Wf=(n(ul,Kf=aa),ul),Qf=(sl.T_=function(t){return new sl(t)},Object.defineProperty(sl.prototype,"E_",{get:function(){if(this.w_)return this.w_;throw Lr()},enumerable:!1,configurable:!0}),sl.prototype.Eo=function(t,e,n){return this.d_.Eo(n,e),this.E_.delete(n),oa.resolve()},sl.prototype.mo=function(t,e,n){return this.d_.mo(n,e),this.E_.add(n),oa.resolve()},sl.prototype.Dr=function(t,e){return this.E_.add(e),oa.resolve()},sl.prototype.removeTarget=function(t,e){var n=this;this.d_.zh(e.targetId).forEach(function(t){return n.E_.add(t)});var r=this.persistence.hh();return r.Ao(t,e.targetId).next(function(t){t.forEach(function(t){return n.E_.add(t)})}).next(function(){return r._o(t,e)})},sl.prototype.l_=function(){this.w_=new Set},sl.prototype.__=function(t){var n=this,r=this.persistence.ah().jr();return oa.forEach(this.E_,function(e){return n.I_(t,e).next(function(t){t||r.Mn(e)})}).next(function(){return n.w_=null,r.apply(t)})},sl.prototype.wh=function(t,e){var n=this;return this.I_(t,e).next(function(t){t?n.E_.delete(e):n.E_.add(e)})},sl.prototype.c_=function(t){return 0},sl.prototype.I_=function(t,e){var n=this;return oa.Cn([function(){return oa.resolve(n.d_.Nr(e))},function(){return n.persistence.hh().Nr(t,e)},function(){return n.persistence.f_(t,e)}])},sl),Yf=(ol.prototype.Na=function(t){this.R_=t},ol.prototype.ba=function(t){this.P_=t},ol.prototype.onMessage=function(t){this.V_=t},ol.prototype.close=function(){this.A_()},ol.prototype.send=function(t){this.m_(t)},ol.prototype.g_=function(){this.R_()},ol.prototype.y_=function(t){this.P_(t)},ol.prototype.p_=function(t){this.V_(t)},ol),Jf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},$f=(il.prototype.ja=function(e,t,n,r){var i=this.D_(e,t);xr("RestConnection","Sending: ",i,n);var o={};return this.C_(o,r),this.N_(e,i,o,n).then(function(t){return xr("RestConnection","Received: ",t),t},function(t){throw Or("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},il.prototype.Ka=function(t,e,n,r){return this.ja(t,e,n,r)},il.prototype.C_=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.18.0",t["Content-Type"]="text/plain",e)for(var n in e.ea)e.ea.hasOwnProperty(n)&&(t[n]=e.ea[n])},il.prototype.D_=function(t,e){var n=Jf[t];return this.v_+"/v1/"+e+":"+n},n(rl,zf=il),rl.prototype.N_=function(a,e,n,r){return new Promise(function(o,s){var u=new Nr;u.listenOnce(Ir.COMPLETE,function(){try{switch(u.getLastErrorCode()){case Er.NO_ERROR:var t=u.getResponseJson();xr("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Er.TIMEOUT:xr("Connection",'RPC "'+a+'" timed out'),s(new Jr(Yr.DEADLINE_EXCEEDED,"Request time out"));break;case Er.HTTP_ERROR:var e,n,r=u.getStatus();xr("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(Yr).indexOf(i)?i:Yr.UNKNOWN,s(new Jr(n,e.message))):s(new Jr(Yr.UNKNOWN,"Server responded with status "+u.getStatus())):s(new Jr(Yr.UNAVAILABLE,"Connection failed."));break;default:Lr()}}finally{xr("Connection",'RPC "'+a+'" completed.')}var i});var t=JSON.stringify(r);u.send(e,"POST",t,n,15)})},rl.prototype.Fa=function(t,e){var n,r,i=[this.v_,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=br(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.C_(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(r=p()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}xr("Connection","Creating WebChannel: "+u,s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new Yf({m_:function(t){f?xr("Connection","Not sending because WebChannel is closed:",t):(c||(xr("Connection","Opening WebChannel transport."),h.open(),c=!0),xr("Connection","WebChannel sending:",t),h.send(t))},A_:function(){return h.close()}});return a(Tr.EventType.OPEN,function(){f||xr("Connection","WebChannel transport opened.")}),a(Tr.EventType.CLOSE,function(){f||(f=!0,xr("Connection","WebChannel transport closed"),l.y_())}),a(Tr.EventType.ERROR,function(t){f||(f=!0,Or("Connection","WebChannel transport errored:",t),l.y_(new Jr(Yr.UNAVAILABLE,"The operation could not be completed")))}),a(Tr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Rr(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(xr("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=Ni[i];if(void 0!==t)return xi(t)}(),s=r.message,void 0===o&&(o=Yr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.y_(new Jr(o,s)),h.close()):(xr("Connection","WebChannel received:",n),l.p_(n)))}),setTimeout(function(){l.g_()},0),l},rl),Zf=(nl.prototype.uu=function(t){this.O_.push(t)},nl.prototype.th=function(){window.removeEventListener("online",this.F_),window.removeEventListener("offline",this.x_)},nl.prototype.L_=function(){window.addEventListener("online",this.F_),window.addEventListener("offline",this.x_)},nl.prototype.k_=function(){xr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.O_;t<e.length;t++)(0,e[t])(0)},nl.prototype.M_=function(){xr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.O_;t<e.length;t++)(0,e[t])(1)},nl.Fs=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},nl),tl=(el.prototype.uu=function(t){},el.prototype.th=function(){},el);function el(){}function nl(){var t=this;this.F_=function(){return t.k_()},this.x_=function(){return t.M_()},this.O_=[],this.L_()}function rl(t){var e=this;return(e=zf.call(this,t)||this).forceLongPolling=t.forceLongPolling,e}function il(t){this.b_=t,this.s=t.s;var e=t.ssl?"https":"http";this.v_=e+"://"+t.host,this.S_="projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents"}function ol(t){this.m_=t.m_,this.A_=t.A_}function sl(t){this.persistence=t,this.d_=new Nc,this.w_=null}function ul(t){var e=this;return(e=Kf.call(this)||this).Ro=t,e}function al(t){var e=this;this.u_={},this.yo=new fa(0),this.po=!1,this.po=!0,this.dr=t(this),this.ko=new Xf(this),this.Gn=new xh,this.jn=new Vf(this.Gn,function(t){return e.dr.c_(t)})}function hl(t){this.persistence=t,this.r_=new Qr(mi,wi),this.lastRemoteSnapshotVersion=Zr.min(),this.highestTargetId=0,this.o_=0,this.h_=new Nc,this.targetCount=0,this.a_=ec.to()}function cl(t){return new Lo(t,!0)}var fl,ll,pl="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",dl=(bl.prototype.initialize=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.sl=this.q_(e),this.persistence=this.B_(e),[4,this.persistence.start()];case 1:return t.sent(),this.U_=this.Q_(e),this.nu=this.W_(e),[2]}})})},bl.prototype.Q_=function(t){return null},bl.prototype.W_=function(t){return e=this.persistence,n=new Cf,r=t.j_,new bc(e,n,r);var e,n,r},bl.prototype.B_=function(t){if(t.G_.K_)throw new Jr(Yr.FAILED_PRECONDITION,pl);return new Hf(Qf.T_)},bl.prototype.q_=function(t){return new df},bl.prototype.terminate=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.U_&&this.U_.stop(),[4,this.sl.th()];case 1:return t.sent(),[4,this.persistence.th()];case 2:return t.sent(),[2]}})})},bl.prototype.clearPersistence=function(t,e){throw new Jr(Yr.FAILED_PRECONDITION,pl)},bl),yl=(n(wl,ll=dl),wl.prototype.initialize=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,ll.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(r){return g(this,void 0,void 0,function(){var e,n;return w(this,function(t){return n=(e=r).Ah,[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.Wr(t)}).then(function(t){e.mh=t})]})})}(this.nu)];case 2:return t.sent(),[2]}})})},wl.prototype.Q_=function(t){var e=this.persistence.dr.Yi;return new Ja(e,t.ti)},wl.prototype.B_=function(t){var e=wc(t.b_.s,t.b_.persistenceKey),n=cl(t.b_.s);return new fc(t.G_.synchronizeTabs,e,t.clientId,Wa.Ui(t.G_.cacheSizeBytes),t.ti,Ma(),Fa(),n,this.sl,t.G_.Vo)},wl.prototype.q_=function(t){return new df},wl.prototype.clearPersistence=function(t,e){return function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return Ta.Fs()?(e=n+"main",[4,Ta.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(wc(t,e))},n(ml,fl=wl),ml.prototype.initialize=function(r){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return[4,fl.prototype.initialize.call(this,r)];case 1:return t.sent(),[4,this.z_.initialize(this,r)];case 2:return t.sent(),e=this.z_.Du,this.sl instanceof pf?(this.sl.Du={Fc:_f.bind(null,e),kc:kf.bind(null,e),xc:function(f,l,p){return g(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a,h,c;return w(this,function(t){switch(t.label){case 0:if(!(n=f).wl)return[3,10];e=0,r=l,t.label=1;case 1:return e<r.length?(i=r[e],n.hl.has(i)?(xr("SyncEngine","Adding an already active target "+i),[3,5]):[4,Ic(n.nu,i)]):[3,6];case 2:return o=t.sent(),[4,n.nu.Mh(o)];case 3:return s=t.sent(),[4,n.Il(xf(o),s.targetId,!1)];case 4:t.sent(),n.nl.listen(s),t.label=5;case 5:return e++,[3,1];case 6:u=function(e){return w(this,function(t){switch(t.label){case 0:return n.hl.has(e)?[4,n.nu.Oh(e,!1).then(function(){n.nl.vu(e),n.Al(e)}).catch(Tc)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,u(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),rh:function(t){return t.nu.persistence.rh()}.bind(null,e)},[4,this.sl.start()]):[3,4];case 3:t.sent(),t.label=4;case 4:return[4,this.persistence.qo(function(e){return g(n,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,Df(this.z_.Du,e)];case 1:return t.sent(),this.U_&&(e&&!this.U_.tr?this.U_.start(this.nu):e||this.U_.stop()),[2]}})})})];case 5:return t.sent(),[2]}})})},ml.prototype.q_=function(t){if(t.G_.K_&&t.G_.synchronizeTabs){var e=Ma();if(!pf.Fs(e))throw new Jr(Yr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=wc(t.b_.s,t.b_.persistenceKey);return new pf(e,t.ti,n,t.clientId,t.j_)}return new df},ml),vl=(gl.prototype.initialize=function(n,r){return g(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:return this.nu?[3,3]:(this.nu=n.nu,this.sl=n.sl,this.su=this.H_(r),this.nl=this.Y_(r),this.Du=this.J_(r),this.X_=this.Z_(r),this.sl.Ga=function(t){return e.Du.Jc(t,1)},this.nl.Du=this.Du,[4,this.nl.start()]);case 1:return t.sent(),[4,this.nl.ju(this.Du.Tl)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},gl.prototype.Z_=function(t){return new Lf(this.Du)},gl.prototype.H_=function(t){var e,n,r=cl(t.b_.s),i=(e=t.b_,new $f(e));return n=t.credentials,new qc(n,i,r)},gl.prototype.Y_=function(t){var e=this;return new Bc(this.nu,this.su,t.ti,function(t){return e.Du.Jc(t,0)},new(Zf.Fs()?Zf:tl))},gl.prototype.J_=function(t){return e=this.nu,n=this.nl,r=this.su,i=this.sl,o=t.j_,s=t.il,u=!t.G_.K_||!t.G_.synchronizeTabs,a=new vf(e,n,r,i,o,s),u&&(a.wl=!0),a;var e,n,r,i,o,s,u,a},gl.prototype.terminate=function(){return this.nl.th()},gl);function gl(){}function ml(t){var e=this;return(e=fl.call(this)||this).z_=t,e}function wl(){return null!==ll&&ll.apply(this,arguments)||this}function bl(){}function El(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Il=(Tl.prototype.next=function(t){this.observer.next&&this.tf(this.observer.next,t)},Tl.prototype.error=function(t){this.observer.error?this.tf(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Tl.prototype.ef=function(){this.muted=!0},Tl.prototype.tf=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Tl);function Tl(t){this.observer=t,this.muted=!1}function Nl(t,e){if(0!==e.length)throw new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Gl(e.length,"argument")+".")}function Al(t,e,n){if(e.length!==n)throw new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires "+Gl(n,"argument")+", but was called with "+Gl(e.length,"argument")+".")}function _l(t,e,n){if(e.length<n)throw new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Gl(n,"argument")+", but was called with "+Gl(e.length,"argument")+".")}function Dl(t,e,n,r){if(e.length<n||e.length>r)throw new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Gl(e.length,"argument")+".")}function Sl(t,e,n,r){Rl(t,e,ql(n)+" argument",r)}function xl(t,e,n,r){void 0!==r&&Sl(t,e,n,r)}function kl(t,e,n,r){Rl(t,e,n+" option",r)}function Ol(t,e,n,r){void 0!==r&&kl(t,e,n,r)}function Pl(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Ul(s))}var u=Ul(n);throw new Jr(Yr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function Ll(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid value "+Ul(r)+" provided to function "+t+"() for its "+ql(n)+" argument. Acceptable values: "+e.join(", "));return r}function Rl(t,e,n,r){if(!("object"===e?Cl(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Ul(r);throw new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Cl(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ul(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Lr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Vl(t,e,n){if(void 0===n)throw new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ql(e)+" argument, but it was undefined.")}function Ml(n,t,r){zr(t,function(t,e){if(r.indexOf(t)<0)throw new Jr(Yr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Fl(t,e,n,r){var i=Ul(r);return new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires its "+ql(n)+" argument to be a "+e+", but it was: "+i)}function jl(t,e,n){if(n<=0)throw new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires its "+ql(e)+" argument to be a positive number, but it was: "+n+".")}function ql(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Gl(t,e){return t+" "+e+(1===t?"":"s")}function Bl(){if("undefined"==typeof Uint8Array)throw new Jr(Yr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function zl(){if("undefined"==typeof atob)throw new Jr(Yr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Kl,Xl,Hl=(ep.fromBase64String=function(t){Al("Blob.fromBase64String",arguments,1),Sl("Blob.fromBase64String","string",1,t),zl();try{return new ep(Ei.fromBase64String(t))}catch(t){throw new Jr(Yr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},ep.fromUint8Array=function(t){if(Al("Blob.fromUint8Array",arguments,1),Bl(),!(t instanceof Uint8Array))throw Fl("Blob.fromUint8Array","Uint8Array",1,t);return new ep(Ei.fromUint8Array(t))},ep.prototype.toBase64=function(){return Al("Blob.toBase64",arguments,0),zl(),this.nf.toBase64()},ep.prototype.toUint8Array=function(){return Al("Blob.toUint8Array",arguments,0),Bl(),this.nf.toUint8Array()},ep.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},ep.prototype.isEqual=function(t){return this.nf.isEqual(t.nf)},ep),Wl=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new Jr(Yr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(Sl("FieldPath","string",e,t[e]),0===t[e].length)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.sf=new ri(t)},Ql=(n(tp,Xl=Wl),tp.documentId=function(){return new tp(ri.L().F())},tp.prototype.isEqual=function(t){if(!(t instanceof tp))throw Fl("isEqual","FieldPath",1,t);return this.sf.isEqual(t.sf)},tp),Yl=new RegExp("[~\\*/\\[\\]]"),Jl=function(){this.if=this},$l=(n(Zl,Kl=Jl),Zl.prototype.hf=function(t){if(2!==t.af)throw 1===t.af?t.uf(this.rf+"() can only appear at the top level of your update data"):t.uf(this.rf+"() cannot be used with set() unless you pass {merge:true}");return t.Le.push(t.path),null},Zl.prototype.isEqual=function(t){return t instanceof Zl},Zl);function Zl(t){var e=this;return(e=Kl.call(this)||this).rf=t,e}function tp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Xl.call(this,t)||this}function ep(t){zl(),this.nf=t}function np(t,e,n){return new kp({af:3,cf:e.settings.cf,methodName:t.rf,lf:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var rp,ip,op,sp,up,ap,hp=(n(Sp,ap=Jl),Sp.prototype.hf=function(t){return new Ts(t.path,new as)},Sp.prototype.isEqual=function(t){return t instanceof Sp},Sp),cp=(n(Dp,up=Jl),Dp.prototype.hf=function(t){var e=np(this,t,!0),n=this._f.map(function(t){return Mp(t,e)}),r=new hs(n);return new Ts(t.path,r)},Dp.prototype.isEqual=function(t){return this===t},Dp),fp=(n(_p,sp=Jl),_p.prototype.hf=function(t){var e=np(this,t,!0),n=this._f.map(function(t){return Mp(t,e)}),r=new ds(n);return new Ts(t.path,r)},_p.prototype.isEqual=function(t){return this===t},_p),lp=(n(Ap,op=Jl),Ap.prototype.hf=function(t){var e=new ms(t.serializer,Uo(t.serializer,this.ff));return new Ts(t.path,e)},Ap.prototype.isEqual=function(t){return this===t},Ap),pp=(n(Np,ip=Jl),Np.delete=function(){return Nl("FieldValue.delete",arguments),new dp(new $l("FieldValue.delete"))},Np.serverTimestamp=function(){return Nl("FieldValue.serverTimestamp",arguments),new dp(new hp("FieldValue.serverTimestamp"))},Np.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return _l("FieldValue.arrayUnion",arguments,1),new dp(new cp("FieldValue.arrayUnion",t))},Np.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return _l("FieldValue.arrayRemove",arguments,1),new dp(new fp("FieldValue.arrayRemove",t))},Np.increment=function(t){return Sl("FieldValue.increment","number",1,t),Al("FieldValue.increment",arguments,1),new dp(new lp("FieldValue.increment",t))},Np),dp=(n(Tp,rp=pp),Tp.prototype.hf=function(t){return this.if.hf(t)},Tp.prototype.isEqual=function(t){return t instanceof Tp&&this.if.isEqual(t.if)},Tp),yp=(Object.defineProperty(Ip.prototype,"latitude",{get:function(){return this.df},enumerable:!1,configurable:!0}),Object.defineProperty(Ip.prototype,"longitude",{get:function(){return this.wf},enumerable:!1,configurable:!0}),Ip.prototype.isEqual=function(t){return this.df===t.df&&this.wf===t.wf},Ip.prototype.T=function(t){return Vr(this.df,t.df)||Vr(this.wf,t.wf)},Ip),vp=/^__.*__$/,gp=function(t,e,n){this.Tf=t,this.Ef=e,this.If=n},mp=(Ep.prototype.mf=function(t,e){var n=[];return null!==this.Le?n.push(new Vs(t,this.data,this.Le,e)):n.push(new Us(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Gs(t,this.fieldTransforms)),n},Ep),wp=(bp.prototype.mf=function(t,e){var n=[new Vs(t,this.data,this.Le,e)];return 0<this.fieldTransforms.length&&n.push(new Gs(t,this.fieldTransforms)),n},bp);function bp(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}function Ep(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}function Ip(t,e){if(Al("GeoPoint",arguments,2),Sl("GeoPoint","number",1,t),Sl("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Jr(Yr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Jr(Yr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.df=t,this.wf=e}function Tp(t){var e=this;return(e=rp.call(this)||this).if=t,e.rf=t.rf,e}function Np(){return ip.call(this)||this}function Ap(t,e){var n=this;return(n=op.call(this)||this).rf=t,n.ff=e,n}function _p(t,e){var n=this;return(n=sp.call(this)||this).rf=t,n._f=e,n}function Dp(t,e){var n=this;return(n=up.call(this)||this).rf=t,n._f=e,n}function Sp(t){var e=this;return(e=ap.call(this)||this).rf=t,e}function xp(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Lr()}}var kp=(Object.defineProperty(Lp.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Lp.prototype,"af",{get:function(){return this.settings.af},enumerable:!1,configurable:!0}),Lp.prototype.Rf=function(t){return new Lp(Object.assign(Object.assign({},this.settings),t),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Le)},Lp.prototype.Pf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Rf({path:n,lf:!1});return r.Vf(t),r},Lp.prototype.gf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Rf({path:n,lf:!1});return r.Af(),r},Lp.prototype.yf=function(t){return this.Rf({path:void 0,lf:!0})},Lp.prototype.uf=function(t){return zp(t,this.settings.methodName,this.settings.pf||!1,this.path,this.settings.cf)},Lp.prototype.contains=function(e){return void 0!==this.Le.find(function(t){return e.D(t)})||void 0!==this.fieldTransforms.find(function(t){return e.D(t.field)})},Lp.prototype.Af=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Vf(this.path.get(t))},Lp.prototype.Vf=function(t){if(0===t.length)throw this.uf("Document fields must not be empty");if(xp(this.af)&&vp.test(t))throw this.uf('Document fields cannot begin and end with "__"')},Lp),Op=(Pp.prototype.bf=function(t,e,n,r){return void 0===r&&(r=!1),new kp({af:t,methodName:e,cf:n,path:ri.$(),lf:!1,pf:r},this.s,this.serializer,this.ignoreUndefinedProperties)},Pp);function Pp(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||cl(t)}function Lp(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Af(),this.fieldTransforms=i||[],this.Le=o||[]}function Rp(t,e,n,r,i,o){void 0===o&&(o={});var s=t.bf(o.merge||o.mergeFields?2:0,e,n,i);qp("Data must be an object, but it was:",s,r);var u,a,h=Fp(r,s);if(o.merge)u=new Is(s.Le),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Wl)d=p.sf;else{if("string"!=typeof p)throw Lr();d=Bp(e,p,n)}if(!s.contains(d))throw new Jr(Yr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Kp(c,d)||c.push(d)}u=new Is(c),a=s.fieldTransforms.filter(function(t){return u.je(t.field)})}else u=null,a=s.fieldTransforms;return new mp(new Qs(h),u,a)}function Cp(t,o,s,e){var u=t.bf(1,o,s);qp("Data must be an object, but it was:",u,e);var a=[],h=new Ys;zr(e,function(t,e){var n,r=Bp(o,t,s),i=u.gf(r);e instanceof Jl&&e.if instanceof $l?a.push(r):null!=(n=Mp(e,i))&&(a.push(r),h.set(r,n))});var n=new Is(a);return new wp(h.Ge(),n,u.fieldTransforms)}function Up(t,e,n,r,i,o){var s=t.bf(1,e,n),u=[Gp(e,r,n)],a=[i];if(o.length%2!=0)throw new Jr(Yr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<o.length;h+=2)u.push(Gp(e,o[h])),a.push(o[h+1]);for(var c,f,l,p,d=[],y=new Ys,v=u.length-1;0<=v;--v){Kp(d,u[v])||(c=u[v],f=a[v],l=s.gf(c),f instanceof Jl&&f.if instanceof $l?d.push(c):null!=(p=Mp(f,l))&&(d.push(c),y.set(c,p)))}var g=new Is(d);return new wp(y.Ge(),g,s.fieldTransforms)}function Vp(t,e,n,r){return void 0===r&&(r=!1),Mp(n,t.bf(r?4:3,e))}function Mp(s,t){if(jp(s))return qp("Unsupported field value:",t,s),Fp(s,t);if(s instanceof Jl)return function(t,e){if(!xp(e.af))throw e.uf(t.rf+"() can only be used with update() and set()");if(!e.path)throw e.uf(t.rf+"() is not currently supported inside arrays");var n=t.hf(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Le.push(t.path),s instanceof Array){if(t.settings.lf&&4!==t.af)throw t.uf("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Mp(i[r],t.yf(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Uo(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=$r.fromDate(t);return{timestampValue:Vo(e.serializer,n)}}if(t instanceof $r){var r=new $r(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Vo(e.serializer,r)}}if(t instanceof yp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Hl)return{bytesValue:Mo(e.serializer,t)};if(t instanceof gp){var i=e.s,o=t.Tf;if(!o.isEqual(i))throw e.uf("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:jo(t.Tf||e.s,t.Ef.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.uf("Unsupported field value: "+Ul(t))}(s,t)}function Fp(t,r){var i={};return Kr(t)?r.path&&0<r.path.length&&r.Le.push(r.path):zr(t,function(t,e){var n=Mp(e,r.Pf(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function jp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $r||t instanceof yp||t instanceof Hl||t instanceof gp||t instanceof Jl)}function qp(t,e,n){if(!jp(n)||!Cl(n)){var r=Ul(n);throw"an object"===r?e.uf(t+" a custom object"):e.uf(t+" "+r)}}function Gp(t,e,n){if(e instanceof Wl)return e.sf;if("string"==typeof e)return Bp(t,e);throw zp("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Bp(t,e,n){try{return function(e){if(0<=e.search(Yl))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Ql.bind.apply(Ql,i([void 0],e.split("."))))}catch(t){throw new Jr(Yr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).sf}catch(e){throw zp(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function zp(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new Jr(Yr.INVALID_ARGUMENT,(u+=". ")+t+a)}function Kp(t,e){return t.some(function(t){return t.isEqual(e)})}var Xp=(Jp.prototype.Nf=function(r){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(this.Ff(),0<this.mutations.length)throw new Jr(Yr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(u,a){return g(this,void 0,void 0,function(){var i,e,n,r,o,s;return w(this,function(t){switch(t.label){case 0:return e=Xo((i=u).serializer)+"/documents",n={documents:a.map(function(t){return Go(i.serializer,t)})},[4,i.Ka("BatchGetDocuments",e,n)];case 1:return r=t.sent(),o=new Map,r.forEach(function(t){var e,n,r=(e=i.serializer,"found"in(n=t)?function(t,e){Rr(!!e.found),e.found.name,e.found.updateTime;var n=Bo(t,e.found.name),r=Fo(e.found.updateTime),i=new Qs({mapValue:{fields:e.found.fields}});return new ou(n,r,i,{})}(e,n):"missing"in n?function(t,e){Rr(!!e.missing),Rr(!!e.readTime);var n=Bo(t,e.missing),r=Fo(e.readTime);return new su(n,r)}(e,n):Lr());o.set(r.key.toString(),r)}),s=[],[2,(a.forEach(function(t){var e=o.get(t.toString());Rr(!!e),s.push(e)}),s)]}})})}(this.su,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof su||t instanceof ou?n.kf(t):Lr()}),e)]}})})},Jp.prototype.set=function(t,e){this.write(e.mf(t,this.Ue(t))),this.Cf.add(t)},Jp.prototype.update=function(t,e){try{this.write(e.mf(t,this.xf(t)))}catch(t){this.Df=t}this.Cf.add(t)},Jp.prototype.delete=function(t){this.write([new Hs(t,this.Ue(t))]),this.Cf.add(t)},Jp.prototype.commit=function(){return g(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:if(this.Ff(),this.Df)throw this.Df;return e=this.vf,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=new ii(ei.k(e));r.mutations.push(new Ws(n,r.Ue(n)))}),[4,function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return n=Xo((e=i).serializer)+"/documents",r={writes:o.map(function(t){return Qo(e.serializer,t)})},[4,e.ja("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.su,this.mutations)];case 1:return t.sent(),this.Sf=!0,[2]}})})},Jp.prototype.kf=function(t){var e;if(t instanceof ou)e=t.version;else{if(!(t instanceof su))throw Lr();e=Zr.min()}var n=this.vf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Jr(Yr.ABORTED,"Document version changed between two reads.")}else this.vf.set(t.key.toString(),e)},Jp.prototype.Ue=function(t){var e=this.vf.get(t.toString());return!this.Cf.has(t)&&e?_s.updateTime(e):_s.Qe()},Jp.prototype.xf=function(t){var e=this.vf.get(t.toString());if(this.Cf.has(t)||!e)return _s.exists(!0);if(e.isEqual(Zr.min()))throw new Jr(Yr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return _s.updateTime(e)},Jp.prototype.write=function(t){this.Ff(),this.mutations=this.mutations.concat(t)},Jp.prototype.Ff=function(){},Jp),Hp=(Yp.prototype.run=function(){this.Mf()},Yp.prototype.Mf=function(){var t=this;this.wi.ps(function(){return g(t,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){return e=new Xp(this.su),(n=this.Of(e))&&n.then(function(t){r.ti.hi(function(){return e.commit().then(function(){r.si.resolve(t)}).catch(function(t){r.Lf(t)})})}).catch(function(t){r.Lf(t)}),[2]})})})},Yp.prototype.Of=function(t){try{var e=this.updateFunction(t);return!pi(e)&&e.catch&&e.then?e:(this.si.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.si.reject(t),null}},Yp.prototype.Lf=function(t){var e=this;0<this.$f&&this.qf(t)?(--this.$f,this.ti.hi(function(){return e.Mf(),Promise.resolve()})):this.si.reject(t)},Yp.prototype.qf=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Si(e)},Yp),Wp=(Qp.prototype.start=function(t,e,n,r){var i=this;this.Uf(),this.b_=t;var o=new ba,s=!1;return this.credentials.ia(function(t){return s?void i.ti.Vi(function(){return i.nl.Wu(t)}):(s=!0,xr("FirestoreClient","Initializing. user=",t.uid),i.Qf(e,n,r,t,o).then(i.Bf.resolve,i.Bf.reject))}),this.ti.hi(function(){return i.Bf.promise}),o.promise},Qp.prototype.enableNetwork=function(){var t=this;return this.Uf(),this.ti.enqueue(function(){return t.persistence.Uo(!0),t.nl.enableNetwork()})},Qp.prototype.Qf=function(i,o,s,u,a){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e={ti:this.ti,b_:this.b_,clientId:this.clientId,credentials:this.credentials,j_:u,il:100,G_:s},[4,i.initialize(e)];case 1:return t.sent(),[4,o.initialize(i,e)];case 2:return t.sent(),this.persistence=i.persistence,this.sl=i.sl,this.nu=i.nu,this.U_=i.U_,this.su=o.su,this.nl=o.nl,this.Du=o.Du,this.Wf=o.X_,this.persistence.Bo(function(){return g(r,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),a.resolve(),[3,4];case 3:if(n=t.sent(),a.reject(n),!this.jf(n))throw n;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),this.Qf(new dl,new vl,{K_:!1},u,a))];case 4:return[2]}})})},Qp.prototype.jf=function(t){return"FirebaseError"===t.name?t.code===Yr.FAILED_PRECONDITION||t.code===Yr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Qp.prototype.Uf=function(){if(this.ti.Ei)throw new Jr(Yr.FAILED_PRECONDITION,"The client has already been terminated.")},Qp.prototype.disableNetwork=function(){var t=this;return this.Uf(),this.ti.enqueue(function(){return t.persistence.Uo(!1),t.nl.disableNetwork()})},Qp.prototype.terminate=function(){var t=this;return this.ti.Pi(function(){return g(t,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.U_&&this.U_.stop(),[4,this.nl.th()];case 1:return t.sent(),[4,this.sl.th()];case 2:return t.sent(),[4,this.persistence.th()];case 3:return t.sent(),this.credentials.ra(),[2]}})})})},Qp.prototype.waitForPendingWrites=function(){var t=this;this.Uf();var e=new ba;return this.ti.hi(function(){return t.Du.bl(e)}),e.promise},Qp.prototype.listen=function(t,e,n){var r=this;this.Uf();var i=new Il(n),o=new Rf(t,i,e);return this.ti.hi(function(){return r.Wf.listen(o)}),function(){i.ef(),r.ti.hi(function(){return r.Wf.vu(o)})}},Qp.prototype.Kf=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Uf(),[4,this.Bf.promise];case 1:return[2,(t.sent(),function(n,o,s){return g(this,void 0,void 0,function(){var i,e=this;return w(this,function(t){switch(t.label){case 0:return i=new ba,[4,n.enqueue(function(){return g(e,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,o.$h(s)];case 1:return(e=t.sent())instanceof ou?i.resolve(e):e instanceof su?i.resolve(null):i.reject(new Jr(Yr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return n=t.sent(),r=za(n,"Failed to get document '"+s+" from cache"),i.reject(r),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),i.promise)]}})})}(this.ti,this.nu,e))]}})})},Qp.prototype.Gf=function(u,a){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Uf(),[4,this.Bf.promise];case 1:return[2,(t.sent(),e=this.ti,n=this.Wf,r=u,i=a,o=new ba,s=$p(e,n,yu(r.path),{includeMetadataChanges:!0,Gl:!0},{next:function(t){s();var e=t.docs.has(r);!e&&t.fromCache?o.reject(new Jr(Yr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&i&&"server"===i.source?o.reject(new Jr(Yr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(t)},error:function(t){return o.reject(t)}}),o.promise)]}var e,n,r,i,o,s})})},Qp.prototype.zf=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Uf(),[4,this.Bf.promise];case 1:return[2,(t.sent(),function(n,a,h){return g(this,void 0,void 0,function(){var u,e=this;return w(this,function(t){switch(t.label){case 0:return u=new ba,[4,n.enqueue(function(){return g(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,a.Lh(h,!0)];case 1:return e=t.sent(),n=new yf(h,e.qh),r=n.Wc(e.documents),i=n.Bn(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=za(o,"Failed to execute query '"+h+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})}(this.ti,this.nu,e))]}})})},Qp.prototype.Hf=function(u,a){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Uf(),[4,this.Bf.promise];case 1:return[2,(t.sent(),e=this.ti,n=this.Wf,r=u,i=a,o=new ba,s=$p(e,n,r,{includeMetadataChanges:!0,Gl:!0},{next:function(t){s(),t.fromCache&&i&&"server"===i.source?o.reject(new Jr(Yr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(t)},error:function(t){return o.reject(t)}}),o.promise)]}var e,n,r,i,o,s})})},Qp.prototype.write=function(t){var e=this;this.Uf();var n=new ba;return this.ti.hi(function(){return e.Du.write(t,n)}),n.promise},Qp.prototype.s=function(){return this.b_.s},Qp.prototype.Ll=function(t){var e=this;this.Uf();var n=new Il(t);return this.ti.hi(function(){return g(e,void 0,void 0,function(){return w(this,function(t){return[2,this.Wf.Ll(n)]})})}),function(){n.ef(),e.ti.hi(function(){return g(e,void 0,void 0,function(){return w(this,function(t){return[2,this.Wf.ql(n)]})})})}},Object.defineProperty(Qp.prototype,"Yf",{get:function(){return this.ti.Ei},enumerable:!1,configurable:!0}),Qp.prototype.transaction=function(t){var e=this;this.Uf();var n=new ba;return this.ti.hi(function(){return new Hp(e.ti,e.su,t,n).run(),Promise.resolve()}),n.promise},Qp);function Qp(t,e){this.credentials=t,this.ti=e,this.clientId=Cr.t(),this.Bf=new ba}function Yp(t,e,n,r){this.ti=t,this.su=e,this.updateFunction=n,this.si=r,this.$f=5,this.wi=new Ia(this.ti,"transaction_retry")}function Jp(t){this.su=t,this.vf=new Map,this.mutations=[],this.Sf=!1,this.Df=null,this.Cf=new Set}function $p(t,e,n,r,i){var o=new Il(i),s=new Rf(n,o,r);return t.hi(function(){return e.listen(s)}),function(){o.ef(),t.hi(function(){return e.vu(s)})}}var Zp,td,ed=(wd.prototype.Zf=function(t){switch(vo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return To(t.integerValue||t.doubleValue);case 3:return this.td(t.timestampValue);case 4:return this.ed(t);case 5:return t.stringValue;case 6:return new Hl(No(t.bytesValue));case 7:return this.nd(t.referenceValue);case 8:return this.sd(t.geoPointValue);case 9:return this.rd(t.arrayValue);case 10:return this.od(t.mapValue);default:throw Lr()}},wd.prototype.od=function(t){var n=this,r={};return zr(t.fields||{},function(t,e){r[t]=n.Zf(e)}),r},wd.prototype.sd=function(t){return new yp(To(t.latitude),To(t.longitude))},wd.prototype.rd=function(t){var e=this;return(t.values||[]).map(function(t){return e.Zf(t)})},wd.prototype.ed=function(t){switch(this.Jf){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return lo(n)?t(n):n}(t);return null==e?null:this.Zf(e);case"estimate":return this.td(po(t));default:return null}},wd.prototype.td=function(t){var e=Io(t),n=new $r(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},wd.prototype.nd=function(t){var e=ei.k(t);Rr(rs(e));var n=new qr(e.get(1),e.get(3)),r=new ii(e.g(5));return n.isEqual(this.s)||kr("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.Xf(r)},wd),nd=Wa.ji,rd=(md.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},md),id=(Object.defineProperty(gd.prototype,"Id",{get:function(){return this.md||(this.md=new Op(this.Tf,this.Ed.ignoreUndefinedProperties)),this.md},enumerable:!1,configurable:!0}),gd.prototype.settings=function(t){Al("Firestore.settings",arguments,1),Sl("Firestore.settings","object",1,t);var e=new rd(t);if(this.fd&&!this.Ed.isEqual(e))throw new Jr(Yr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Ed=e).credentials&&(this.Td=function(t){if(!t)return new Rc;switch(t.type){case"gapi":var e=t.Ad;return Rr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Vc(e,t.la||"0");case"provider":return t.Ad;default:throw new Jr(Yr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},gd.prototype.enableNetwork=function(){return this._d(),this.fd.enableNetwork()},gd.prototype.disableNetwork=function(){return this._d(),this.fd.disableNetwork()},gd.prototype.enablePersistence=function(t){var e,n;if(this.fd)throw new Jr(Yr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&kr("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new Jr(Yr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Rd(this.hd,this.ad,{K_:!0,cacheSizeBytes:this.Ed.cacheSizeBytes,synchronizeTabs:r,Vo:i})},gd.prototype.clearPersistence=function(){return g(this,void 0,void 0,function(){var n,e=this;return w(this,function(t){if(void 0!==this.fd&&!this.fd.Yf)throw new Jr(Yr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return n=new ba,[2,(this.ld.Ii(function(){return g(e,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.hd.clearPersistence(this.Tf,this.wd)];case 1:return t.sent(),n.resolve(),[3,3];case 2:return e=t.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise)]})})},gd.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(gd.prototype,"Pd",{get:function(){return this._d(),this.fd.Yf},enumerable:!1,configurable:!0}),gd.prototype.waitForPendingWrites=function(){return this._d(),this.fd.waitForPendingWrites()},gd.prototype.onSnapshotsInSync=function(t){if(this._d(),El(t))return this.fd.Ll(t);Sl("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.fd.Ll(e)},gd.prototype._d=function(){return this.fd||this.Rd(new dl,new vl,{K_:!1}),this.fd},gd.prototype.Vd=function(){return new jr(this.Tf,this.wd,this.Ed.host,this.Ed.ssl,this.Ed.forceLongPolling)},gd.prototype.Rd=function(t,e,n){var r=this.Vd();return this.fd=new Wp(this.Td,this.ld),this.fd.start(r,t,e,n)},gd.dd=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Jr(Yr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Jr(Yr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new qr(n)},Object.defineProperty(gd.prototype,"app",{get:function(){if(!this.ud)throw new Jr(Yr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.ud},enumerable:!1,configurable:!0}),gd.prototype.collection=function(t){return Al("Firestore.collection",arguments,1),Sl("Firestore.collection","non-empty string",1,t),this._d(),new Dd(ei.k(t),this,null)},gd.prototype.doc=function(t){return Al("Firestore.doc",arguments,1),Sl("Firestore.doc","non-empty string",1,t),this._d(),ud.gd(ei.k(t),this,null)},gd.prototype.collectionGroup=function(t){if(Al("Firestore.collectionGroup",arguments,1),Sl("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this._d(),new Ad((e=t,new lu(ei.$(),e)),this,null);var e},gd.prototype.runTransaction=function(e){var n=this;return Al("Firestore.runTransaction",arguments,1),Sl("Firestore.runTransaction","function",1,e),this._d().transaction(function(t){return e(new od(n,t))})},gd.prototype.batch=function(){return this._d(),new sd(this)},Object.defineProperty(gd,"logLevel",{get:function(){switch(Sr()){case l.DEBUG:return"debug";case l.ERROR:return"error";case l.SILENT:return"silent";case l.WARN:return"warn";case l.INFO:return"info";case l.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),gd.setLogLevel=function(t){Al("Firestore.setLogLevel",arguments,1),Ll("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Dr.setLogLevel(t)},gd.prototype.yd=function(){return this.Ed.timestampsInSnapshots},gd),od=(vd.prototype.get=function(t){var n=this;Al("Transaction.get",arguments,1);var r=Rd("Transaction.get",t,this.pd);return this.bd.Nf([r.Ef]).then(function(t){if(!t||1!==t.length)return Lr();var e=t[0];if(e instanceof su)return new hd(n.pd,r.Ef,null,!1,!1,r.If);if(e instanceof ou)return new hd(n.pd,r.Ef,e,!1,!1,r.If);throw Lr()})},vd.prototype.set=function(t,e,n){Dl("Transaction.set",arguments,2,3);var r=Rd("Transaction.set",t,this.pd);n=Od("Transaction.set",n);var i=Cd(r.If,e,n),o=Rp(this.pd.Id,"Transaction.set",r.Ef,i,null!==r.If,n);return this.bd.set(r.Ef,o),this},vd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Ql?(_l("Transaction.update",arguments,3),r=Rd("Transaction.update",t,this.pd),Up(this.pd.Id,"Transaction.update",r.Ef,e,n,o)):(Al("Transaction.update",arguments,2),r=Rd("Transaction.update",t,this.pd),Cp(this.pd.Id,"Transaction.update",r.Ef,e)),this.bd.update(r.Ef,i),this},vd.prototype.delete=function(t){Al("Transaction.delete",arguments,1);var e=Rd("Transaction.delete",t,this.pd);return this.bd.delete(e.Ef),this},vd),sd=(yd.prototype.set=function(t,e,n){Dl("WriteBatch.set",arguments,2,3),this.Dd();var r=Rd("WriteBatch.set",t,this.pd);n=Od("WriteBatch.set",n);var i=Cd(r.If,e,n),o=Rp(this.pd.Id,"WriteBatch.set",r.Ef,i,null!==r.If,n);return this.vd=this.vd.concat(o.mf(r.Ef,_s.Qe())),this},yd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Dd(),i="string"==typeof e||e instanceof Ql?(_l("WriteBatch.update",arguments,3),r=Rd("WriteBatch.update",t,this.pd),Up(this.pd.Id,"WriteBatch.update",r.Ef,e,n,o)):(Al("WriteBatch.update",arguments,2),r=Rd("WriteBatch.update",t,this.pd),Cp(this.pd.Id,"WriteBatch.update",r.Ef,e)),this.vd=this.vd.concat(i.mf(r.Ef,_s.exists(!0))),this},yd.prototype.delete=function(t){Al("WriteBatch.delete",arguments,1),this.Dd();var e=Rd("WriteBatch.delete",t,this.pd);return this.vd=this.vd.concat(new Hs(e.Ef,_s.Qe())),this},yd.prototype.commit=function(){return this.Dd(),this.Sd=!0,0<this.vd.length?this.pd._d().write(this.vd):Promise.resolve()},yd.prototype.Dd=function(){if(this.Sd)throw new Jr(Yr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},yd),ud=(n(dd,td=gp),dd.gd=function(t,e,n){if(t.length%2!=0)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.F()+" has "+t.length);return new dd(new ii(t),e,n)},Object.defineProperty(dd.prototype,"id",{get:function(){return this.Ef.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(dd.prototype,"parent",{get:function(){return new Dd(this.Ef.path.p(),this.firestore,this.If)},enumerable:!1,configurable:!0}),Object.defineProperty(dd.prototype,"path",{get:function(){return this.Ef.path.F()},enumerable:!1,configurable:!0}),dd.prototype.collection=function(t){if(Al("DocumentReference.collection",arguments,1),Sl("DocumentReference.collection","non-empty string",1,t),!t)throw new Jr(Yr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=ei.k(t);return new Dd(this.Ef.path.child(e),this.firestore,null)},dd.prototype.isEqual=function(t){if(!(t instanceof dd))throw Fl("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.Ef.isEqual(t.Ef)&&this.If===t.If},dd.prototype.set=function(t,e){Dl("DocumentReference.set",arguments,1,2),e=Od("DocumentReference.set",e);var n=Cd(this.If,t,e),r=Rp(this.firestore.Id,"DocumentReference.set",this.Ef,n,null!==this.If,e);return this.fd.write(r.mf(this.Ef,_s.Qe()))},dd.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Ql?(_l("DocumentReference.update",arguments,2),Up(this.firestore.Id,"DocumentReference.update",this.Ef,t,e,r)):(Al("DocumentReference.update",arguments,1),Cp(this.firestore.Id,"DocumentReference.update",this.Ef,t)),this.fd.write(n.mf(this.Ef,_s.exists(!0)))},dd.prototype.delete=function(){return Al("DocumentReference.delete",arguments,0),this.fd.write([new Hs(this.Ef,_s.Qe())])},dd.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Dl("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||El(i[u])||(Ml("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),Ol("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a,h={includeMetadataChanges:s.includeMetadataChanges};El(i[u])?(a=i[u],i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)):(Sl("DocumentReference.onSnapshot","function",u,i[u]),xl("DocumentReference.onSnapshot","function",u+1,i[u+1]),xl("DocumentReference.onSnapshot","function",u+2,i[u+2]));var c={next:function(t){i[u]&&i[u](r.Cd(t))},error:i[u+1],complete:i[u+2]};return this.fd.listen(yu(this.Ef.path),h,c)},dd.prototype.get=function(t){var e=this;Dl("DocumentReference.get",arguments,0,1),Ld("DocumentReference.get",t);var n=this.firestore._d();return t&&"cache"===t.source?n.Kf(this.Ef).then(function(t){return new hd(e.firestore,e.Ef,t,!0,t instanceof ou&&t.Ke,e.If)}):n.Gf(this.Ef,t).then(function(t){return e.Cd(t)})},dd.prototype.withConverter=function(t){return new dd(this.Ef,this.firestore,t)},dd.prototype.Cd=function(t){var e=t.docs.get(this.Ef);return new hd(this.firestore,this.Ef,e,t.fromCache,t.hasPendingWrites,this.If)},dd),ad=(pd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},pd),hd=(ld.prototype.data=function(t){var e=this;if(Dl("DocumentSnapshot.data",arguments,0,1),t=Pd("DocumentSnapshot.data",t),this.Nd){if(this.If){var n=new cd(this.pd,this.Ef,this.Nd,this.Fd,this.kd,null);return this.If.fromFirestore(n,t)}return new ed(this.pd.Tf,this.pd.yd(),t.serverTimestamps||"none",function(t){return new ud(t,e.pd,null)}).Zf(this.Nd.Ze())}},ld.prototype.get=function(t,e){var n=this;if(Dl("DocumentSnapshot.get",arguments,1,2),e=Pd("DocumentSnapshot.get",e),this.Nd){var r=this.Nd.data().field(Gp("DocumentSnapshot.get",t,this.Ef));if(null!==r)return new ed(this.pd.Tf,this.pd.yd(),e.serverTimestamps||"none",function(t){return new ud(t,n.pd,n.If)}).Zf(r)}},Object.defineProperty(ld.prototype,"id",{get:function(){return this.Ef.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"ref",{get:function(){return new ud(this.Ef,this.pd,this.If)},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"exists",{get:function(){return null!==this.Nd},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"metadata",{get:function(){return new ad(this.kd,this.Fd)},enumerable:!1,configurable:!0}),ld.prototype.isEqual=function(t){if(!(t instanceof ld))throw Fl("isEqual","DocumentSnapshot",1,t);return this.pd===t.pd&&this.Fd===t.Fd&&this.Ef.isEqual(t.Ef)&&(null===this.Nd?null===t.Nd:this.Nd.isEqual(t.Nd))&&this.If===t.If},ld),cd=(n(fd,Zp=hd),fd.prototype.data=function(t){return Zp.prototype.data.call(this,t)},fd);function fd(){return null!==Zp&&Zp.apply(this,arguments)||this}function ld(t,e,n,r,i,o){this.pd=t,this.Ef=e,this.Nd=n,this.Fd=r,this.kd=i,this.If=o}function pd(t,e){this.hasPendingWrites=t,this.fromCache=e}function dd(t,e,n){var r=this;return(r=td.call(this,e.Tf,t,n)||this).Ef=t,r.firestore=e,r.If=n,r.fd=r.firestore._d(),r}function yd(t){this.pd=t,this.vd=[],this.Sd=!1}function vd(t,e){this.pd=t,this.bd=e}function gd(t,e,n,r){var i=this;if(void 0===n&&(n=new dl),void 0===r&&(r=new vl),this.hd=n,this.ad=r,this.ud=null,this.ld=new qa,this.INTERNAL={delete:function(){return g(i,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this._d(),[4,this.fd.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var o=t;this.ud=o,this.Tf=gd.dd(o),this.wd=o.name,this.Td=new Cc(e)}else{var s=t;if(!s.projectId)throw new Jr(Yr.INVALID_ARGUMENT,"Must provide projectId");this.Tf=new qr(s.projectId,s.database),this.wd="[DEFAULT]",this.Td=new Rc}this.Ed=new rd({})}function md(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Jr(Yr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else kl("settings","non-empty string","host",t.host),this.host=t.host,Ol("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Ml("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),Ol("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ol("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),Ol("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?kr("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&kr("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,Ol("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Wa.Gi;else{if(t.cacheSizeBytes!==nd&&t.cacheSizeBytes<Wa.Ki)throw new Jr(Yr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Wa.Ki);this.cacheSizeBytes=t.cacheSizeBytes}Ol("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function wd(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.Jf=n,this.Xf=r}function bd(t,e,n){if("string"==typeof n){if(""===n)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!vu(e)&&-1!==n.indexOf("/"))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(ei.k(n));if(!ii.W(r))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ao(t,new ii(r))}if(n instanceof gp)return Ao(t,n.Ef);throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ul(n)+".")}function Ed(t,e){if(!Array.isArray(t)||0===t.length)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(0<=t.indexOf(null))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function Id(t,e,n){if(!n.isEqual(e))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Td(t){if(t.an()&&0===t.tn.length)throw new Jr(Yr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Nd,Ad=(kd.prototype.where=function(t,e,n){var r;Al("Query.where",arguments,3),Vl("Query.where",3,n),r="not-in"===e||"!="===e?e:Ll("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i,o,s=Gp("Query.where",t),u=function(t,e,n,r,i,o,s){var u;if(i.O()){if("array-contains"===o||"array-contains-any"===o)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Ed(s,o);for(var a=[],h=0,c=s;h<c.length;h++){var f=c[h];a.push(bd(r,t,f))}u={arrayValue:{values:a}}}else u=bd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Ed(s,o),u=Vp(n,e,s,"in"===o||"not-in"===o);var l=Su.create(i,o,u);return function(t,e){if(e.ln()){var n=t.cn();if(null!==n&&!n.isEqual(e.field))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=t.un();null!==r&&Id(0,e.field,r)}var i=t._n(function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new Jr(Yr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Jr(Yr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(this.xd,"Query.where",this.firestore.Id,this.firestore.Tf,s,r,n);return new kd((i=this.xd,o=i.filters.concat([u]),new lu(i.path,i.collectionGroup,i.tn.slice(),o,i.limit,i.en,i.startAt,i.endAt)),this.firestore,this.If)},kd.prototype.orderBy=function(t,e){var n;if(Dl("Query.orderBy",arguments,1,2),xl("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Jr(Yr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r,i,o=Gp("Query.orderBy",t),s=function(t,e,n){if(null!==t.startAt)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i,o,s=new na(e,n);return i=s,null!==(r=t).un()||null!==(o=r.cn())&&Id(0,o,i.field),s}(this.xd,o,n);return new kd((r=this.xd,i=r.tn.concat([s]),new lu(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.en,r.startAt,r.endAt)),this.firestore,this.If)},kd.prototype.limit=function(t){return Al("Query.limit",arguments,1),Sl("Query.limit","number",1,t),jl("Query.limit",1,t),new kd(wu(this.xd,t,"F"),this.firestore,this.If)},kd.prototype.limitToLast=function(t){return Al("Query.limitToLast",arguments,1),Sl("Query.limitToLast","number",1,t),jl("Query.limitToLast",1,t),new kd(wu(this.xd,t,"L"),this.firestore,this.If)},kd.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];_l("Query.startAt",arguments,1);var r=this.$d("Query.startAt",t,e,!0);return new kd(bu(this.xd,r),this.firestore,this.If)},kd.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];_l("Query.startAfter",arguments,1);var r=this.$d("Query.startAfter",t,e,!1);return new kd(bu(this.xd,r),this.firestore,this.If)},kd.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];_l("Query.endBefore",arguments,1);var r=this.$d("Query.endBefore",t,e,!0);return new kd(Eu(this.xd,r),this.firestore,this.If)},kd.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];_l("Query.endAt",arguments,1);var r=this.$d("Query.endAt",t,e,!1);return new kd(Eu(this.xd,r),this.firestore,this.If)},kd.prototype.isEqual=function(t){if(!(t instanceof kd))throw Fl("isEqual","Query",1,t);return this.firestore===t.firestore&&Iu(this.xd,t.xd)&&this.If===t.If},kd.prototype.withConverter=function(t){return new kd(this.xd,this.firestore,t)},kd.prototype.$d=function(c,t,e,n){if(Vl(c,1,t),t instanceof hd)return Al(c,i([t],e),1),function(t,e,n,r){if(!n)throw new Jr(Yr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=gu(t);o<s.length;o++){var u=s[o];if(u.field.O())i.push(Ao(e,n.key));else{var a=n.field(u.field);if(lo(a))throw new Jr(Yr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var h=u.field.F();throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}i.push(a)}}return new Wu(i,r)}(this.xd,this.firestore.Tf,t.Nd,n);var r=[t].concat(e);return function(t,e,n,r,i,o){var s=t.tn;if(i.length>s.length)throw new Jr(Yr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var h=i[a];if(s[a].field.O()){if("string"!=typeof h)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof h);if(!vu(t)&&-1!==h.indexOf("/"))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+h+"' contains a slash.");var c=t.path.child(ei.k(h));if(!ii.W(c))throw new Jr(Yr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+c+"' is not because it contains an odd number of segments.");var f=new ii(c);u.push(Ao(e,f))}else{var l=Vp(n,r,h);u.push(l)}}return new Wu(u,o)}(this.xd,this.firestore.Tf,this.firestore.Id,c,r,n)},kd.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Dl("Query.onSnapshot",arguments,1,4);var s,u={},a=0;"object"!=typeof i[a]||El(i[a])||(Ml("Query.onSnapshot",u=i[a],["includeMetadataChanges"]),Ol("Query.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++),El(i[a])?(s=i[a],i[a]=null===(t=s.next)||void 0===t?void 0:t.bind(s),i[a+1]=null===(e=s.error)||void 0===e?void 0:e.bind(s),i[a+2]=null===(n=s.complete)||void 0===n?void 0:n.bind(s)):(Sl("Query.onSnapshot","function",a,i[a]),xl("Query.onSnapshot","function",a+1,i[a+1]),xl("Query.onSnapshot","function",a+2,i[a+2]));var h={next:function(t){i[a]&&i[a](new _d(r.firestore,r.xd,t,r.If))},error:i[a+1],complete:i[a+2]};return Td(this.xd),this.firestore._d().listen(this.xd,u,h)},kd.prototype.get=function(t){var e=this;Dl("Query.get",arguments,0,1),Ld("Query.get",t),Td(this.xd);var n=this.firestore._d();return(t&&"cache"===t.source?n.zf(this.xd):n.Hf(this.xd,t)).then(function(t){return new _d(e.firestore,e.xd,t,e.If)})},kd),_d=(Object.defineProperty(xd.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(xd.prototype,"empty",{get:function(){return this.Od.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(xd.prototype,"size",{get:function(){return this.Od.docs.size},enumerable:!1,configurable:!0}),xd.prototype.forEach=function(e,n){var r=this;Dl("QuerySnapshot.forEach",arguments,1,2),Sl("QuerySnapshot.forEach","function",1,e),this.Od.docs.forEach(function(t){e.call(n,r.Bd(t,r.metadata.fromCache,r.Od.Lt.has(t.key)))})},Object.defineProperty(xd.prototype,"query",{get:function(){return new Ad(this.Md,this.pd,this.If)},enumerable:!1,configurable:!0}),xd.prototype.docChanges=function(t){t&&(Ml("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ol("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Od.Bt)throw new Jr(Yr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Ld&&this.qd===e||(this.Ld=function(i,e,o){if(i.Ot._()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Lt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Ot;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Lt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Lr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.Od,e,this.Bd.bind(this)),this.qd=e),this.Ld},xd.prototype.isEqual=function(t){if(!(t instanceof xd))throw Fl("isEqual","QuerySnapshot",1,t);return this.pd===t.pd&&Iu(this.Md,t.Md)&&this.Od.isEqual(t.Od)&&this.If===t.If},xd.prototype.Bd=function(t,e,n){return new cd(this.pd,t.key,t,e,n,this.If)},xd),Dd=(n(Sd,Nd=Ad),Object.defineProperty(Sd.prototype,"id",{get:function(){return this.xd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(Sd.prototype,"parent",{get:function(){var t=this.xd.path.p();return t._()?null:new ud(new ii(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(Sd.prototype,"path",{get:function(){return this.xd.path.F()},enumerable:!1,configurable:!0}),Sd.prototype.doc=function(t){Dl("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Cr.t()),Sl("CollectionReference.doc","non-empty string",1,t);var e=ei.k(t);return ud.gd(this.xd.path.child(e),this.firestore,this.If)},Sd.prototype.add=function(t){Al("CollectionReference.add",arguments,1),Sl("CollectionReference.add","object",1,this.If?this.If.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},Sd.prototype.withConverter=function(t){return new Sd(this.Ud,this.firestore,t)},Sd);function Sd(t,e,n){var r=this;if(((r=Nd.call(this,yu(t),e,n)||this).Ud=t).length%2!=1)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.F()+" has "+t.length);return r}function xd(t,e,n,r){this.pd=t,this.Md=e,this.Od=n,this.If=r,this.Ld=null,this.qd=null,this.metadata=new ad(n.hasPendingWrites,n.fromCache)}function kd(t,e,n){this.xd=t,this.firestore=e,this.If=n}function Od(t,e){if(void 0===e)return{merge:!1};if(Ml(t,e,["merge","mergeFields"]),Ol(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Ul(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Jr(Yr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+Ul(n[i]))}(t,"mergeFields",n,function(t){return"string"==typeof t||t instanceof Ql}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Jr(Yr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Pd(t,e){return void 0===e?{}:(Ml(t,e,["serverTimestamps"]),Pl(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Ld(t,e){xl(t,"object",1,e),e&&(Ml(t,e,["source"]),Pl(t,0,"source",e.source,["default","server","cache"]))}function Rd(t,e,n){if(e instanceof gp){if(e.firestore!==n)throw new Jr(Yr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Fl(t,"DocumentReference",1,e)}function Cd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Ud,Vd={Firestore:id,GeoPoint:yp,Timestamp:$r,Blob:Hl,Transaction:od,WriteBatch:sd,DocumentReference:ud,DocumentSnapshot:hd,Query:Ad,QueryDocumentSnapshot:cd,QuerySnapshot:_d,CollectionReference:Dd,FieldPath:Ql,FieldValue:pp,setLogLevel:id.setLogLevel,CACHE_SIZE_UNLIMITED:nd};(Ud=Md).INTERNAL.registerComponent(new Ar("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=new vl,i=new yl(r),new id(e,n,i,r);var e,n,r,i},"PUBLIC").setServiceProps(Object.assign({},Vd))),Ud.registerVersion("@firebase/firestore","1.16.4")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
